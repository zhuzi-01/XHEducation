(function (define, require) {


var qiao={};!function(e){function t(e){return function(t){if("."==t.charAt(0)){var r=e.split("/");r.splice(r.length-1,1),t=r.concat(t.split("/"));for(var a,o=0;a=t[o];o++)if("."==a)t.splice(o,1),o--;else if(".."==a)t.splice(o-1,2),o-=2;t=t.join("/")}if(!n[t]&&i[t])i[t].call(null);return n[t]}}var n={},i={};e.config=function(){},e.define=function(e,r){for(var e,r,a,o=0;a=arguments[o];o++)if("string"==typeof a)e=a;else if("[object Function]"=={}.toString.call(a))r=a;var s=function(){var module={exports:{}},i=r(t(e),module.exports,module);i=i||module.exports,n[e]=i};i[e]=s},e.require=function(e,n){for(var i,require=t(""),r=[],a=0;i=e[a];a++)r.push(require(i));n.apply(null,r)}}(qiao),define("front/icon/fix",["require","exports"],function(require,exports){function e(e){e.style.top="auto",e.style.bottom=0}var t={},n={},i={};return{init:function(e,r,a,o){t.users=e||[],t.groups=r||[],i=a,n=o},fixClose:function(){var r=t.groups;if(2==i.icontype)1==i.iconlevel&&r.length<=1&&e(n.close),2==i.iconlevel&&r.length<=1&&t.users.length<=1&&e(n.close)}}}),define("front/data/group",["require","exports","./config","../base/emitter","../base/Promise","../base/array"],function(require,exports){"use strict";function e(e){for(var t,n=0,i=!1;t=e[n];n++)if(0!==t.islogin){i=!0;break}return i}function t(t){if(t||t.group){for(var n,i=0,t=t.group;n=t[i];i++)if(!(n.user.length<=0||-1==s.indexOf(o,n.groupid))){var r=e(n.user);l=r||l,u.push({groupid:n.groupid,groupname:n.groupname,online:r}),c.push(n)}else;d.done()}}function n(e){for(var t,n=0,i=u.length;i>n;n++)if(t=u[n],t.groupid==e)return t.groupname;return"分组"}function i(e){for(var t,n,i=0,r=0;t=c[r];r++){var a=t.user;for(i=0;n=a[i];i++)if(n.subid==e)return{groupid:t.groupid,groupname:t.groupname,subname:n.subname}}return null}var r=require("./config"),a=(require("../base/emitter"),require("../base/Promise")),o=r.getAllowGroup(),s=require("../base/array"),u=[],c=[],l=!1,d=new a;return{getGroupBySub:i,getGroupNameById:n,handleGroup:t,getGroup:function(){return u},hasLoginSub:function(){return l},getUser:function(){return c},asyncHandle:function(){return d.promise()},getOnlineSubId:function(){for(var e="",t=0;t<c.length;t++)if(c.online){e=c.subid;break}return e}}}),define("front/icon/view/min",["require","./const","../../base/event","../../base/emitter"],function(require){function e(){var e=document.createElement("a");return e.setAttribute("href","javascript:;"),e.setAttribute("target","_self"),e.className=a,o=e,e}function t(){i.on(o,"click",function(e){if(e=e||window.event,e.preventDefault)e.preventDefault();else e.returnValue=!1;r.emit("icon:open")})}var n=require("./const"),i=require("../../base/event"),r=require("../../base/emitter"),a=n("min"),o=null;return{render:function(n,i){var r=e();return n.appendChild(r),!i&&t(),r}}}),define("front/icon/view/close",["require","./const","../../base/event","../../base/emitter"],function(require){function e(){var e=document.createElement("a");return e.setAttribute("href","javascript:;"),e.setAttribute("target","_self"),e.className=a,o=e,e}function t(){i.on(o,"click",function(e){if(e=e||window.event,e.preventDefault)e.preventDefault();else e.returnValue=!1;r.emit("icon:close")})}var n=require("./const"),i=require("../../base/event"),r=require("../../base/emitter"),a=n("close"),o=null;return{render:function(n,i){var r=e();return n.appendChild(r),!i&&t(),r}}}),define("front/base/string",["require","exports","./lang"],function(require,exports){"use strict";var e=require("./lang"),t=new RegExp("(^[\\s\\t\\xa0\\u3000]+)|([\\u3000\\xa0\\s\\t]+$)","g");return{format:function(t,n){t=String(t);var i=[].slice.call(arguments,1);if(i.length)return i=1==i.length?e.isArray(n)||e.isObject(n)?n:i:i,t.replace(/#\{(.+?)\}/g,function(t,n){var r=i[n];if(e.isFunction(r))r=r(n);return"undefined"==typeof r?"":r});else return t},objectToString:function(e){var t=[],n=function(e){if("object"==typeof e&&null!==e)return this.objectToString(e);else return/^(string|number)$/.test(typeof e)?'"'+e+'"':e};for(var i in e)t.push('"'+i+'":'+n(e[i]));return"{"+t.join(",")+"}"},encodeHTML:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},trim:function(e){return e.replace(t,"")}}}),define("front/icon/view/body",["require","./const","../../base/string","../../base/event","../../base/emitter","../../common/identity","../../log/log"],function(require){function e(e){for(var t,n=0,i=[];t=e[n];n++)t.online=t.online?b:"",i.push(c.format(T,t));return i.join("")}function t(e){var t,n,i,r=0,a=[];for(r;t=e[r];r++)for(t.online="",a.push(c.format(E,t)),n=0;i=t.user[n];n++)i.online=i.islogin?"qiao-icon-user-online":"",i.subname=c.trim(i.subname)||"&nbsp",a.push(c.format(S,i));return a.join("")}function n(n){var i=n.iconlevel,r=document.createElement("ins");r.className=m;var a=n.group,o=1===+i?e(a):2===+i?t(a):"";return r.innerHTML=o,C=r,r}function i(e){var t="BY_SELF";e.chattype=f.getChatType(t),d.emit("webim:open",e)}function r(e){d.emit("mess:center")}function a(e){var t=e.className,n=e.id.replace(_,"");if(t.indexOf(b)>-1)return void i({groupid:n});else return void r(n)}function o(e){var t=e.className,n=e.id.replace(x,"");if(t.indexOf(w)>-1)return void i({subid:n});else return void r(n)}function s(){l.on(C,"click",function(e){e=e||window.event;var t=e.target||e.srcElement,n=t.className;if(e.preventDefault)e.preventDefault();else e.returnValue=!1;if(n.indexOf(h)>-1)return a(t),d.emit("stat","CLICK_ICON",{info:"bridgeIconClick"}),p.sendLog("front","icon",{type:"bridgeIconClick",action:"click"}),!1;if(n.indexOf(y)>-1)return o(t),d.emit("stat","CLICK_ICON",{info:"bridgeSubClick"}),p.sendLog("front","icon",{type:"bridgeSubClick",action:"click"}),!1;else return void 0})}var u=require("./const"),c=require("../../base/string"),l=require("../../base/event"),d=require("../../base/emitter"),f=require("../../common/identity"),p=require("../../log/log"),m=u("body"),g=u("group"),h=u("group-link"),v=u("user-group"),y=u("user"),b=u("group-online"),w=u("user-online"),_=u("group"),x=u("user"),T='<ins class="'+g+'"><a href="#" target="_self" id="'+_+'#{groupid}" class="'+h+' #{online}">#{groupname}</a></ins>',E='<ins class="'+v+'">#{groupname}</ins>',S='<a href="#" target="_self" id="'+x+'#{subid}" class="'+y+' #{online}">#{subname}</a>',C=null;return{render:function(e,t,i){var r=n(t);return e.appendChild(r),!i&&s(),r}}}),define("front/storage/localStorage",["require","exports","../base/browser"],function(require,exports){"use strict";function e(e){if(n.localStorage)u.ls=n.localStorage;else u.ls=s,u.ls.build(e)}var t=require("../base/browser"),n=window,i=n.document,r="",a="",o="_QIAO_USERDATA_",s=function(){function e(e){return e.replace(s,"___")}var t,n=null,a=365,s=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");return{build:function(e){e=e||{},t=o+(e.siteId||r),a=e.expires||a},setup:function(){if(!n)try{n=i.createElement("input"),n.type="hidden",n.addBehavior("#default#userData"),i.body.appendChild(n)}catch(e){return!1}return!0},setItem:function(i,r){i=e(i);var o=this,s=new Date;if(o.setup())return s.setDate(s.getDate()+a),n.expires=s.toUTCString(),n.load(t),n.setAttribute(i,r),n.save(t),r;else return void 0},getItem:function(i){i=e(i);var r=this;if(r.setup())return n.load(t),n.getAttribute(i)},removeItem:function(i){i=e(i);var r=this;if(r.setup())n.load(t),n.removeAttribute(i),n.save(t)},clear:function(){var e=new Date;e.setDate(e.getDate()-1),n.expires=e.toUTCString()}}}(),u={INTERVAL:1e3,ls:null,useTimer:t.ie&&t.ie<8,timer:null,keyEvent:{}},c={onStorage:function(e,t,i){var r=u.ls.getItem(e);return i=i||null,function(a){setTimeout(function(){a=a||n.storageEvent;var o=a.key,s=a.newValue;if(!o){var c=u.ls.getItem(e);if(c!=r)o=e,s=c}if(o==e)t&&t.call(i,a.oldValue||r,s),r=s},0)}}};return exports.setItem=function(e,t){return e=a+e,u.ls.setItem(e,t)},exports.getItem=function(e){return e=a+e,u.ls.getItem(e)},exports.removeItem=function(e){return e=a+e,u.ls.removeItem(e)},exports.clear=function(){u.ls.clear()},exports.addStorageEvent=function(e,r){e=a+e;var o;if(!u.useTimer)if(o=c.onStorage(e,r),i.attachEvent&&!t.opera)i.attachEvent("onstorage",o);else n.addEventListener("storage",o,!1);else o=c.onStorage(e,r),u.timer=setInterval(function(){o({})},u.INTERVAL)},e({}),exports}),define("front/log/log",["require","../data/config","front/storage/localStorage","front/common/identity"],function(require){var e=require("../data/config"),t=require("front/storage/localStorage"),n=require("front/common/identity"),i=e.getLogRoot(),r=t.getItem(n.getLSKey("bid"))||"",a=e.getSiteId()||"",o=e.getUcId()||"";return{sendLog:function(module,e,t){var n=i+module+"/"+e+".gif?bid="+r+"&siteid="+a+"&ucid="+o;for(var s in t)n+="&"+s+"="+encodeURIComponent(t[s]);var u=new Image;u.src=n}}}),define("front/data/config",["require","exports","../base/lang"],function(require,exports){"use strict";function e(){for(var e,t=location.href,n=0,i=null;e=r[n];n++)if(e.url==t||t.indexOf(e.url)>-1)!i&&(i=e),i&&i.url&&i.url.length<e.url.length&&(i=e);if(i)return i.pageid;else return"0"}var t=require("../base/lang"),n="undefined"!=typeof BDBridgeConfig?window.BDBridgeConfig:{},i=n.BD_BRIDGE_DATA||{},r=n.BD_BRIDGE_SPECIAL||[],a={},o=function(){for(var t,i=n.BD_BRIDGE_STYLE_ITEM||[],a=r&&r.length<=0?"0":e(),o=0;t=i[o];o++)if(t.pageid==a)return t}(),s="";return{getSiteId:function(){return i.siteid||""},getUcId:function(){return i.ucid||""},getSiteIdMd5:function(){return i.SITE_ID||""},getRoot:function(){return n.ROOT},getLogRoot:function(){return n.LOG_ROOT||"//scqiao.baidu.com/"},getPoolRoot:function(){return n.POOL_ROOT||"//hqiao.baidu.com/f/pool/"},getRcvRoot:function(){if("https:"===location.protocol)return"//p.qiao.baidu.com/";else return n.RCV_ROOT},getImRoot:function(){if("https:"===location.protocol)return"//p.qiao.baidu.com/";else return n.IM_ROOT||"//p.qiao.baidu.com/"},getFrontRoot:function(){return n.FRONT_ROOT},getMainId:function(){return i.mainid||""},getUserName:function(){return i.userName||""},getIsAiPrologue:function(){return n.isAiPrologue||0},getStyleConfig:function(module){if(!module)return o;else return o["BD_BRIDGE_"+module.toUpperCase()]||{}},setStyleConfig:function(module,e){if(module)module="BD_BRIDGE_"+module.toUpperCase(),o[module]=t.extend(o[module],e)},getAllowGroup:function(){return o.BD_BRIDGE_GROUP||[]},getPageId:function(){return"0"==o.pageid?"":o.pageid},getStyleId:function(){return o.styleid||""},setModelData:function(e){a=t.extend(a,e)},getModelData:function(e){if(!e)return a;else return a[e]},getStartTime:function(){return n.TIME_START},setJsFunction:function(e){s="return "+e},getJsFunctionResult:function(){if(s){var e=new Function(s);return e()()}else return null},getIsWebIm:function(){var e=this.getStyleConfig().BD_BRIDGE_WEBIM.webimtype;return e},isAuthCode:!1,authCode:"",isSecondVerify:!1,jscodeForLog:function(){return s}}}),define("front/common/identity",["require","../data/config"],function(require){function e(){var e=a;return window[e]||(window[e]={})}var t=require("../data/config"),n=t.getSiteId(),i="QIAO_COOKIE_",r="QIAO_LS_"+n+"_",a="QIAO_NS_BSL",o="bridge",s={bid:n+"bid24",data:n+"data",show:n+"show",instance:n+"instance",chat:n+"chat",startload:n+"startload",ack:n+"ack",firstInfo:n+"firstInfo",prevInfo:n+"previousInfo",offsetTime:n+"offsetTime"},u={BY_INVITE:4,BY_SELF:1,AUTO_INVITE:3,ENFORCE:5};return{cookieId:function(e){return i+e.toUpperCase()},getLSKey:function(e){return r+e.toUpperCase()},getFlashId:function(){return o},getFlashKey:function(e){return s[e]||""},getBSLNs:function(){return e()},getChatType:function(e){if(0===u[e])return 0;else return u[e]||u.BY_SELF}}}),define("front/base/event",["require","exports","./dom"],function(require,exports){"use strict";var e=require("./dom"),t=[];return{on:function(n,i,r,a){if(i=i.replace("/^on/i","").toLowerCase(),n!==window)n=e.g(n);if(n){var o=function(e){a=a||n,r.call(a,e)};if(n.addEventListener)n.addEventListener(i,o,!1);else if(n.attachEvent)n.attachEvent("on"+i,o);return t.push([n,i,r,o]),n}},un:function(n,i,r){if(i=i.replace("/^on/i","").toLowerCase(),n!==window)n=e.g(n);for(var a,o=t.length;o--;){var s=t[o];if(s[1]===i&&s[0]===n&&s[2]===r){if(a=s[3],n.removeEventListener)n.removeEventListener(i,a,!1);else if(n.detachEvent)n.detachEvent("on"+i,a);t.splice(o,1)}}}}}),define("front/icon/view/head",["require","./const","../../base/event","../../base/emitter","../../common/identity","../../log/log"],function(require){function e(e){var t=e.iconlevel,n=0==t?"a":"ins",i=document.createElement(n),r=u;if(0==t)if(i.setAttribute("href","javascript:;"),i.setAttribute("target","_self"),0==e.hasLoginSub){var a=e.iconskin.useOfflineimg;if(a)r+=" qiao-icon-head-offline"}i.className=r;var o=document.createElement("ins");o.className=c;var d=document.createElement("ins");return d.className=l,d.innerHTML="在线咨询",i.appendChild(o),i.appendChild(d),s=i,{head:i,gradient:o,title:d}}function t(){i.on(s,"click",function(e){if(e=e||window.event,e.preventDefault)e.preventDefault();else e.returnValue=!1;var t="BY_SELF";r.emit("webim:open",{chattype:a.getChatType(t)}),r.emit("stat","CLICK_ICON",{info:"bridgeClick"}),o.sendLog("front","icon",{type:"bridgeClick",action:"click"})})}var n=require("./const"),i=require("../../base/event"),r=require("../../base/emitter"),a=require("../../common/identity"),o=require("../../log/log"),s=null,u=n("head"),c=n("gradient"),l=n("title");return{render:function(n,i,r){var a=e(i);return n.appendChild(s),!r&&0==i.iconlevel&&t(),a}}}),define("front/common/Fixed",["require","../base/browser","../base/dom","../base/lang"],function(require){"use strict";function e(){return Math.max(l.documentElement.scrollTop,l.body.scrollTop)}function t(){var e=l.documentElement,t=l.body,n=c?e:t;return n.clientHeight}function n(){return Math.max(l.documentElement.scrollLeft,l.body.scrollLeft)}function i(){var e=l.documentElement,t=l.body,n=c?e:t;return n.clientWidth}function r(e,t){if(e.indexOf("%")>-1)e=parseInt(e,10)/100,e*=t;return e=parseInt(e,10)}function a(e){var t=this;if(!u.instanceOf(t,a))t=new a(e);else t.init(e);return t}var o=require("../base/browser"),s=require("../base/dom"),u=require("../base/lang"),c=o.isStrict(),l=document;return a.prototype={constructor:a,init:function(e){if(!(o.ie<=6||7==o.ie&&!o.isStrict())||!e)return null;var t=this;return t.el=s.g(e),t.el.style.position="absolute",t.set(),t},set:function(){var e=this;if(e.isReady())return e.getNodeRect(),e.analyze(),e.setHtml(),void e.bindEvent();else return void setTimeout(function(){e.set()},200)},analyzeTop:function(){var e,n=this,i=n.rect,a=t();if(!i.bottom||"auto"==i.bottom)return e=r(i.top,a),void(n.top=e);var o=r(i.bottom,a);e=a-o-n.el.offsetHeight,n.top=e},analyzeLeft:function(){var e,t=this,n=t.rect,a=i();if(!n.right||"auto"==n.right)return e=r(n.left,a),void(t.left=e);var o=r(n.right,a);e=a-o-t.el.offsetWidth,t.left=e},analyze:function(){var e=this;e.el;if(e.isReady())e.analyzeTop(),e.analyzeLeft(),e.fix()},isReady:function(){var e=this.el;if(e&&e.offsetHeight&&"visible"==s.getStyle(e,"visibility"))return!0;else return!1},getNodeRect:function(){var e=this,t=e.el,n=t.style,i=t.currentStyle;e.rect={top:n.top||i.top,left:n.left||i.left,right:n.right||i.right,bottom:n.bottom||i.bottom}},setHtml:function(){var e=l.documentElement;e.style.backgroundImage="url(about:blank)",e.style.backgroundAttachment="fixed"},bindEvent:function(){var e=this;window.attachEvent("onscroll",function(){e.fix()}),window.attachEvent("onresize",function(){e.resizeFix()})},resizeFix:function(){var e=this;if(o.ie<=6)e.getNodeRect(),e.analyze()},fix:function(){var t=this,i=t.el;if(t.isReady()){var r=e(),a=n();i.style.top=r+t.top+"px",i.style.left=a+t.left+"px"}}},a}),define("front/common/Mask",["require","../base/browser","../base/dom","./view"],function(require){"use strict";function e(){var e=document.createElement("iframe");return e.className=r,e.src="about:blank",e.setAttribute("frameborder",0),e.frameborder=0,e.border=0,e}function t(){this.init.apply(this,arguments)}var n=require("../base/browser"),i=require("../base/dom"),r=require("./view").getClassPre("mask")+"iframe";return t.prototype={constructor:t,init:function(t){var i=this;if(!n.ie||n.ie>6||!t)return null;var r=e(),a=t.firstElementChild||t.firstChild;return t.insertBefore(r,a),i.wrap=t,i.mask=r,i.auto(),i},auto:function(){var e=this,t=e.mask,n=e.wrap;if(t&&n)if(n.offsetHeight&&"visible"==i.getStyle(n,"visibility"))return t.style.height=n.offsetHeight,void(t.style.width=n.offsetWidth);else return void setTimeout(function(){e.auto()},200)}},t}),define("front/base/lang",[],function(){"use strict";function e(e){return"[object Array]"===n.call(e)}function t(e){return!(!e||!i.test(e))}var n={}.toString,i=/\{\s*\[(?:native code|function)\]\s*\}/i;return{isNative:t,isArray:t(Array.isArray)?Array.isArray:e,isObject:function(e){return e&&"[object Object]"===n.call(e)},isFunction:function(e){return e&&"[object Function]"===n.call(e)},instanceOf:function(e,t){return e&&e.hasOwnProperty&&e instanceof t},extend:function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}}}),define("front/base/array",["require","exports","./lang"],function(require,exports){"use strict";var e=require("./lang");exports.indexOf=function(t,n){if(e.isNative([].indexOf))return t.indexOf(n);for(var i,r=0,a=t.length;a>r;r++)if(i=t[r],i===n)return r;return-1}}),define("front/base/emitter",["require","exports","./array"],function(require,exports){"use strict";var e=require("./array").indexOf,t={};exports.on=function(e,n){(t[e]=t[e]||[]).push(n)},exports.once=function(e,t){function n(){exports.off(e,n),t.apply(this,arguments)}exports.on(e,n)},exports.off=function(n,i){var r=arguments.length;if(0===r)return void(t={});if(1===r)return void delete t[n];var a=t[n],o=e(a,i);if(o>-1)a.splice(o,1)},exports.emit=function(e){var n=[].slice.call(arguments,1),i=t[e];if(i)for(var r=0,a=i.length;a>r;r++)i[r].apply(this,n)}}),define("front/base/Promise",[],function(){function e(){this._callbacks=[]}return e.prototype.then=function(t,n){var i,r=this;if(r._isdone)i=t.apply(n,r.result);else i=new e,r._callbacks.push(function(){var e=t.apply(n,arguments);if(e&&"function"==typeof e.then)e.then(i.done,i)});return i},e.prototype.done=function(){var e=this;e.result=arguments,e._isdone=!0;for(var t=0,n=e._callbacks.length;n>t;t++)e._callbacks[t].apply(null,arguments);e._callbacks=[]},e.prototype.promise=function(){var e=this;return{then:function(){e.then.apply(e,arguments)}}},e}),define("front/common/view",["require","../base/Promise"],function(require){"use strict";function e(){if(a.wrap)return void o.done(a.wrap);var e;if(e=document.body){var t=e.firstElementChild||document.body.firstChild;return e.insertBefore(s,t),a.wrap=s,void o.done(a.wrap)}else setTimeout(arguments.callee,0)}function t(e){this.elements=e}var n=require("../base/Promise"),i="qiao-",r="qiao-",a={},o=new n,s=document.createElement("ins");return s.id=i+"wrap",t.prototype.getElement=function(e){return this.elements[e]},{getWrap:function(){return e()},getIdPre:function(e){return i+e.toLowerCase()+"-"},getClassPre:function(e){return r+e.toLowerCase()+"-"},asyncHandle:function(){return o.promise()},create:function(e){return new t(e)},setWrapTop:function(e){if(a.wrap&&e!=a.wrap.lastChild)a.wrap.appendChild(e)}}}),define("front/icon/view/const",["require","../../common/view"],function(require){var e=require("../../common/view"),t=e.getIdPre("icon"),n=e.getClassPre("icon");return function(e,i){return("id"==i?t:n)+e.toLowerCase()}}),define("front/icon/view",["require","exports","./view/const","../base/browser","../base/emitter","../base/dom","../base/lang","../common/Mask","../common/Fixed","./view/head","./view/body","./view/close","./view/min","../common/view"],function(require,exports){function e(e,t){var n=u.g(h);if(!n)n=document.createElement("ins"),n.id=h,n.className=v,n.style.visibility="hidden",e.appendChild(n);if(0==t.icontype)n.className+=" "+y;return n.innerHTML="",w=n,n}function t(){u.addClass(w,b),_&&_.auto(),x&&x.resizeFix()}function n(){u.removeClass(w,b),_&&_.auto(),x&&x.resizeFix()}function i(){s.on("icon:close",t),s.on("icon:open",n)}function r(){var e=w;if("visible"==u.getStyle(e,"visibility")&&e.offsetHeight)return void(e.style.marginTop=-Math.floor(e.offsetHeight/2)+"px");else return void setTimeout(function(){r()},200)}function a(e,t,n){var i=t.iconlevel,r=t.icontype,a=f.render(e,t,n);if(0!==i){var o=p.render(e,t,n);if(0!==r)var s=m.render(e),u=g.render(e)}var l=c.extend({},a);return o&&(l.body=o),u&&(l.min=u),s&&(l.close=s),l}var o=require("./view/const"),s=(require("../base/browser"),require("../base/emitter")),u=require("../base/dom"),c=require("../base/lang"),l=require("../common/Mask"),d=require("../common/Fixed"),f=require("./view/head"),p=require("./view/body"),m=require("./view/close"),g=require("./view/min"),h=o("wrap"),v=o("wrap"),y=o("fixed"),b=o("wrap-min"),w=null,_=null,x=null,T={};return exports.hide=function(){T.iconWrap.style.cssText+=";display:none !important;"},{render:function(n,o,s){var u=T.iconWrap=e(n,o),c=a(u,o,s);c.container=u;var f=o.iconposition.postype;if(1===f&&0!==o.icontype){var p=o.iconposition.position;if(1===p||4===p){var p=o.position;r()}}if(0!==o.icontype)_=new l(u),x=new d(u);if(1==o.iconmode)t();i();var m=require("../common/view").create(c);return require("../base/lang").extend(m,exports)}}}),define("front/base/browser",[],function(){"use strict";var e,t=document,n=new RegExp("msie (\\d+\\.\\d+)","i"),i=navigator.userAgent;return{ie:function(){return n.test(i)?t.documentMode||+RegExp.$1:e}(),opera:/opera(\/| )(\d+(\.\d+)?)(.+?(version\/(\d+(\.\d+)?)))?/i.test(i)?+(RegExp.$6||RegExp.$2):void 0,safari:/Safari/i.test(i)&&/Version/i.test(i),isStrict:function(){return"CSS1Compat"==t.compatMode},isMobile:function(){return!!i.match(/.*Mobile.*/)||"ontouchstart"in window}()}}),define("front/base/dom",["require","./browser"],function(require){"use strict";function e(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})}function t(t,n,i){t.style[e(n)]=i}function n(e,n){for(var i in n)if(n.hasOwnProperty(i))t(e,i,n[i])}function i(e){var t=require("./browser").ie,n={};if(8>t)n["for"]="htmlFor",n["class"]="className";else n.htmlFor="for",n.className="class";return n[e]||e}function r(e,t){if(!e||!e.className)return!1;var n=new RegExp("(^| )"+t+"( |$)");if(!n.test(e.className))return!1;else return!0}function a(e){if(!e)return null;if("string"==typeof e||e instanceof String)return document.getElementById(e);if(e.nodeName&&(1==e.nodeType||9==e.nodeType))return e;else return null}var o=require("./browser");return{g:a,createIframe:function(e,t,n){var i=require("./browser").ie,r=9>i?'<iframe name="'+t+'">':"iframe",a=document.createElement(r);if(a.setAttribute("id",e),a.setAttribute("name",t),a.style.display="none",a.setAttribute("src","about:blank"),n)n.appendChild(a);return a},create:function(e,t,r){var a=document.createElement(e);for(var o in t)if(t.hasOwnProperty(o))if("styles"==o)n(a,t[o]);else a.setAttribute(i(o),t[o]);if(r)r.appendChild(a);return a},insertHTML:function(e,t,n){e=a(e);var i,r;if(e.insertAdjacentHTML&&!o.opera)e.insertAdjacentHTML(t,n);else{if(i=e.ownerDocument.createRange(),t=t.toUpperCase(),"AFTERBEGIN"==t||"BEFOREEND"==t)i.selectNodeContents(e),i.collapse("AFTERBEGIN"==t);else r="BEFOREBEGIN"==t,i[r?"setStartBefore":"setEndAfter"](e),i.collapse(r);i.insertNode(i.createContextualFragment(n))}return e},setStyle:t,setStyles:n,hasClass:r,getStyle:function(t,n){if(!t)return"";n=e(n);var i=9==t.nodeType?t:t.ownerDocument||t.document;if(i.defaultView&&i.defaultView.getComputedStyle){var r=i.defaultView.getComputedStyle(t,null);if(r)return r[n]||r.getPropertyValue(n)}else if(t&&t.currentStyle)return t.currentStyle[n];return""},addClass:function(e,t){if(e&&!r(e,t))return e.className+=" "+t,e;else return void 0},removeClass:function(e,t){if(e){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");return e.className=e.className.replace(n,""),e}}}}),define("front/icon/main",["require","exports","../base/dom","./view","../common/view","../data/config","../data/group","./view/const","../base/emitter","./fix","../storage/localStorage","../log/log"],function(require,exports){function e(e){var t=a.getStyleConfig("icon"),e=0==t.icontype?n.g(s("fixed-wrap","id"))||n.g("BDBridgeFixedWrap")||e:e;if(e){var r=o.getUser();if(!r||0==r.length)t.iconlevel=0;var u=o.getGroup(),p=2==t.iconlevel?r:u;t.group=p,t.hasLoginSub=o.hasLoginSub(),f.main=i.render(e,t),c.init(r,u,t,f.main.elements),c.fixClose();var module="front",m="loadtime",g={startTime:a.getStartTime()||(new Date).getTime(),timeBslEnd:l.getItem("QIAO_LOG_timeBslEnd"),timeEnterEnd:l.getItem("QIAO_LOG_timeEnterEnd"),timeMainEnd:l.getItem("QIAO_LOG_timeMainEnd"),timeIconEnd:(new Date).getTime()};d.sendLog(module,m,g)}}function t(){f.main.hide()}var n=require("../base/dom"),i=require("./view"),r=require("../common/view"),a=require("../data/config"),o=require("../data/group"),s=require("./view/const"),u=require("../base/emitter"),c=require("./fix"),l=require("../storage/localStorage"),d=require("../log/log"),f={};exports.init=function(){d.sendLog("front","icon",{action:"show"});var n=o.asyncHandle();r.getWrap();var i=r.asyncHandle();n.then(function(){i.then(e)}),u.on("icon:hide",t)}}),require(["front/icon/main","front/storage/localStorage"],function(e,t){e.init();var n=(new Date).getTime();t.setItem("QIAO_LOG_timeMainEnd",n)}),define("front/invite/view/event",["require","../../base/emitter"],function(require){function e(){var e=[].slice.call(arguments);t.emit.apply(t,e)}var t=require("../../base/emitter"),n="invite:",i={close:function(){e(n+"close")},accept:function(){e(n+"accept")},reject:function(){e(n+"reject")},send:function(t){e(n+"send",t)}};return{emit:function(e){var t=[].slice.call(arguments,1),n=i[e];if(n)n.apply(null,t)}}}),define("front/invite/view/operation",["require","../../base/browser","../../data/config","../../base/dom","./common","../../base/event","../../base/string","./event"],function(require){function e(){var e=u.getStyleConfig("invite");return"1"==e.type}function t(e){var t=require("../../base/dom"),n=require("./common");c.accept=t.create("ins",{className:n.className("accept")},e),c.accept.innerHTML=i,c.reject=t.create("a",{className:n.className("reject")},e),c.close=t.create("a",{className:n.className("close")},e),c.reject.innerHTML=r,c.form=t.create("ins",{className:n.className("form")},e),c.form.innerHTML='<ins class="'+n.className("form")+'-inner"></ins>';var s=c.form.firstChild;c.input=t.create("textarea",{className:n.className("input"),placeholder:o},s),c.send=t.create("a",{className:n.className("send")},s),c.send.innerHTML=a}function n(t){var n=require("../../base/event"),i=require("../../base/string"),r=require("./event"),a=function(){var e="";if(c.input)e=c.input.value=i.trim(c.input.value),c.input.value="";r.emit("accept",e)};if(n.on(c.accept,"click",a),s.ie&&s.ie<=6&&e())n.on(t,"click",a);n.on(c.reject,"click",function(){r.emit("reject")}),n.on(c.close,"click",function(){r.emit("close")}),n.on(c.send,"click",function(){var e=c.input.value=i.trim(c.input.value);c.input.value="",r.emit("send",e)})}var i="现在咨询",r="稍后再说",a="发送",o="您可直接在这里和我们联系！",s=require("../../base/browser"),u=require("../../data/config"),c={};return{render:function(e,i){if(t(e),i.bindEvent!==!1)n(e);return c}}}),define("front/invite/view/text",["require","../../base/dom","./common"],function(require){function e(n){if(n.offsetHeight){var i=-1*n.offsetHeight/2-20;t.setStyle(n,"margin-top",i+"px"),t.setStyles(n,{"margin-top":i+"px",visibility:"visible"})}else setTimeout(function(){e(n)},100)}var t=require("../../base/dom");return{render:function(n,i){var r=require("./common"),a=t.create("ins",{className:r.className("text"),styles:{visibility:"hidden"}});return a.innerHTML=i.text||"",n.appendChild(a),e(a),a}}}),define("front/invite/view/decoration",["require","./common","../../base/dom"],function(require){return{render:function(e){var t=require("./common").className("decoration"),n=require("../../base/dom").create("ins",{className:t},e);return n}}}),define("front/invite/view/common",["require","../../common/view"],function(require){"use strict";var e=require("../../common/view"),t="invite";return{id:function(n){return e.getIdPre(t)+n},className:function(n){return e.getClassPre(t)+n}}}),define("front/invite/view/container",["require","./common","../../base/dom","../../base/browser","../../common/Fixed","../../common/Mask"],function(require){"use strict";var e=require("./common"),t=require("../../base/dom"),n=require("../../base/browser"),i=require("../../common/Fixed"),r={WRAPPER:e.className("wrap"),IFRAME:e.className("wrap-mask")},a=e.id("wrap");return{render:function(o,s){var u=t.g(a),c=r.WRAPPER;if(s.ideaName)c=c+" "+e.className(s.ideaName);if(!u){if(u=t.create("ins",{id:a,className:c,styles:{visibility:"hidden",display:"none"}}),n.ie&&n.ie<=6){var l=require("../../common/Mask");new l(u)}o.appendChild(u)}else u.innerHTML="";return i(u),u}}}),define("front/invite/view",["require","../base/dom","../common/view","./view/container","./view/decoration","./view/text","./view/operation","../base/lang"],function(require){"use strict";var e=(require("../base/dom"),{}),exports={},t=require("../common/view");return exports.hide=function(){e.container.style.display="none"},exports.show=function(){e.container.style.display="",t.setWrapTop(e.container)},{render:function(t,n){e.container=require("./view/container").render(t,n);var i=require("./view/decoration").render(e.container,n),r=require("./view/text").render(e.container,n),a=require("./view/operation").render(e.container,n),o=require("../common/view").create({container:e.container,decoration:i,text:r,operation:a});return require("../base/lang").extend(o,exports)}}}),define("front/base/cookie",[],function(){return{get:function(e){var t=new RegExp("(^| )"+e+"=([^;]*)(;|$)"),n=t.exec(document.cookie);return n?decodeURIComponent(n[2]):null},set:function(e,t,n){n=n||{};var i;if(n.expires)if(i=n.expires,"number"==typeof i)i=new Date,i.setTime(n.expires+i.getTime());document.cookie=e+"="+encodeURIComponent(t)+(n.path?"; path="+n.path:"")+(i?"; expires="+i.toGMTString():"")+(n.domain?"; domain="+n.domain:"")+(n.secure?"; secure":"")}}}),define("front/net/jsonp",["require"],function(require){"use strict";function e(e,i){var s=a(),p=null,m=i.timeout||null,g=i.callbackKey||d,h=s,v=i.data||{};v.t=(new Date).getTime();var y=i.charset||f,b=function(e){i.onsuccess&&i.onsuccess(e),n(p),r(h)},w=function(){i.onfail&&i.onfail(),n(p),r(h)},_=o({url:e+t(e,v,g,h),charset:y,id:s});if(c[s]=u[s]=function(){b.apply(null,arguments)},l[s]=function(){w.apply(null,arguments)},m)p=setTimeout(function(){p=null,_.abort(),w.call(null)},m);_.send()}function t(e,t,n,i){var r={}.toString.call(t),a="?";if(e.indexOf("?")>-1)a="&";var o=a+n+"="+i;if("[object Object]"===r)for(var s in t)if(t.hasOwnProperty(s))o+="&"+s+"="+encodeURIComponent(t[s]);return o}function n(e){if(e)clearTimeout(e),e=null}function i(e){if(u[e])u[e]=p(e),c[e]=null,delete c[e]}function r(e){try{c[e]=null,u[e]=null,delete c[e],delete u[e]}catch(t){}}function a(){var e="cxxxxxxx_xxxx_4xxx_yxxx_xxxxxxxxxxxx";return e.replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})}function o(e){var t,n=s.head||s.getElementsByTagName("head")&&s.getElementsByTagName("head")[0]||s.body;return{send:function(){t=s.createElement("script"),t.async=!0,t.charset=e.charset,t.src=e.url,t.id=e.id,t.onload=t.onreadystatechange=function(n){if(n===!0||!t.readyState||/loaded|complete/.test(t.readyState)){if(t.onload=t.onreadystatechange=null,t.parentNode)t.parentNode.removeChild(t);if(t=null,n===!0)i(e.id)}},t.onerror=function(){if(t.parentNode)t.parentNode.removeChild(t);if(l[t.id])l[t.id].call(null);t=null},n.insertBefore(t,n.firstChild)},abort:function(){if(t)t.onload(!0)}}}var s=document,u=window,c={},l={},d="callback",f="utf-8",p=function(e){return function(){
try{u[e]=null,delete u[e]}catch(t){}}};return{request:e}}),define("front/invite/main",["require","../base/emitter","../data/config","../data/group","../common/identity","../common/view","../net/jsonp","../base/string","../log/log","../base/lang","../base/cookie","./view"],function(require){function e(e,n,i){t(e),C[e]=setTimeout(n,i)}function t(e){var t=C[e];if(t)clearTimeout(t)}function n(){var e="";if(E.status==T.HAND)e=E.subid,E.chatType=v.getChatType(I);else E.chatType=v.getChatType(L);return e}function i(e){e=e||{},E=require("../base/lang").extend(E,e)}function r(e){var t={mainid:_,type:E.type,styleid:x,event:e,name:E.ideaId||"",info:E.ideaInfo||""};w.sendLog("front","invite",t)}function a(n){var i=E.way>=1;E.way>=2;if(i&&E.interval)e("autoInvite",o,1e3*E.interval);if(E.status==T.HAND&&n)if(g.emit("rcv:reject"),0===E.interval)E.way=1;E.status=T.NONE,E.subid=null,E.count++,S.main.hide(),t("disapear")}function o(){if(!(0===E.interval&&E.count>=1))if(E.way%2==1)if(E.status===T.NONE){if(0==E.page){var n=require("../base/cookie"),i=require("../common/identity").cookieId("INVITE_PAGE");if(n.get(i))return;else n.set(i,1)}if(t("autoInvite"),E.status=T.AUTO,S.main.show(),E.disap)e("disapear",function(){a()},1e3*E.disap)}}function s(n){var i=1===Math.floor(E.way/2);if(i)if(!(0===E.interval&&E.count>=1))if(E.status!=T.HAND){if(E.status==T.NONE)S.main.show();if(t("autoInvite"),E.status=T.HAND,E.subid=n,E.disap)e("disapear",function(){a(!0)},1e3*E.disap)}}function u(e,t){S.main=require("./view").render(S.wrapper,{text:E.text,ideaName:t})}function c(e){var t=h.getImRoot(),n=t+"/im/?controller=invite&action=getInviteBox",i={data:{mainid:_,ucid:h.getUcId()||"",siteid:h.getSiteId()||"",bid:e.bid||"",boxType:3,styleid:x},onsuccess:function(e){if(E.ideaInfo=e.data.ideaInfo||"",0===+e.status&&e.data.ideaId+""!="-1")E.ideaId=e.data.ideaId;else E.ideaId="normal";p(E.ideaId)},onfail:function(e){E.ideaId="normal",p(E.ideaId)}};b.request(n,i)}function l(e){if(1!=e.status)E.reported=!1;else if(s(e.subid),!E.reported){var t={subId:E.subid||0,open:1},n=h.getModelData("zhixin"),i=h.getModelData("servicetype");n&&(t.orderKey=n),i&&(t.servicetype=i),g.emit("stat","SEND_INVITE",t),E.reported=!0}}function d(){t("disapear"),t("autoInvite"),S.main.hide()}function f(){for(var e in k)if(k.hasOwnProperty(e))g.on("invite:"+e,k[e]);g.on("rcv:refresh",l),g.on("invite:hide",d)}function p(e){if(u(S.wrap,e),f(),E.way%2===1&&E.time)setTimeout(function(){o()},1e3*E.time);r("front","invite","show")}function m(e){if(S.wrapper=e,3===+E.type)g.on("rcv:enter",c);else p()}var g=require("../base/emitter"),h=require("../data/config"),v=(require("../data/group"),require("../common/identity")),y=require("../common/view"),b=require("../net/jsonp"),w=(require("../base/string"),require("../log/log")),_=h.getMainId()||"",x=h.getStyleId()||"",T={NONE:0,AUTO:1,HAND:2},E={status:T.NONE,auto:0,interval:0,page:1,time:1,manual:0,repeat:0,disap:0,text:"",reported:!1,count:0,chatType:"BY_SELF",subid:null},S={},C={},I="BY_INVITE",L="AUTO_INVITE",k={};return k.close=function(){g.emit("stat","CLOSE_INVITE",{}),a(!0),r("close")},k.accept=function(e){var t=n(),i={};if(""!==t)i.subid=t;if(i.chatType=E.chatType,i.chat=e||"",g.emit("webim:open",i),""!==t)g.emit("stat","ACCEPT_INVITE",{subId:t,open:1});a(),g.emit("stat","CLICK_ICON",{info:"invite"}),r("accept")},k.reject=function(){a(!0),r("reject")},k.send=function(e){a();var t=n(),i={};if(""!==t)i.subid=t;if(i.chatType=E.chatType,i.chat=e||"",g.emit("webim:open",i),""!==t)g.emit("stat","ACCEPT_INVITE",{subId:groupOption.subid,open:1});g.emit("stat","CLICK_ICON",{info:"invite"}),r("send")},{init:function(){var e=h.getStyleConfig("invite");i(e),y.getWrap();var t=y.asyncHandle();t.then(m)}}}),require(["front/invite/main"],function(e){e.init()}),define("front/mess/view/foot",["require","../../base/dom","./common","../../base/event","../../base/emitter"],function(require){function e(e){n.send=i.create("a",{className:u,id:s},e),n.send.innerHTML=l.SEND,n.logo=i.create("ins",{className:d},e),n.logo.innerHTML=c}function t(){var e=require("../../base/event"),t=require("../../base/emitter");e.on(n.send,"click",function(){n.value="",t.emit("mess:send",n.value)})}var n={wrap:null,send:null,logo:null},i=require("../../base/dom"),r=require("./common"),a=r.id("foot"),o=r.className("foot"),s=r.id("foot-send-btn"),u=r.className("foot-send-btn"),c='<a target="_blank" href="http://qiao.baidu.com/home/"><ins class="qiao-mess-foot-bdlogo"></ins><ins class="qiao-mess-foot-copyright">咨询软件由百度商桥免费提供</ins></a>',l={},d=r.id("foot-logo");return{render:function(r,s){if(l=s.LANGUAGE||{},n.wrap=i.create("ins",{id:a,className:o}),e(n.wrap),s.bindEvent!==!1)t();return r.appendChild(n.wrap),n}}}),define("front/mess/view/head",["require","./common","../../base/dom","./language","../../base/event","../../base/emitter"],function(require){function e(){var e=m.replace("#id",u).replace("#minid",c).replace("#maxid",l).replace(/#class/g,d),t=g.replace("#id",f).replace("#class",p).replace("#note",h.NOTE);i.wrap.innerHTML=t+e}function t(t){i.wrap=a.create("ins",{id:o,className:s}),e(),t.appendChild(i.wrap)}function n(e){var t=require("../../base/event"),n=require("../../base/emitter");t.on(u,"click",function(e){if(n.emit("mess:toggle"),e=e||window.event,e.stopPropagation)e.stopPropagation();else e.cancelBubble=!0}),t.on(o,"click",function(){n.emit("mess:max")})}var i={close:null,text:null,wrap:null},r=require("./common"),a=require("../../base/dom"),o=(require("./language"),r.id("head")),s=r.className("head"),u=r.id("head-close"),c=r.id("head-close-btn-min"),l=r.id("head-close-btn-max"),d=r.className("head-close"),f=r.id("head-text"),p=r.className("head-text"),m='<ins id="#id"><ins id="#minid" class="#class btn-min"><i></i></ins><ins id="#maxid" class="#class btn-max qiao-mess-hidden"><i></i></ins><ins>',g='<ins id="#id" class="#class">#note</ins>',h={};return{render:function(e,r){if(h=r.LANGUAGE||{},t(e),r.bindEvent!==!1)n(r);return i}}}),define("front/mess/view/placeholder",["require","exports"],function(require,exports){"use strict";function e(e){if(!("placeholder"in document.createElement("input")))for(var r,a=e.getElementsByTagName("*"),o=0;o<a.length;o++){var s=a[o].tagName.toLowerCase();if("input"==s||"textarea"==s||"select"==s)r=a[o],r.onfocus=n,r.onblur=i,r.onchange=t,r.onblur()}}function t(){var e=this.getAttribute("placeholder"),t=this.value;if(t===e)this.style.color=a}function n(){var e=this.getAttribute("placeholder"),t=this.value;if(t===e)this.value="",this.style.color=a}function i(){var e=this.getAttribute("placeholder"),t=this.value;if(""===t)this.value=e,this.style.color=r}var r="#999",a="#000";return{fixPlaceholder:e}}),define("front/mess/view/validate",["require","../../base/emitter"],function(require){function e(e,t){var n=!0,i={};if("[object Array]"=={}.toString.call(t))for(var i,r=0;(i=t[r])&&(n=a[i.type](e,i),n);r++);return{result:n,msg:i&&i.msg}}function t(e){var t=e.getAttribute("placeholder"),n=e.value;if(n===t)n="",e.value="";return n}function n(n,i){for(var a=n.getElementsByTagName("*"),o=[],s=0,u=a.length;u>s;s++){var c=a[s],l=c.getAttribute("name"),d=i[l]||!1;if(l&&d){var f=t(c),p=e(f,d);if(!p.result)r.emit("validate:fail",c,!1),o.push({name:l,msg:p.msg})}}return o}function i(e){for(var t=s.ERR_TITLE+"\n\n",n=[],i=0,r=e.length;r>i;i++){var a=e[i];n.push("      "+a.msg+"\n")}return t+=n.join("")}var r=require("../../base/emitter"),a={},o={email:/^(\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+)$/,mobilePhone:/^(\d{3})-(\d{3})-((\d{4})|(\d{1}))$|^(((\+86)|(86))?1(\d{10})|^((\d{7,8})|^(\d{4}|\d{3})-(\d{7,8})|^(\d{4}|\d{3})-(\d{7,8})-(\d{4}|\d{3}|\d{2})|^(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1})))$/i,url:/^[^.。，]+(\.[^.，。]+)+$/,number:/^\d*$/},s={};return a.len=function(e,t){var n=!0;if(e=e.toString(),void 0!==t.min)n=n&&e.length>=t.min;if(void 0!==t.max)n=n&&e.length<=t.max;return n},a.range=function(e,t){var n=!0;if(e=+e,void 0!==t.min)n=n&&e>=t.min;if(void 0!==t.max)n=n&&e<=t.max;return n},a.regexp=function(e,t){if(""==e)return!0;var n=o[t.rule]||new RegExp(t.rule);return e=e.toString(),n.test(e)},{check:function(e,t,r){var a=n(e,t);s=r||{};var o=!a.length,u=i(a);return{result:o,msg:u}},validateItem:e}}),define("front/mess/view/body",["require","../../base/emitter","../../base/event","../../common/identity","../../storage/localStorage","../../base/string","./language","../../data/config","./validate","./common","../../base/dom","../../base/lang","./placeholder"],function(require){function e(e){var e=e||"",t=B.replace(/#name/g,e).replace(/#itemHolder/g,_.TIP_MESS),n=L(_.TEXT,0)+": ";return S.rules[e]=[{type:"len",min:1,msg:n+_.ERR_NOT_NULL}],S.rules[e].push({type:"len",max:500,msg:n+_.ERR_TEXT_TOO_LONG}),t}function t(e,t,n,i,r){var a=S.rules;a[e]=[],r=r||e;var o="display:none",s=t+": ";if(n=t||_.TIP_DEFAULT,"1"==i||i===!0)o="display:inline",a[e].push({type:"len",min:1,msg:s+_.ERR_NOT_NULL}),n+=_.REQUIRED;if(a[e].push({type:"len",max:100,msg:s+_.ERR_ITEM_TOO_LONG}),"bd_bp_messPhone"==e)a[e].push({type:"regexp",rule:"mobilePhone",msg:_.ERR_PHONE_STYLE});if("bd_bp_messEmail"==e)a[e].push({type:"regexp",rule:"email",msg:_.ERR_EMAIL_STYLE});return e=e||"",t=t||"",html=H.replace("#itemTitle",t).replace(/#name/g,e).replace(/#prename/g,r).replace("#star",o).replace("#isNecessray",i).replace(/#itemHolder/g,n),html}function n(e,t,n,i,r,a){e=e||"",n=n||_.TIP_DEFAULT,t=t||"",i=i||[],a=a||e;var o=S.rules;o[e]=[];var s='<option value="">'+_.SELECT+"</option>";if(1===+r||r===!0)o[e].push({type:"len",min:1,msg:_.ERR_NOT_NULL}),t+=_.REQUIRED;for(var u=0,c=i.length;c>u;u++){var l=b(i[u]);s+='<option value="'+l+'">'+l+"</option>"}return html=Y.replace("#itemTitle",t).replace(/#name/g,e).replace(/#prename/g,a).replace("#isNecessray",r).replace(/#itemHolder/g,n).replace("#options",s),html}function i(e){var t=e.name||"",n=e.value||"",i=$.replace("#value",n).replace("#name",t);return i}function r(e){var t=k.g(D);if(t)E.wrap=t,E.wrap.innerHTML="";else E.wrap=k.create("ins",{id:D,className:A}),e.appendChild(E.wrap);E.form=k.create("form",{className:O+" qiao-mess-clearfix",method:"post",target:N,action:T.SUBMIT+S.siteId+"&page_id="+S.pageId+"&ucid="+S.ucid}),E.form.setAttribute("accept-charset","utf-8"),E.iframe=k.createIframe(N,N,E.wrap),o(E.form),E.wrap.appendChild(E.form)}function a(){var e={name:"bd_bp_title",value:b(document.title)},t={name:"bd_bp_referer",value:document.referrer},n={name:"bd_bp_bid",value:y.getItem(v.getLSKey("bid"))},r={name:"bd_bp_tick",value:(new Date).getTime()},a=i(e)+i(t)+i(r)+i(n);return a}function o(n){var i=S.options.messItem,r=S.options.extraMessItems,o="";if(o+=e("bd_bp_messText"),"2"!=i.messItemName)o+=t("bd_bp_messName",L(_.NAME,0),_.TIP_DEFAULT,i.messItemName);if("2"!=i.messItemPhone)o+=t("bd_bp_messPhone",L(_.PHONE,0),L(_.PHONE,1),i.messItemPhone);if("2"!=i.messItemAddress)o+=t("bd_bp_messAddress",L(_.ADDRESS,0),_.TIP_DEFAULT,i.messItemAddress);if("2"!=i.messItemEmail)o+=t("bd_bp_messEmail",L(_.EMAIL,0),L(_.EMAIL,1),i.messItemEmail);if(r&&r.length>0)o+=s(r);o+=a(),n.innerHTML=o,M.fixPlaceholder(E.form)}function s(e){for(var i=null,r="",a="",o=0,s=e.length;s>o;o++){var u="bd_bp_extral_",c="";i=e[o],a=b(i.key);var l="1"==i.necessity?!0:!1;if(i.subItems)c=u+"select_"+o,r+=n(u+o,a,"",i.subItems,l,c);else c=u+"input_"+o,r+=t(u+o,a,"",l,c)}return r}function u(){E.form.reset()}function c(e){for(var t=y.getItem(v.getLSKey("bid")),n=e.getElementsByTagName("input"),i=n.length-1;i>0;i--)if("bd_bp_bid"===n[i].getAttribute("name"))n[i].setAttribute("value",t)}function l(){require("../../base/event"),require("../../base/string");f(E.form,S.rules)}function d(){g.on("mess:send",U.send),g.on("validate:fail",U.setStyle)}function f(e,t){for(var n,i=e.elements,r=0;n=i[r];r++)if("input"===n.tagName.toLowerCase()||"textarea"===n.tagName.toLowerCase()||"select"===n.tagName.toLowerCase()){var a=n.getAttribute("name"),o=t[a]||!1;if(a)!function(e,t){h.on(e,"focus",function(){U.setStyle(e,!0)}),h.on(e,"blur",function(){U.checkValid(e,t)})}(n,o)}}function p(e){return String(e).replace(/(^\s*)|(\s*$)/g,"")}function m(e){return"0"==e?w.CHINESE:w.ENGLISH}var g=require("../../base/emitter"),h=require("../../base/event"),v=require("../../common/identity"),y=require("../../storage/localStorage"),b=require("../../base/string").encodeHTML,w=require("./language"),_={},x=require("../../data/config").getRoot(),T={SUBMIT:x+"?module=default&controller=index&action=doMess&siteid="},E={form:"",phone:"",email:"",message:"",send:"",custom:{}},S={options:{},siteId:"",ucid:"",pageId:"",rules:{}},C=require("./validate"),I=require("./common"),L=I.getLanText,k=require("../../base/dom"),M=(require("../../base/lang"),require("./placeholder")),D=I.id("body"),A=I.className("body"),N=I.id("iframe"),O=I.className("form"),P=I.className("item"),R=I.className("item-head"),j=I.className("item-body"),F=I.className("item-mess"),q=/msie (\d+\.\d+)/i.test(navigator.userAgent),U={},H='<ins class="'+P+' qiao-mess-clearfix"><ins class="'+R+'"><i class="head_#prename head-icon"></i></ins><ins class="qiao-mess-input-wrap"><input data-required="#isNecessray"  name="#name" class="'+j+'"  placeholder="#itemHolder"><span class="qiao-mess-error-icon qiao-mess-hidden "></span></ins></ins><ins class="qiao-mess-error-tip qiao-mess-hidden "></ins>',Y='<ins class="'+P+' qiao-mess-select qiao-mess-clearfix"><i class="head_#prename head-icon"></i><span>#itemTitle</span></ins><ins class="'+P+' qiao-mess-select-content qiao-mess-clearfix"><select name="#name" data-required="#isNecessray"class="'+j+'"  placeholder="#itemHolder">#options</select></ins>',B='<ins class="qiao-mess-clearfix"><ins class="qiao-mess-clearfix qiao-mess-contentarea '+F+'"><ins style="display:none">留言内容</ins><textarea data-required="1"  name="#name" class=""placeholder="#itemHolder" style="resize:none;padding: 4px"></textarea></ins></ins><ins class="qiao-mess-error-tip qiao-mess-hidden "></ins>',$='<input type="hidden" style="display:none" value="#value" name="#name" />',V="errBg";return U.send=function(){var e=C.check(E.form,S.rules,_);if(e.result){var t=!1;if(q)t=document.charset,document.charset="utf-8";if(c(E.form),E.form.submit(),q)document.charset=t;g.emit("mess:min"),g.emit("stat","SEND_MESS",{open:1}),setTimeout(function(){u(),M.fixPlaceholder(E.form)},0)}else M.fixPlaceholder(E.form)},U.setStyle=function(e,t){var n=t?k.removeClass:k.addClass;if("textarea"===e.tagName.toLocaleLowerCase()||"select"===e.tagName.toLocaleLowerCase())n(e,V);else if(t)k.removeClass(e.parentNode.parentNode,V);else if(!k.hasClass(e.parentNode.parentNode.nextElementSibling,"qiao-mess-show"))k.addClass(e.parentNode.parentNode,V);if(t&&k.hasClass(e.parentNode.parentNode.nextElementSibling,"qiao-mess-show"))k.addClass(e.nextElementSibling," qiao-mess-hidden"),k.addClass(e.parentNode.parentNode.nextElementSibling," qiao-mess-hidden")},U.checkValid=function(e,t){var n=e.value;if(""===p(n)&&("1"===e.getAttribute("data-required")||"true"===e.getAttribute("data-required")))if("input"===e.tagName.toLocaleLowerCase())k.addClass(e.parentNode.parentNode,V);else k.addClass(e,V);var i=C.validateItem(n,t);if(""!==p(n)&&!i.result)e.parentNode.parentNode.nextSibling.innerHTML=i.msg,k.addClass(e.parentNode.parentNode.nextSibling," qiao-mess-show"),k.removeClass(e.parentNode.parentNode.nextSibling,"qiao-mess-hidden"),k.removeClass(e.nextSibling,"qiao-mess-hidden")},{render:function(e,t){if(t.rules)S.rules=t.rules||{};if(_=t.LANGUAGE||m(t.messItem.language),S.options=t||{},S.siteId=t.siteId||"",S.pageId=t.pageId||"",S.ucid=t.ucid||"",E.main=e,r(e,t),t.bindEvent!==!1)l(),d();return E}}}),define("front/mess/view/container",["require","./common","../../base/dom"],function(require){var e=require("./common"),t=require("../../base/dom"),n=e.id("container"),i=e.className("container");return{render:function(e,r){var a=t.g(n);return a=t.create("ins",{id:n,className:i}),e.appendChild(a),a}}}),define("front/mess/view/common",["require","exports","../../common/view"],function(require,exports){"use strict";function e(e,t){var n=e.split("%bd_bp_sp%");return n[t]}var t=require("../../common/view"),n="mess";return{id:function(e){return t.getIdPre(n)+e},className:function(e){return t.getClassPre(n)+e},getLanText:e}}),define("front/mess/view/language",["require"],function(require){var e={NOTE:"请您留言",TITLE:"欢迎给我们留言",TEXT:"留言内容",SEND:"提 交",RIGHT_TIP:"百度提供技术支持",NAME:"姓名",PHONE:"电话%bd_bp_sp%请输入您的电话号码",ADDRESS:"地址",EMAIL:"邮箱%bd_bp_sp%请输入合法邮箱名",SELECT:"-- 请选择 --",TIP_DEFAULT:"最多100个字符",TIP_MESS:"请在此输入留言内容，我们会尽快与您联系! ( 必填 )",ERR_NOT_NULL:"不能为空",ERR_NOT_SELECTED:"未选择有效的值",ERR_TEXT_TOO_LONG:"不能超过500个字符",ERR_ITEM_TOO_LONG:"不能超过100个字符",ERR_TITLE:"对不起，您提交的留言存在以下错误：",ERR_NUMBER_ONLY:"应当全部由数字组成",ERR_PHONE_STYLE:"格式错误，如座机加区号请用“-”区分",ERR_EMAIL_STYLE:"请填写正确的邮箱格式",SUCCESS:"留言成功！谢谢您，我们会尽快与您联系！",FAILED:"对不起！您的网络存在异常，为了确保留言发送成功请稍后再试一次！",REQUIRED:" ( 必填 )",EMPTY:"您提交的内容不能为空",VALID:"信息填写错误",SURE:"确定"},t={NOTE:"Please leave a message",TITLE:"Send message to us",TEXT:"Contents",SEND:"Send",RIGHT_TIP:"Powered by Baidu",NAME:"Name",PHONE:"Tel%bd_bp_sp%Leave us your telephone number",ADDRESS:"Address",EMAIL:"Email%bd_bp_sp%Leave us your email",SELECT:"-- Please select --",TIP_DEFAULT:"Less than 100 chars",TIP_MESS:"Leave us your message，we will contact you as soon as possible！(Required)",ERR_NOT_NULL:" is necessary",ERR_NOT_SELECTED:" is not correctly selected",ERR_TEXT_TOO_LONG:" should be less than 500 chars",ERR_ITEM_TOO_LONG:" should be less than 100 chars",ERR_TITLE:"Sorry, some errors exist in your submition:",ERR_NUMBER_ONLY:" should be numbers",ERR_PHONE_STYLE:"Information incorrect",ERR_EMAIL_STYLE:"Information incorrect",SUCCESS:"Thank You! We have received your message and will respond promptly",FAILED:"Opps！The Operation Failed Due to Network or Other Communication Problems",REQUIRED:" (Required)",EMPTY:"Content cannot be empty",VALID:"Information incorrect",SURE:"Ok"};return{CHINESE:e,ENGLISH:t}}),define("front/mess/view",["require","../base/browser","../base/emitter","../base/dom","../base/lang","../common/Mask","../common/Fixed","./view/language","./view/common","./view/container","./view/body","./view/head","./view/foot","../common/view"],function(require){"use strict";function e(){o.on("mess:min",_.min),o.on("mess:max",_.max),o.on("mess:show",_.show),o.on("mess:center",_.center),o.on("mess:toggle",_.toggle)}function t(e){var t=s.g(E);if(!t)t=document.createElement("ins"),t.id=E,t.className=S,t.style.visibility="hidden",t.style.display="none",e.appendChild(t);else t.innerHTML="";return t}function n(){w.status="show",b.messWrap.style.display="block",y.setWrapTop(b.messWrap)}function i(){b.messWrap.style.display="none",w.status="hide"}var r,a=require("../base/browser"),o=require("../base/emitter"),s=require("../base/dom"),u=require("../base/lang"),c=require("../common/Mask"),l=require("../common/Fixed"),d=require("./view/language"),f=require("./view/common"),p=require("./view/container"),m=require("./view/body"),g=require("./view/head"),h=require("./view/foot"),v=null,y=require("../common/view"),b={messWrap:null,container:null,body:null,head:null,foot:null},w={status:"hide"},_={},x=f.className("wrap-min"),T=f.className("wrap-center"),E=f.id("wrap"),S=f.className("wrap");return _.max=function(){s.removeClass(b.messWrap,x),r&&r.auto(),s.addClass(b.closeMaxBtn,"qiao-mess-hidden"),s.removeClass(b.closeMinBtn,"qiao-mess-hidden"),v&&v.resizeFix()},_.show=function(){if("hide"==w.status)n();s.removeClass(b.messWrap,x)},_.min=function(){if(s.removeClass(b.messWrap,T),s.addClass(b.messWrap,x),s.removeClass(b.closeMaxBtn,"qiao-mess-hidden"),s.addClass(b.closeMinBtn,"qiao-mess-hidden"),6==a.ie)b.messWrap.style.cssText="";r&&r.auto(),v&&v.resizeFix()},_.toggle=function(){var e=b.messWrap.className;if(-1!=e.indexOf(x))o.emit("mess:max");else o.emit("mess:min")},_.center=function(){if(n(),s.hasClass(b.closeMinBtn,"qiao-mess-hidden"))s.addClass(b.closeMaxBtn,"qiao-mess-hidden"),s.removeClass(b.closeMinBtn,"qiao-mess-hidden");if(s.removeClass(b.messWrap,x),s.addClass(b.messWrap,T),6==a.ie)b.messWrap.style.cssText="";r&&r.auto(),v&&v.resizeFix(),o.emit("stat","CLICK_MESS",{})},{render:function(n,i){if(i=u.extend({},i),!i.LANGUAGE)i.LANGUAGE=0==i.messItem.language?d.CHINESE:d.ENGLISH;var a={};b.messWrap=t(n),b.container=p.render(b.messWrap,i),a.head=g.render(b.container,i);var o=f.id("head-close");b.closeMinBtn=s.g(o+"-btn-min"),b.closeMaxBtn=s.g(o+"-btn-max"),a.body=m.render(b.container,i),a.foot=h.render(b.container,i),r=new c(b.messWrap),v=new l(b.messWrap),e();var y=b.messWrap;return a.container=b.container,a.messWrap=b.messWrap,u.extend(y,{elements:a})},show:n,hide:i}}),define("front/mess/main",["require","./view","../common/view","../data/config","../data/group","../base/emitter","./view/language","../base/lang"],function(require){function e(e){e=e||{},d=require("../base/lang").extend(d,e),d.siteId=require("../data/config").getSiteId(),d.ucid=require("../data/config").getUcId(),d.pageId=require("../data/config").getPageId()}function t(){if(!s.hasLoginSub())r.show()}function n(){r.hide()}function i(e){if(0==d.messItem.language)d.LANGUAGE=c.CHINESE;else d.LANGUAGE=c.ENGLISH;var i=r.render(e,d);if(0==d.messType.disableMess)if(1==d.messShow.messFloatType)r.show();else{var a=s.asyncHandle();a.then(t)}return l=i,u.on("mess:hide",n),i}var r=require("./view"),a=require("../common/view"),o=require("../data/config"),s=require("../data/group"),u=require("../base/emitter"),c=require("./view/language"),l=null,d={messItem:{messItemName:0,messItemPhone:0,messItemAddress:0,messItemEmail:0,messItemText:1,language:0},extraMessItems:[],messType:{disableMess:0},messShow:{messFloatType:1},messPosition:{position:3},messSkin:{active:0,backgroundColor:"#3399CC",backgroundUrl:"//hqiao.baidu.com/v3/res/messbg/04.png"}};return{init:function(){var t=o.getStyleConfig("mess");e(t),a.getWrap();var n=a.asyncHandle();n.then(i)}}}),require(["front/data/config","front/mess/main"],function(e,t){t.init(e.getStyleConfig("mess"))}),define("front/api/main",["require","exports","../base/emitter","../base/lang"],function(require,exports){function e(e){e=i.extend({},e),n.emit("windowChat:open",e)}function t(e){switch(e){case"icon":n.emit("icon:hide");break;case"invite":n.emit("invite:hide");break;case"mess":n.emit("mess:hide");break;default:n.emit("icon:hide"),n.emit("invite:hide"),n.emit("mess:hide")}}var n=require("../base/emitter"),i=require("../base/lang");window.BaiduBridge={},BaiduBridge.openWebim=e,BaiduBridge.hide=t}),require(["front/api/main"],function(e){}),define("front/prevent/tpl",["require","exports"],function(require,exports){var e={secondVerify:'<ins class="#{wrap}">    <ins class="#{container}">        <ins class="#{text}">您确定要开始与客服沟通吗?</ins>        <ins class="#{button}">            <a class="#{confirmcode}" id="#{confirmcode}">确定</a>            <a class="#{cancle}" id="#{cancle}">取消</a>        </ins>    </ins></ins>',authCode:'<ins class="#{wrap}">    <ins class="#{container}">        <ins class="#{text}">输入验证码后，将为您开启在线咨询</ins>        <ins class="#{inputauth}" >            <input type="text" class="#{input}"id="#{input}" placeholder="输入下方验证码"/>            <a class="#{error}" id="#{error}"></a>        </ins>        <ins class="#{inputimg}">             <img class="#{authimg}"id="#{authimg}"/>             <a class="#{changeimg}" id="#{changeimg}">刷新</a>        </ins>        <ins class="#{button}" >             <a class="#{confirmcode}" id="#{confirmcode}">确定</a>             <a class="#{cancle}" id="#{cancle}">取消</a>    </ins></ins>'};return{secondVerify:e.secondVerify,authCode:e.authCode}}),define("front/prevent/const",["require","../common/view"],function(require){var e=require("../common/view"),t=e.getIdPre("prevent"),n=e.getClassPre("prevent");return function(e,i){return("id"===i?t:n)+e.toLowerCase()}}),define("qiao-im-sdk/messagePlugins/voice",["require"],function(require){var e,t,n={GET:'<span class="voice-tip">语音转译：</span><span>${voice}</span>'},exports={};return exports.decoder={voice:function(i){var r=e(i.c);return{type:"voice",text:t(n.GET,{voice:r.replace(/\r\n/gi,"<br/>").replace(/&amp;#xD;&amp;#xA;/gi,"<br/>").replace(/%2B/gi,"+")})}}},function(n){return e=n.lib.encodeHTML,t=n.lib.format,exports}}),define("qiao-im-sdk/messagePlugins/map",["require"],function(require){var e,t,n,i,r={GET:'<div class="map-location" data-type="map"><a href="http://map.baidu.com/mobile/webapp/place/marker/qt=inf&vt=map&act=read_share&code=/point=${point}&title=${title}&content=${c}"target="_blank"><img width="${width}" height="${height}"src="//api.map.baidu.com/staticimage?width=${width}&height=${height}&center=${lng},${lat}&markers=${lng},${lat}&zoom=15&markerStyles=-1,http://qiao.baidu.com/site/pinpc.png,-1" /><div>${content}</div></a></div>',GET_DEFAULT:'<div class="map-location" data-type="map"><span>${content}</span></div>',SEND:""},a={height:140,width:314,x:"",y:"",c:"内容",n:"标题"},exports={};return exports.decoder={map:function(n){t(a,n);var o=encodeURIComponent(a.c),s=encodeURIComponent(a.n),u=i(a.x,a.y,18),c=encodeURIComponent(u[0]+"|"+u[1]);if(""===a.x)return{type:"map",text:e(r.GET_DEFAULT,{content:a.c})};else return{type:"map",text:e(r.GET,{width:a.width,height:a.height,lng:a.x,lat:a.y,point:c,content:a.c,c:o,title:s})}}},function(r){var a=r.lib;return e=a.format,t=a.extend,n=a.pixelToLngLat,i=a.lngLatToPixel,exports}}),define("qiao-im-sdk/messagePlugins/img",["require"],function(require){var e,exports={},t={SEND:'<img md5="${md5}" token="${token}" bcsname="${name}" source="bcs" type="${type}" t="${imgtype}" n="screen"/>',GET:'<img data-fid="${bcsname}" src="${defaultImg}" data-type="img"/>'},n="//hqiao.baidu.com/f/pool/img/webim/loading.gif";return exports.decoder={img:function(i){return{type:"img",text:e(t.GET,{bcsname:i.bcsname,defaultImg:i.defaultImg||n})}}},exports.encoder={img:function(n){var i;return i=e(t.SEND,{md5:n.md5,token:n.token,name:n.fid,type:"img",imgtype:n.imgtype})}},function(t){return e=t.lib.format,exports}}),define("qiao-im-sdk/messagePlugins/meta/phone",["require","../../base/string"],function(require){var e=require("../../base/string").format,t=/((\+86)|(86))?1([0-9]{10})/g,n={ENCODE:'<text c="${text}" type="card" subtype="phone" />'},exports={};return exports.encode=function(i,r,a){return i=i.replace(t,function(t){return a&&a.push(e(n.ENCODE,{text:t})),r})},exports}),define("qiao-im-sdk/messagePlugins/meta/qq",["require","../../base/string"],function(require){var e=require("../../base/string").format,t=(require("../../base/string").encodeHTML,/[1-9][0-9]{4,14}/i),n={ENCODE:'<text c="${text}" type="card" subtype="qq" />'},exports={};return exports.encode=function(i,r,a){return i=i.replace(t,function(t){return a&&a.push(e(n.ENCODE,{text:t})),r})},exports}),define("qiao-im-sdk/messagePlugins/meta/tel",["require","../../base/string"],function(require){var e=require("../../base/string").format,t=/(([0-9]{7,8})|([0-9]{4}|[0-9]{3})-([0-9]{7,8})|([0-9]{4}|[0-9]{3})-([0-9]{7,8})-([0-9]{4}|[0-9]{3}|[0-9]{2}|[0-9]{1})|([0-9]{7,8})-([0-9]{4}|[0-9]{3}|[0-9]{2}|[0-9]{1}))/g,n={ENCODE:'<text c="${text}" type="card" subtype="tel" />'},exports={};return exports.encode=function(i,r,a){return i=i.replace(t,function(t){return a&&a.push(e(n.ENCODE,{text:t})),r})},exports}),define("qiao-im-sdk/messagePlugins/meta/email",["require","../../base/string"],function(require){var e=require("../../base/string").format,t=/(\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+)/gi,n={ENCODE:'<text c="${text}" type="card" subtype="email" />'},exports={};return exports.encode=function(i,r,a){return i=i.replace(t,function(t){return a&&a.push(e(n.ENCODE,{text:t})),r})},exports}),define("qiao-im-sdk/messagePlugins/meta/img",["require","../../base/string"],function(require){var e=require("../../base/string").format,t={SEND:'<img md5="${md5}" token="${token}" bcsname="${name}" source="bcs" t="${type}" n="screen"/>',GET:'<img data-fid="${bcsname}" src="${defaultImg}" />'},n=/(<img[^>]+(:?(:?data-token=[^>]+data-md5=[^>]*)|(:?data-md5=[^>]+data-token=[^>]*))>)/gi,exports={};return exports.encode=function(i,r,a){var o,s=document.createElement("div"),u="",c="",l="",d="";return i=i.replace(n,function(n,i){if(s.innerHTML=n,o=s.getElementsByTagName("img")[0],c=o.getAttribute("data-md5"),u=o.getAttribute("data-token"),l=o.getAttribute("data-fid"),d=o.getAttribute("data-type"),!(c&&u&&l&&"img"===d))return n;else return a&&a.push(e(t.SEND,{md5:c,token:u,name:l,type:"img"})),r})},exports}),define("qiao-im-sdk/messagePlugins/meta/font",["require","../../base/main"],function(require){function e(e){return e=e.substr(5)+e.substr(3,2)+e.substr(1,2),parseInt(e,16)}function t(t){if(c.test(t))return e(t);else if(l.test(t))return n(t);return 0}function n(t){t=t.substring(4,t.length-1),t=t.split(",");var n=parseInt(t[0],10),i=parseInt(t[1],10),r=parseInt(t[2],10);if(n=n.toString(16),1===n.length)n="0"+n;if(i=i.toString(16),1===i.length)i="0"+i;if(r=r.toString(16),1===r.length)r="0"+r;return t=("#"+n+i+r).toUpperCase(),e(t)}function i(e){var t=e;if(isNaN(t))return"";else return t=(+t).toString(16).toUpperCase(),t=(u.COLOR.substr(1)+t).substr(t.length),t=u.COLOR.substr(0,1)+t.substr(4)+t.substr(2,2)+t.substr(0,2)}var r=require("../../base/main"),a=r.extend,o=r.format,s={SEND:'<font n="${family}" c="${color}" s="${size}" b="${weight}" i="${style}" ul="${decoration}" />',GET:'<div style="font-family:${family};font-size:${size};color:${color};font-weight:${weight};font-style:${style};text-decoration:${decoration};"></div>'},u={COLOR:"#000000",SIZE_UNIT:"pt"},exports={},c=/^\#[\da-f]{6}$/i,l=/^[rgb|RGB]/;return exports.encode=function(e){var n=a({},e||{});return n.family=n.fontFamily||"simsun",n.size=parseInt(n.fontSize,10)||12,n.color=n.color?t(n.color):0,n.weight=n.fontWeight?1:0,n.style="italic"===n.fontStyle?1:0,n.decoration="underline"===n.fontDecoration?1:0,n=o(s.SEND,n)},exports.decode=function(e){var t=a({},e||{});return t.family=t.n,t.size=parseInt(t.s,10)<0?"":t.s+u.SIZE_UNIT,t.color=t.c?i(t.c):"",t.weight="1"===t.b?"bold":"",t.style="1"===t.i?"italic":"",t.decoration="1"===t.ul?"underline":"",t=o(s.GET,t)},exports}),define("qiao-im-sdk/messagePlugins/meta/url",["require","../../base/string"],function(require){var e=require("../../base/string").format,t=require("../../base/string").encodeHTML,n=/(\b((https?|ftp|file):\/\/)?[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,i=/(<img[^>]+>)/im,r={DECODE:'<a target="_blank" href="${href}">${content}</a>',ENCODE:'<url ref="${ref}" />'},exports={};return exports.encode=function(a,o,s){for(var u=[];i.test(a);)u.push(RegExp.$1),a=a.replace(RegExp.$1,""+(u.length-1)+"");var c={};a=a.replace(n,function(n,i,a){if(/.+\.(net|com|cn|cc|edu|me|co|org|club|online)/gi.test(n))if(n.indexOf("@")>0)return n;else return c.ref=("www"===a?"http://":"")+i.replace(/&amp;/g,"&"),c.ref=t(c.ref),s&&s.push(e(r.ENCODE,c)),o;return n});for(var l=0;l<u.length;l++)a=a.replace(""+l+"",u[l]);return a},exports.decode=function(t){var n={},i=t.ref||t.ref_2;n.href=(/^http/.test(i)?"":"http://")+i;var a=t.c||t.ref;return n.content=a.replace(/\r\n/gi,"<br>"),e(r.DECODE,n)},exports}),define("qiao-im-sdk/messagePlugins/meta/face",["require","../../base/main","../../lang"],function(require){function e(e){for(var t,n=0;t=s[n];n++)if(t.name===e.toLowerCase())return{name:e,img:o+t.md5};return null}var t=require("../../base/main"),n=require("../../lang"),i=t.format,r=t.indexOfArray,a=["微笑","大笑","偷笑","憨笑","得意","可爱","害羞","乖","淘气","调皮","流泪","大哭","撇嘴","闭嘴","嘘","鄙视","傲慢","白眼","思考","困","睡","汗","尴尬","惊讶","惊恐","疑问","晕","敲打","难过","委屈","色","抓狂","愤怒","吐","衰","再见","左拥抱","右拥抱","闪人","刀","吻","爱情","心碎","鲜花","枯萎","胜利","OK","大拇指","弱","握手","蛋糕","咖啡","吃饭","太阳","月亮","星星","便便","猪头","钱","Hi"],o="//hqiao.baidu.com/f/pool/img/webim/defaultface/png/",s=[{name:"微笑",md5:"face_01.png"},{name:"大笑",md5:"face_02.png"},{name:"偷笑",md5:"face_03.png"},{name:"憨笑",md5:"face_04.png"},{name:"得意",md5:"face_05.png"},{name:"可爱",md5:"face_06.png"},{name:"害羞",md5:"face_07.png"},{name:"乖",md5:"face_08.png"
},{name:"淘气",md5:"face_09.png"},{name:"调皮",md5:"face_10.png"},{name:"流泪",md5:"face_11.png"},{name:"大哭",md5:"face_12.png"},{name:"撇嘴",md5:"face_13.png"},{name:"闭嘴",md5:"face_14.png"},{name:"嘘",md5:"face_15.png"},{name:"鄙视",md5:"face_16.png"},{name:"傲慢",md5:"face_17.png"},{name:"白眼",md5:"face_18.png"},{name:"思考",md5:"face_19.png"},{name:"困",md5:"face_20.png"},{name:"睡",md5:"face_21.png"},{name:"汗",md5:"face_22.png"},{name:"尴尬",md5:"face_23.png"},{name:"惊讶",md5:"face_24.png"},{name:"惊恐",md5:"face_25.png"},{name:"疑问",md5:"face_26.png"},{name:"晕",md5:"face_27.png"},{name:"敲打",md5:"face_28.png"},{name:"难过",md5:"face_29.png"},{name:"委屈",md5:"face_30.png"},{name:"色",md5:"face_31.png"},{name:"抓狂",md5:"face_32.png"},{name:"愤怒",md5:"face_33.png"},{name:"吐",md5:"face_34.png"},{name:"衰",md5:"face_35.png"},{name:"再见",md5:"face_36.png"},{name:"左拥抱",md5:"face_37.png"},{name:"右拥抱",md5:"face_38.png"},{name:"闪人",md5:"face_39.png"},{name:"刀",md5:"face_40.png"},{name:"吻",md5:"face_41.png"},{name:"爱情",md5:"face_42.png"},{name:"心碎",md5:"face_43.png"},{name:"鲜花",md5:"face_44.png"},{name:"枯萎",md5:"face_45.png"},{name:"胜利",md5:"face_46.png"},{name:"ok",md5:"face_47.png"},{name:"大拇指",md5:"face_48.png"},{name:"弱",md5:"face_49.png"},{name:"握手",md5:"face_50.png"},{name:"蛋糕",md5:"face_51.png"},{name:"咖啡",md5:"face_52.png"},{name:"吃饭",md5:"face_53.png"},{name:"太阳",md5:"face_54.png"},{name:"月亮",md5:"face_56.png"},{name:"星星",md5:"face_55.png"},{name:"便便",md5:"face_57.png"},{name:"猪头",md5:"face_58.png"},{name:"钱",md5:"face_59.png"},{name:"hi",md5:"face_60.png"}],u={SEND:'<face n="${face}"/>',GET:'<img src="${img}" alt="${name}"/>'},c=/\[([^[\]]+)\]/g,exports={};return exports.encode=function(e,t,n){return e=e.replace(c,function(e,o){if(r(a,o)>=0)return n&&n.push(i(u.SEND,{face:o})),t;else return e})},exports.decode=function(t){var r;if(r=e(t.n))return i(u.GET,r);else return n.TEXT.FACE_UNSUPPORT},exports}),define("qiao-im-sdk/messagePlugins/text",["require","./meta/face","./meta/url","./meta/font","./meta/img","./meta/email","./meta/tel","./meta/qq","./meta/phone"],function(require){function e(e){var t=e.replace(/[\n\r]/g,"");return t=t.replace(/<(p|div)[^>]*>(<br\/?>|&nbsp;)<\/\1>/gi,"\n").replace(/<br\/?>/gi,"\n").replace(/<[^>\/]+>/g,"").replace(/(\n)?<\/([^>]+)>/g,function(e,t,n){return h[n.toLowerCase()]?"\n":t?t:""}).replace(/<[^>]+>/g,"").replace(/(\n)+/g,"<br />"),t.replace(g,"").replace(/\u00a0/g," ").replace(/&nbsp;/g," ")}function t(e,t){for(var n,r=t.length,a="",o=e,s=0;r>s;s++)n=t[s],e=n.encode(e,n.replaceStr,n.res),o=n.encode(o,""),a+=n.replaceStr+"|";e=i.encodeHTML(e),a=a.substring(0,a.length-1);var u,c=new RegExp(a,"g"),l=[],d=o.split("");e=e.replace(c,function(e){for(s=0;r>s;s++)if(n=t[s],u=n.replaceStr,e===u&&n.res[n.index])l.push(n.res[n.index++])}),r=d.length;var f=[];for(s=0;r>s;s++){if(n=d[s])f.push(i.format(p,{text:i.encodeHTML(n)}));if(n=l[s])f.push(l[s])}return e=f.join("")}function n(e,t){var n={encode:e,replaceStr:t,res:[],index:0};return n}var i,r=require("./meta/face"),a=require("./meta/url"),o=require("./meta/font"),s=require("./meta/img"),u=require("./meta/email"),c=require("./meta/tel"),l=require("./meta/qq"),d=require("./meta/phone"),f="text",p='<text c="${text}"/>',m='<span class="voice-tip">语音转译：</span><span>${voice}</span>',g=new RegExp("​","g"),h={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1},exports={};return exports.decoder={text:function(e){var t=i.encodeHTML(e.c);return{type:"text",text:t.replace(/\r\n/gi,"<br/>").replace(/&amp;#xD;&amp;#xA;/gi,"<br/>").replace(/%2B/gi,"+")}},card:function(e){var t=i.encodeHTML(e.c);return{type:"text",text:t.replace(/\r\n/gi,"<br/>").replace(/&amp;#xD;&amp;#xA;/gi,"<br/>").replace(/%2B/gi,"+")}},url:function(e){return{type:"url",text:a.decode(e)}},font:function(e){return{type:"font",text:o.decode(e)}},face:function(e){return{type:"face",text:r.decode(e)}},img:function(e){return{type:"text",text:"[图片]"}},html:function(t){return{type:"html",text:e(t.c)}},voice:function(e){var t=i.encodeHTML(e.c);return{type:"text",text:i.format(m,{voice:t.replace(/\r\n/gi,"<br/>").replace(/&amp;#xD;&amp;#xA;/gi,"<br/>").replace(/%2B/gi,"+")})}}},exports.encoder={text:function(e){var i=e.text,f=[];return f.push(n(r.encode,"\r")),f.push(n(s.encode,"")),f.push(n(a.encode,"")),f.push(n(d.encode,"")),f.push(n(l.encode,"")),f.push(n(c.encode,"\x00")),f.push(n(u.encode,"")),i=t(i,f),i=o.encode(e)+i}},exports.type=f,function(e){return i=e.lib,exports}}),define("qiao-im-sdk/plugins/errorLog",["require"],function(require){function e(){n.on("errorinfo",function(e){t.extendOwn(r,a.get()),t.img(i,{data:t.extend(e,r)})})}var t={},n={},exports={},i="//scqiao.baidu.com/front/error.gif",r={siteid:"",bid:"",sessionid:"",subid:"",appid:"",peerid:"",type:""},a={};return exports.init=function(i){t=i.lib,n=i.emitter,a=i.data,e()},exports}),define("qiao-im-sdk/plugins/file",["require","../util/bcs"],function(require){function e(e){v[e.fid]=e}function t(e,t){for(var n in v)if(n===e)if(!t)return v[n];else return v[n][t]}function n(){var e=Array.prototype.slice.call(arguments),t=w[e[0]];if(t)t.apply(null,e.slice(1))}function i(e){var t="00000000000000000000000000000000",n=e.name,i=e.size;g[e.fid]=new c;var a=l.extend({filepath:n,filesize:i||1,fid:e.fid},{filename:n.replace(/(.+)\.\w+$/,"$1"),filetype:"."+n.replace(/.+\.(\w+)$/,"$1"),filemd5:t,service:"cached",source:"bcs",role:"bridge_visitor",progress_notify:1,uri:"file/temp/"+t+"/"+i},b.sendFile);return l.ajax(y.URL_SENDFILE,{method:"post",data:l.extendOwn(a,d.get(),{username:d.get("userName")}),type:d.get("crossDomain")?"jsonp":"",onsuccess:r}),g[e.fid].promise()}function r(e){if("ok"===e.result)e.content.sign=d.get("session"),w.sendfileack(e.content)}function a(e){e&&(e.username=d.get("userName")),l.extendOwn(b.cancelFile,d.get(),e),l.ajax(y.URL_CANCELFILE,{method:"post",data:b.cancelFile,type:d.get("crossDomain")?"jsonp":""})}function o(e,t){if(m.file.sevReadyForDownload)if("agree"===t)w.sendfilestatus(m.file.sevData);var n={type:t,fid:e,username:d.get("userName")};l.ajax(y.URL_SENDFILEACK,{method:"post",data:l.extendOwn(b.sendFileAck,d.get(),n),type:d.get("crossDomain")?"jsonp":""})}function s(e){var t={fid:e.fid,size:e.size||1,ready_for_download:e.finished?1:0,token:e.token,bcsname:e.fid,username:d.get("userName")};l.ajax(y.URL_SENDFILE_STATUS,{method:"post",data:l.extendOwn(b.sendFileStatus,d.get(),t),type:d.get("crossDomain")?"jsonp":""})}function u(){f.on("pick",n),f.on("file:visitorsend",function(e,t){i({fid:e.fid,name:e.name,size:e.size}).then(function(e){return h[e]=new c,t&&t(d.STATUS.ACCEPT,{fid:e}),h[e].promise()},function(e){t&&t(d.STATUS.REJECT,{fid:e})}).then(function(e){t&&t(d.STATUS.STARTSEND,e)},function(e){t&&t(d.STATUS.FAIL,e)})}),f.on("file:visitorcancel",a),f.on("file:visitoraccept",function(e){o(e.fid,"agree")}),f.on("file:visitorreject",function(e){o(e.fid,"reject")}),f.on("file:visitorprogress",s),f.on("file:upload",function(e,t){p.getUploadPath({fid:e.fid,type:e.type||"PUT",siteid:d.get("siteid"),ucid:d.get("ucid")},function(e){t&&t(d.STATUS.STARTSEND,e)},function(e){t&&t(d.STATUS.FAIL,{info:"cannotupload"})})}),f.on("file:download",function(e,t){var n=e.fid,i=decodeURIComponent(e.token)||(new Date).getTime().toString(36);p.download({token:i,fid:n,siteid:d.get("siteid"),ucid:d.get("ucid")},function(e){t&&t(d.STATUS.SUCCESS,{url:e})},d.get("crossDomain")?"jsonp":"")})}var c,l={},d={},f={},p=require("../util/bcs"),m={file:{sevReadyForDownload:0}},g={},h={},v={},y={URL_SENDFILE:"/sendfile",URL_SENDFILEACK:"/sendfileack",URL_CANCELFILE:"/sendfilecancel",URL_SENDFILE_STATUS:"/sendfilestatus"},b={sendFile:{imuss:"",peerid:"",siteid:"",ucid:"",session:"",tag:"",username:""},cancelFile:{imuss:"",peerid:"",siteid:"",ucid:"",session:"",tag:"",username:"",fid:""},sendFileStatus:{imuss:"",peerid:"",siteid:"",ucid:"",session:"",tag:"",username:"",fid:"",size:"",uri:"",ready_for_download:0,source:"bcs",token:"",bcsname:""},sendFileAck:{imuss:"",peerid:"",siteid:"",ucid:"",session:"",tag:"",username:"",type:"",service:"cached",role:"bridge_visitor",progress_notify:0,fid:""}},w={};w.sendfileack=function(e){if(e){var t=e.type;if("agree"===t)p.getUploadPath({fid:e.fid,type:"POST",siteid:d.get("siteid"),ucid:d.get("ucid")},function(t){h[e.fid]&&h[e.fid].fulfill(t)},function(t){h[e.fid]&&h[e.fid].reject(t)}),g[e.fid]&&g[e.fid].fulfill(e.fid);if("reject"===t)g[e.fid]&&g[e.fid].reject(e.fid)}},w.sendfilecancel=function(e){f.emit("file:subcancel",e)},w.sendfile=function(t){if(t.ready_for_download){m.file.sevReadyForDownload=t.ready_for_download,m.file.sevData=t;var n=t.filename;t.filename=n.substring(0,n.lastIndexOf(".")),t.filesize=parseInt(t.filesize,10)}var i={fid:t.fid,name:t.filename,type:t.filetype,size:t.filesize,md5:t.filemd5,uri:t.uri};e(i),f.emit("file:subsend",i)},w.sendfilestatus=function(e){var n=decodeURIComponent(e.token)||(new Date).getTime().toString(36),i=e.bcsname||e.fid;if(e.ready_for_download)return void p.download({token:n,fid:i,siteid:d.get("siteid"),ucid:d.get("ucid")},function(r){f.emit("file:subprogress",{url:r,name:t(i,"name"),token:n,fid:i,type:e.type||"file",finish:1})},d.get("crossDomain")?"jsonp":"");else return void f.emit("file:subprogress",{fid:i,size:e.size,name:t(i,"name"),type:e.type||"file",finish:0})},w.peer_sendfileack=function(e){if(e){var t=d.get("peerid")+"";if(e.peerid===t)w.sendfileack(e);else f.emit("file:subpeerack",{fid:e.fid,type:e.type});if(!e.peerid&&"agree"===e.type)w.sendfilestatus(m.file.sevData)}};var exports={};return exports.init=function(e){l=e.lib,d=e.data,f=e.emitter,c=l.Resolver,u()},exports}),define("qiao-im-sdk/plugins/site",["require"],function(require){function e(e){n.ajax(a.GET_SITE_INFO,{data:n.extendOwn(o,i.get()),type:i.get("crossDomain")?"jsonp":"",onsuccess:function(t){var n={},r=t.data||{};if("1"===r.cust_dis&&r.cust)n.company=r.cust;if("1"===r.tel_dis&&r.tel)n.tel=r.tel;n.prologue=r.prologue,e&&e(i.STATUS.SUCCESS,n)},onfail:function(t){e&&e(i.STATUS.FAIL,t)}})}function t(){r.on("site:get",e)}var n={},i={},r={},a={GET_SITE_INFO:"/im/?module=im&controller=mobile&action=corporation"},o={ucid:"",siteid:""},exports={};return exports.init=function(e){n=e.lib,i=e.data,r=e.emitter,t()},exports}),define("qiao-im-sdk/plugins/sendLog",["require"],function(require){function e(e,t){if(l[e]||0===l[e])l[e]+="|"+t;else l[e]=t}function t(){l={status:"",st:"",msgid:""}}function n(){a.on("communicate",i),a.on("send",r)}function i(t,n){if("start"!==t)e("st",n.st),e("msgid",n.messageid)}function r(e,n){l.status=e,o.extendOwn(c,u.get(),l),o.img(s,{data:c}),t()}var a,o={},exports={},s="//scqiao.baidu.com/front/send.gif",u={},c={siteid:"",ucid:"",bid:"",visitType:1,appid:"",status:"",st:"",msgid:""},l={status:"",st:"",msgid:""};return exports.init=function(e){o=e.lib,a=e.emitter,u=e.data,n()},exports}),define("qiao-im-sdk/plugins/connectLog",["require"],function(require){function e(e,t){if(t)if(d[e])d[e]+="|"+t;else d[e]=t}function t(){d={startTime:"",es:"",ee:"",ei:"",ws:"",we:"",wi:"",bs:"",be:"",bi:""},s.extendOwn(l,d)}function n(t){o.on(t,function(n,i){switch(n){case"start":e(p[t],(new Date).getTime());break;case"success":if(e(m[t],(new Date).getTime()),i.tag)e(g[t],"prevent");break;case"fail":a(t,i),e(m[t],(new Date).getTime())}})}function i(){var e,t;for(t=0;e=f.eventList[t];t++)n(e);o.on("connect",r),o.on("init",function(e,t){if(e===c.STATUS.FAIL)r(t)})}function r(e,n){switch(e){case c.STATUS.SUCCESS:d.status="success";break;case c.STATUS.FAIL:d.status="fail"}s.extendOwn(l,c.get(),d),s.img(u,{data:l}),t()}function a(t,n){var i="";if(n){if(i=n.status||n.result,!i)i=n.tag?"prevent":"fail";if("undefined"!=typeof n.responseText)i+="|xhrstatus="+n.status,i+="|responseText="+n.responseText}else i="fail";e(g[t],i)}var o,s={},exports={},u="//scqiao.baidu.com/front/transfer.gif",c={},l={siteid:"",ucid:"",bid:"",visitType:1,appid:"",status:"fail",startTime:"",es:"",ee:"",ei:"",ws:"",we:"",wi:"",bs:"",be:"",bi:""},d={},f={eventList:["enter","welcome","bridgeinit"]},p={enter:"es",welcome:"ws",bridgeinit:"bs"},m={enter:"ee",welcome:"we",bridgeinit:"be"},g={enter:"ei",welcome:"wi",bridgeinit:"bi"};return exports.init=function(e){s=e.lib,o=e.emitter,c=e.data,i(),t(),d.startTime=(new Date).getTime()},exports}),define("qiao-im-sdk/core/rcv/leave",["require","../../base/main","../../model"],function(require){function e(){if(i.get("bid"))exports.data=t.extendOwn(a,i.get()),n(r.URL_LEAVE,{data:exports.data,type:i.get("crossDomain")?"jsonp":""})}var t=require("../../base/main"),n=t.img,i=require("../../model"),r={URL_LEAVE:"/Leave.php"},a={bid:"",peerid:"",siteid:"",ucid:"",tag:""},exports={};return exports.start=function(){e()},exports}),define("qiao-im-sdk/core/rcv/refresh",["require","../../base/main","../../model"],function(require){function e(){i(a.URL_REFRESH,{data:t.extendOwn(u,r.get()),type:r.get("crossDomain")?"jsonp":"",onsuccess:exports.handleRefresh})}var t=require("../../base/main"),n=t.Emitter,i=t.ajax,r=require("../../model"),a={URL_REFRESH:"/Refresh.php"},o=15e3,s=null,u={bid:"",peerid:"",siteid:"",ucid:"",tag:""},exports={};return n.mixin(exports),exports.handleRefresh=function(e){if(0===e.saved)return void clearInterval(s);else return void exports.emit("refresh","success",e)},n.mixin(exports),exports.start=function(){s=setInterval(e,o)},exports.stop=function(){clearInterval(s)},exports}),define("qiao-im-sdk/core/rcv/enter",["require","../../base/main","../../model"],function(require){function e(){exports.data=t.extendOwn(s,r.get(),exports.getVisitorCondition(),{vis_type:r.get("visitType")}),n(a.URL_ENTER,{data:exports.data,type:r.get("crossDomain")?"jsonp":"",onsuccess:exports.handleEnter,onfail:exports.handleEnterfail}),exports.emit("enter","start")}var t=require("../../base/main"),n=t.ajax,i=t.Emitter,r=require("../../model"),a={URL_ENTER:"/Enter.php",TYPE_VIS_PC:1,TYPE_VIS_MOBILE:2,TYPE_VIS_MINI:3,MAX_ENTER_COUNT:3,AGIN_ENTER_CODE:500,ENTER_FAIL_OP:2,ANTI_FORBID:1,ANTI_JSCODE:2,ANTI_SECOND:3,ANTI_AUTHCODE:4},o=0,s={bid:"",peerid:"",siteid:"",ucid:"",appid:"",tag:"",fromSite:"",expand:"",referrer:document.referrer,ex:"",iswebim:1,word:"",coding:"",bdclickid:"",title:"",inurl:"",vis_type:1,lang:"",rsl:"",tz:"",cbit:""},exports={};return i.mixin(exports),exports.getTimeZone=function(){var e=(new Date).getTimezoneOffset(),t=parseInt(e/60,10),n=e%60,i="-";if(0>t||0>n)if(i="+",t=-t,0>n)n=-n;return t+="",n+="","UTC"+i+t+":"+n},exports.getVisitorCondition=function(){var e=window.navigator,t=window.screen,n={};return n.lang=e.language||e.systemLanguage,n.rsl=t.width+"*"+t.height,n.tz=exports.getTimeZone(),n.cbit=t.colorDepth,n},exports.handleEnter=function(e){if(e.status||!e.tag&&1!==e.saved)return void exports.handleEnterfail(e);if(e.tag&&(+e.tag.op===a.ANTI_FORBID||+e.tag.op===a.ANTI_JSCODE))return void exports.handleEnterfail(e);else return void exports.emit("enter","success",e)},exports.handleEnterfail=function(t){if(exports.emit("enter","fail",t),500===t.status){if(o<a.MAX_ENTER_COUNT)return e(),void o++}else if(t.tag&&+t.tag.op===a.ANTI_JSCODE)return;exports.emit("connect","fail",t,"enter")},exports.start=function(t){e(),o=0},exports}),define("qiao-im-sdk/core/rcv/main",["require","../../base/main","./enter","./refresh","./leave","../../model","../../emitter","../prevent"],function(require){function e(e){c.set(e);for(var t in p)if(p.hasOwnProperty(t))a.set(t,e[t])}function t(){l.on("restart",function(){c.set("restart",!0),n()}),l.on("start",function(){n()}),l.on("config",function(e){if(!c.get("bid"))c.set(a.get());if(!f)n(),f=!0;m.handles=e||m.handles}),l.on("connect",function(e){if(e===c.STATUS.FAIL)f=!1}),l.on("endsession",function(){f=!1}),o.on("enter",function(t,n){if("success"===t){var i={bid:n.bid,peerid:n.peerid,imuss:n.bid,group:n.group,visSessionid:n.vis_sess_id};if(e(i),s.start(),!n.tag)l.emit("init",c.STATUS.SUCCESS,n)}if(n&&n.tag)d.setStatus(n),d.applyStatus(n,function(e,t){if(e===c.STATUS.FAIL)return void l.emit("forbid",t,"init");if(e===c.STATUS.ANTIATTACK){var n=m.handles&&m.handles.onAntiAttack;n&&n(t)}});l.emit("enter",t,n),f=!1}),o.on("connect",function(e,t){if("fail"===e)f=!1,t=i.extend({},t,{pack:"enter"}),l.emit("init",c.STATUS.FAIL,t)}),s.on("refresh",function(e,t){if("success"===e)if(t.tag)d.setStatus(t)})}function n(){s.stop(),o.start()}var i=require("../../base/main"),r=i.Storage,a=new r("rcv"),o=require("./enter"),s=require("./refresh"),u=require("./leave"),c=require("../../model"),l=require("../../emitter"),d=require("../prevent"),f=!1,p={bid:"",imuss:""},m={};t();var exports={};return exports.leave=function(){u.start(c.get())},exports.restart=function(){c.set("restart",!0),n()},exports}),define("qiao-im-sdk/util/group",["require","../lang"],function(require){function e(e,t,n){for(var i,r,a=0;i=t[a];a++)for(var o=0;r=i.user[o];o++)if(+r.subid===+e)return n?r.subname:i.groupname;return""}var t=require("../lang"),n={COMPANY:0,GROUP:1,SUBNAME:2,CUSTOM:3},exports={};return exports.getShowSubNameById=function(i,r,a,o){var s;switch(a.csNameType){case n.COMPANY:s=a.compName;break;case n.CUSTOM:s=a.customName;break;case n.GROUP:s=e(i,r);break;default:s=e(i,r,!0)}return s||o||t.TEXT.CSNAME_DEFAULT},exports}),define("qiao-im-sdk/core/im/aiPrologue",["require","../../base/main","../../model"],function(require){var e=require("../../base/main"),t=e.ajax,n=e.Emitter,i=require("../../model"),r={URL:"//hqiao.baidu.com/v3/?module=default&controller=intelligentPrologue&action=aiPrologue"},a={siteid:"",ucid:"",subid:"",imuss:"",sessionid:""},o={},exports={};return n.mixin(exports),exports.getAiPrologue=function(n){o.ucid=n.ucid?n.ucid:i.get("ucid"),o.siteid=n.siteid?n.siteid:i.get("siteid"),o.subid=n.subid?n.subid:i.get("subid"),o.imuss=n.bid?n.bid:i.get("bid"),o.sessionid=n.sessionid?n.sessionid:i.get("sessionid"),t(r.URL,{data:e.extendOwn(a,i.get(),o),type:"jsonp",hasDomain:!0,onsuccess:function(t){if(0===t.status)i.aiPrologueContent=t.data;else if(1===t.status)i.set("isAiPrologue",0);else exports.emit("errorinfo",e.extend(o,{type:"aiPrologue"}))},onfail:function(t){exports.emit("errorinfo",e.extend(o,{type:"aiPrologue"}))}})},exports}),define("qiao-im-sdk/lang",[],function(){var exports={};return exports.TEXT={FILE_UNSUPPORT:"[文件]",FACE_UNSUPPORT:"[扩展头像]",IMG_UNSUPPORT:"[图片]",CFACE_UNSUPPORT:"[自定义头像]",CSNAME_DEFAULT:"在线客服",CSNAME_GROUP:"默认分组",CONNECT_FORBID:"网络繁忙,请您重试",TEXT_QUEUE:"欢迎光临！您已经进入服务队列，请您稍候，马上为您转接您的在线咨询顾问。"},exports}),define("qiao-im-sdk/core/prevent",["require","../emitter","../model","../base/main","../lang"],function(require){function e(e){var t="return "+e,n=new Function(t),i=n();if("function"==typeof i)o.jscode=i();else o.jscode=i}var t=require("../emitter"),n=require("../model"),i=require("../base/main"),r=require("../lang"),a={FORBID:1,JSCODE:2,SECOND:3,AUTHCODE:4},o={jscode:"",checkcode:""},s="",u={check:"/atverifycode",get:"/atgetcode"},c={verify:{bid:"",peerid:"",siteid:"",ucid:"",tag:"",val:"",codeId:""},getAuthCode:{bid:"",peerid:"",siteid:"",ucid:"",tag:""}},exports={};return exports.applyStatus=function(e,i){var o={};if(e.content&&e.content.tag)o=e.content.tag;else if(e.tag)o=e.tag;switch(o.op){case a.AUTHCODE:exports.getAuthCode(function(e,t){if(e===n.STATUS.SUCCESS)i&&i(n.STATUS.ANTIATTACK,{type:"auth",url:t.url})});break;case a.SECOND:i&&i(n.STATUS.ANTIATTACK,{type:"second"});break;case a.FORBID:i&&i(n.STATUS.FAIL,{statusInfo:r.TEXT.CONNECT_FORBID,type:"forbid"});break;case a.JSCODE:t.emit("start")}},exports.setStatus=function(t){var i;if(t.content&&t.content.tag)i=t.content.tag;else if(t.tag)i=t.tag;var r=i.op;switch(r){case a.JSCODE:e(i.val),n.set("tag",{jscode:o.jscode});break;case a.AUTHCODE:if(i.val)u.check="/"+i.val.checkurl,u.get="/"+i.val.geturl}},exports.verify=function(e,t){if("second"===e.type)t&&t(n.STATUS.SUCCESS,{type:"second"});else if("auth"===e.type)o.checkcode=e.code,n.set("tag",o),i.ajax(u.check,{data:i.extendOwn(c.verify,n.get(),{val:e.code,codeId:s}),type:n.get("crossDomain")?"jsonp":"",onsuccess:function(e){if(e&&e.status)return void(t&&t(n.STATUS.FAIL,{type:"auth"}));else return void(t&&t(n.STATUS.SUCCESS,{type:"auth"}))},onfail:function(e){t&&t(n.STATUS.FAIL,{type:"auth"})}})},exports.getAuthCode=function(e){i.ajax(u.get,{data:i.extendOwn(c.getAuthCode,n.get()),type:n.get("crossDomain")?"jsonp":"",onsuccess:function(t){if(t&&t.status)return void(e&&e(n.STATUS.FAIL,t));else return s=t.body.codeid,void(e&&e(n.STATUS.SUCCESS,{url:t.body.url}))},onfail:function(t){e&&e(n.STATUS.FAIL,t)}})},exports}),define("qiao-im-sdk/core/im/end",["require","../../base/main","../../model"],function(require){function e(){n(a,{data:exports.data,type:i.get("crossDomain")?"jsonp":""})}var t=require("../../base/main"),n=t.img,i=require("../../model"),r={imuss:"",peerid:"",siteid:"",ucid:"",session:"",tag:""},a="/logout",exports={data:{},start:function(){exports.data=t.extendOwn(r,i.get()),e()}};return exports}),define("qiao-im-sdk/core/im/send",["require","../../base/main","../../message","../../model"],function(require){function e(e){if(e.count<f.STOP_SEND_COUNT)i(e),clearTimeout(g),g=setTimeout(function(){exports.startResend()},f.TIME_RESEND);else a(e,"fail",{info:"重试多次失败"});e.count++}function t(e){var t=[].slice.call(arguments,1);return function(){var n=[[].slice.call(arguments)[0]].concat(t);if(!n||!n[0])return void(e&&e("fail"));var i=n[0],r=i.result;if(r&&"ok"===r.toLowerCase())n=["success"].concat(n),e&&e.apply(null,n);else{if(n=["fail"].concat(n),!r)i.result="error";e&&e.apply(null,n)}}}function n(e,n,i){var r=s.extendOwn(p.msgextend,d.get(),{body:e.body,time:e.time||+new Date,msgtype:e.msgtype,count:e.count,to:d.get("userName"),type:n});u(f.URL_EXTEND,{method:"post",type:d.get("crossDomain")?"jsonp":"",data:r,onsuccess:t(exports.handleCallback,i),onfail:t(exports.handleCallback,i)})}function i(e){exports.data=s.extendOwn(p.send,d.get(),{body:e.body,time:e.time||+new Date,messageid:e.messageid,msgtype:e.msgtype,count:e.count,to:d.get("userName")}),u(f.URL_SAY,{method:"post",type:d.get("crossDomain")?"jsonp":"",data:s.extend(exports.data,{st:(new Date).getTime()}),onsuccess:t(exports.handleSend,e),onfail:t(exports.handleSend,e)}),exports.emit("communicate","start",e)}function r(e,t){u(f.URL_ACK,{method:"post",type:d.get("crossDomain")?"jsonp":"",data:s.extendOwn(p.ackMsg,d.get(),{to:d.get("userName"),to_sub:t||0,ackid:e})})}function a(e,t,n){var i=e.time,r=s.indexOfArray(h,i,"time");if(r>=0)s.removeAtArray(h,r);if(exports.startResend(),"fail"===t)e.onfail&&e.onfail(n),exports.emit("send","fail",i);else e.onsuccess&&e.onsuccess(n),exports.emit("send","success",i)}function o(){s.event.on(window,"online",function(){v=!0,exports.startResend()}),s.event.on(window,"offline",function(){v=!1,clearTimeout(g)})}var s=require("../../base/main"),u=s.ajax,c=s.Emitter,l=require("../../message"),d=require("../../model"),f={TIME_RESEND:3e3,URL_SAY:"/communicate",URL_PREVIEW:"/scenemsg",URL_ACK:"/msgack",URL_EXTEND:"/msgextend",STOP_SEND_COUNT:3},p={send:{imuss:"",peerid:"",siteid:"",ucid:"",session:"",tag:"",to:"",tid:"",body:"",time:"",msgtype:0,messageid:"",auto_subid:"",count:0,st:""},scenemsg:{imuss:"",peerid:"",siteid:"",ucid:"",seq:0,session:"",tag:"",to:"",body:""},ackMsg:{imuss:"",peerid:"",siteid:"",ucid:"",seq:0,session:"",tag:"",from:"",to:"",to_sub:"",ackid:""},msgextend:{imuss:"",peerid:"",siteid:"",ucid:"",session:"",tag:"",to:"",tid:"",body:"",time:"",type:""}},m={canSendPreview:!1},exports={};c.mixin(exports);var g,h=[],v=!0;exports.handleSend=function(e,t,n){if("success"===e)exports.emit("communicate","success",n),a(n,"success",t);else exports.emit("communicate","fail",n,t)},exports.handleCallback=function(e,t,n){if("success"===e)n&&n(d.STATUS.SUCCESS,t);else n&&n(d.STATUS.FAIL,t)},exports.sendPreview=function(e,n){if(e)if(m.canSendPreview)l.comParser.encode({type:"text",text:e},function(e){u(f.URL_PREVIEW,{method:"post",type:d.get("crossDomain")?"jsonp":"",data:s.extendOwn(p.scenemsg,d.get(),{body:e,to:d.get("userName")}),onsuccess:t(exports.handleCallback,n),onfail:t(exports.handleCallback,n)})})};var y=0;return exports.say=function(e,t,r,a){var o={body:e,time:t.time||+new Date,messageid:y++,msgtype:t.msgtype||0,count:0};if(d.get("inittype"))o.auto_subid=d.get("subid");var u=s.clone(o);if("msg"!==r&&e)return void n(u,r,a);if(h.push(u),v)clearTimeout(g),g=setTimeout(function(){exports.startResend()},f.TIME_RESEND),i(u)},exports.startResend=function(){if(h.length>0)e(h[0])},exports.switchPreviewStatus=function(e){m.canSendPreview=e},exports.ackMsg=r,exports.config=m,exports.start=function(){o()},exports}),define("qiao-im-sdk/core/im/history",["require","../../base/main","../../message","../../model","../../util/filters/repeat"],function(require){function e(e,n){var r={messages:[]};r.hisTime=e.histime,r.hasFinished=e.finished;var s=e.content.fields;if(s&&i.isArray(s))for(var u,c=s.length,l=0;c>l;l++)if(u=s[l],!a.doFilter(u,o.get(),d))t(u,o.get(),d,r);n(r)}function t(e,t,n,i){a.comParser.decode(e.content,t,n,function(t){var n={},r=e.category||0;n.wordType=c[r],n.data=t,n.showName=e.from_alias,n.time=e.time,n.speakerType=""===n.showName?"visitor":"server",i.messages.push(n)})}function n(e,t,n){r(s.URL_HIS,{data:i.extendOwn(u,o.get(),e),type:o.get("crossDomain")?"jsonp":"",onsuccess:function(e){if(0===e.status){var i=e.data;if(!i||!i.content)return;t(i)}else n(e)},onfail:n})}var i=require("../../base/main"),r=i.ajax,a=require("../../message"),o=require("../../model"),s={URL_HIS:"/im/?module=im&controller=web&action=getWebMsg",DEFAULT_SIZE:10},u={siteid:"",ucid:"",tag:"",sessionid:"",visSessionid:"",imuss:"",s:"",e:"",size:s.DEFAULT_SIZE},c=["word","welcome","autoReply","autoReply"],l={},d=new a.Filter,f=require("../../util/filters/repeat");d.addFilter("time",f.time),d.addType("img","[图片]");var exports={};return exports.getUnread=function(e,t,i){l.imuss=o.get("imuss"),l.sessionid=o.get("sessionid"),l.visSessionid=o.get("visSessionid"),l.s=e.s||0===e.s?e.s:"",l.e=e.e||0===e.e?e.e:"",l.size=e.size?e.size:o.get("hisMsgCount")||s.DEFAULT_SIZE;var r=[];n(l,function(e){for(var n,i,a=e.content.fields.reverse(),o=a.length,s={hisTime:e.histime,hasFinished:e.finished},u=0;o>u;u++)if(n=a[u],i=n.command,"message"===i||"peer_message"===i)r.push(n);t(r,d,s)},i)},exports.get=function(t,i){l.visSessionid=t.visSessionid?t.visSessionid:o.get("visSessionid"),l.sessionid=t.sessionid?t.sessionid:o.get("sessionid"),l.imuss=t.bid?t.bid:o.get("bid"),l.s=t.s||0===t.s?t.s:"",l.e=t.e||0===t.e?t.e:"",l.size=t.size?t.size:o.get("hisMsgCount")||s.DEFAULT_SIZE,n(l,function(t){e(t,function(e){i&&i(o.STATUS.SUCCESS,e)})},function(e){i&&i(o.STATUS.FAIL,e)})},exports.filter=d,exports}),define("qiao-im-sdk/util/filters/repeat",["require"],function(require){var e={},t={},n={WELCOME:1},exports={};return exports.welcome=function(t){var i=t.showOnceType||t.category;if(i===n.WELCOME){if(e[i])return!0;e[i]=!0}return!1},exports.time=function(e){var n=e.time;if(!n)return!1;if(t[n])return!0;else return t[n]=!0,!1},exports.self=function(e,t){return!("peer_message"!==e.command||+e.peerid!==+t.peerid)},exports}),define("qiao-im-sdk/core/im/receive",["require","../../base/main","../../message","../../model","../../util/net","../../util/filters/repeat"],function(require){function e(e){exports.emit("network",s.extend(e,{netType:"receive",token:v,ack:o}))}function t(e){var t=[].slice.call(arguments,1);return function(){var n=[[].slice.call(arguments)[0]].concat(t);if(!n||!n[0])return void e("fail");var i=n[0],r=i.result;if(r&&"ok"===r.toLowerCase())n=["success"].concat(n),e&&e.apply(null,n);else{n=["fail"].concat(n);try{if(!r)i.result="error"}catch(a){}e&&e.apply(null,n)}}}function n(){if(!h)v++,h=u(w.URL_PICK,{method:"post",type:d.get("crossDomain")?"jsonp":"",data:s.extendOwn(g,d.get(),{ack:o}),onsuccess:t(exports.handlePick,v),onfail:t(exports.handlePick,v)}),y=setTimeout(i,w.TIME_OUT_PICK),e({because:E.START})}function i(){r(),n(),e({because:E.TIMEOUT})}function r(){clearTimeout(y),p=!0;try{if(h&&h.abort)h.abort()}catch(e){}h=null}function a(){m=new l.Filter;var e=require("../../util/filters/repeat");m.addFilter("welcome",e.welcome),m.addFilter("self",e.self),m.addFilter("time",e.time),_=new f(x.UNLIMITED_TIMES)}var o,s=require("../../base/main"),u=s.ajax,c=s.Emitter,l=require("../../message"),d=require("../../model"),f=require("../../util/net").Mode,p=!1,m=null,g={imuss:"",peerid:"",siteid:"",ucid:"",session:"",tag:"",ack:""},h=null,v=0,y=null,b=!1,w={TIME_OUT_PICK:4e4,URL_PICK:"/pick",COOKIE_ACK:"QIAO_COOKIE_ACK"},exports={};c.mixin(exports);var _,x={ONLY_ONE:0,LIMIT_TIMES:1,UNLIMITED_TIMES:2},T=!1,E={START:"start",TIMEOUT:"timeout",FAIL:"fail",SUCCESS:"success",KICK:"kick",EMPTY:"empty",TOKEN:"token"};return exports.pickSuccess=function(e){var t=e.content;if(T=!1,t){var n=t.fields;if(n&&s.isArray(n)){t.ack&&(o=t.ack);for(var i,r,a=n.length,u=0;a>u;u++){if(i=n[u],r=i.command,"message"===r||"peer_message"===r)exports.emit("pick","message",i,m);else if("communicatetransfernotify"===r){var c=r.replace(/notify$/,"");exports.emit("pick",c,i)}else{var c=r.replace(/notify$/,"");if(exports.emit("pick",c,i.content),"kick"===c)T=!0}exports.emit("ack",i.time,i.from)}}exports.emit("pick","success",e)}},exports.pickFail=function(e){exports.emit("pick","fail",e)},exports.handlePick=function(t,i,r){if(!i)return h=null,clearTimeout(y),exports.pickFail(i),_.tryAgin(n),void e({because:E.EMPTY});if(r!==v)return void e({because:E.TOKEN,info:"token"+r});clearTimeout(y);var a=i.result;if("success"===t){if(exports.pickSuccess(i),h=null,!b)setTimeout(n,_.DELAY_TIME);if(T)exports.reset();_.reset(),e({because:E.SUCCESS})}else if("offline"===a||"kicked"===a){if(exports.emit("pick","stop"),h=null,!b)setTimeout(n,_.DELAY_TIME);exports.reset(),_.reset(),e({because:E.KICK,info:a})}else{if(exports.pickFail(i),h=null,!p)_.tryAgin(n);e({because:E.FAIL,info:a})}if("offline"===a||"kicked"===a)exports.emit("pick","restart")},exports.stop=function(){b=!0,r()},exports.reset=function(){b=!1},a(),exports.start=function(e){o=e,n()},exports.filter=m,exports}),define("qiao-im-sdk/util/net",["require","../base/main"],function(require){function e(e,t){t=t||{},this.FAIL_TIME_LIMIT=t.FAIL_TIME_LIMIT||10,this.DELAY_TIME=t.DELAY_TIME||0,this.FAIL_DELAY_TIME=t.FAIL_DELAY_TIME||2e3,this.mode=e,this.count=0}var t=require("../base/main"),exports={},n={ONLY_ONE:0,LIMIT_TIMES:1,UNLIMITED_TIMES:2},i=e.prototype;i.reset=function(){this.count=0},i.tryAgin=function(e){switch(this.count++,this.mode){case n.LIMIT_TIMES:if(this.count>=this.FAIL_TIME_LIMIT)return;else setTimeout(e,this.DELAY_TIME);break;case n.UNLIMITED_TIMES:if(this.count>=this.FAIL_TIME_LIMIT)setTimeout(e,this.FAIL_DELAY_TIME);else setTimeout(e,this.DELAY_TIME)}};var r=function(){var e=!1;if(e="complete"===document.readyState,document.documentElement.doScroll)try{document.documentElement.doScroll("left"),e=!0}catch(t){e=!1}return e};return exports.pageOnload=function(e){if(e=e||{},e.isPageOnload=!1,r())e.isPageOnload=!0;else t.event.on(window,"load",function(){e.isPageOnload=!0})},exports.Mode=e,exports}),define("qiao-im-sdk/core/im/connect",["require","../../base/main","../../model","../../util/net"],function(require){function e(){if(f.isPageOnload)clearTimeout(m),t();else m=setTimeout(function(){e()},p)}function t(){a(l.URL_WELCOME,{method:"post",type:s.get("crossDomain")?"jsonp":"",data:i.extendOwn(d.welcome,s.get(),exports.data),onsuccess:exports.welcomeSuccess,onfail:exports.welcomeFail}),exports.emit("welcome","start")}function n(){a(l.URL_BRIDGEINIT,{method:"post",type:s.get("crossDomain")?"jsonp":"",data:i.extendOwn(d.bridgeinit,s.get(),exports.data),onsuccess:exports.initSuccess,onfail:exports.initFail}),exports.emit("bridgeinit","start")}var i=require("../../base/main"),r=i.Emitter,a=i.ajax,o=i.isNumber,s=require("../../model"),u=require("../../util/net"),c=u.pageOnload,l={URL_WELCOME:"/welcome",URL_BRIDGEINIT:"/bridgeinit",TYPE_SUB:0,TYPE_GROUP:1,
TYPE_SITE:3,TYPE_INVITE:4,TYPE_CLIENT_PC:1,TYPE_CLIENT_MOBILE:2,TYPE_CLIENT_MINI:3},d={welcome:{imuss:"",peerid:"",siteid:"",ucid:"",session:"",tag:"",appid:"",source:0,anonym:!0,clienttype:i.isMobile()?l.TYPE_CLIENT_MOBILE:l.TYPE_CLIENT_PC},bridgeinit:{imuss:"",peerid:"",siteid:"",ucid:"",session:"",tag:"",username:"1",type:l.TYPE_SITE,chattype:1,sub:"",bridgetid:"",fromsite:document.referrer,srcword:"",wordtype:0,wordid:0,region:"",insite:document.referrer,title:"",inittype:""}},f={},p=100,m=null,exports={data:{},welcomeSuccess:function(e){if("ok"!==e.result)return void exports.welcomeFail(e);if(e.content.tag)return void exports.welcomeFail(e);else return exports.emit("welcome","success",e),void n()},welcomeFail:function(e){exports.emit("welcome","fail",e)},initSuccess:function(e){if("ok"!==e.result&&"wait"!==e.result)return void exports.initFail(e);else return void exports.emit("bridgeinit","success",e)},initFail:function(e){exports.emit("bridgeinit","fail",e)},start:function(){exports.initData(),c(f),e()}};return r.mixin(exports),exports.initData=function(){var e={subid:s.get("distSubid"),groupid:s.get("distGroupid"),ptid:s.get("ptid"),referrer:s.get("referrer"),word:s.get("word"),from:s.get("from"),location:s.get("location"),userName:s.get("userName"),chatType:s.get("chatType")},t=d.bridgeinit,n=o(e.subid)?e.subid:t.sub,i=o(e.groupid)?e.groupid:t.bridgetid,r=t.type;if(o(n))r=l.TYPE_SUB;else if(o(i))r=l.TYPE_GROUP;else i=o(e.ptid)?e.ptid:t.bridgetid;if(e.chatType-0===l.TYPE_INVITE)r=l.TYPE_INVITE;exports.data={sub:n,bridgetid:i,type:r,fromsite:e.referrer||t.fromsite,srcword:e.word||t.srcword,region:e.from||t.region,insite:e.location||t.insite,username:e.userName||t.username}},exports}),define("qiao-im-sdk/core/im/main",["require","./connect","./receive","./history","./send","./end","../prevent","./aiPrologue","../../base/main","../../util/group","../../message","../../model","../../emitter","../../lang"],function(require){function e(e){_.set(e);for(var t in E)if(E.hasOwnProperty(t))T.set(t,e[t])}function t(){e({session:""}),M=!0,D=!1}function n(){d.stop(),t()}function i(){var e=Array.prototype.slice.call(arguments),t=k[e[0]];if(t)t.apply(null,e.slice(1));else{var n=[].concat(["pick"],e);x.emit.apply(x,n)}}function r(e,t,n){var i,r=e.content,a=e.from_sub,o=e.from_alias,s=e.time_server_ms||parseInt(e.systimestr/1e3,10)||e.time,u=e.command,c={};c.speakerType="server";var l=e.csWordType||e.category||0;if(c.wordType=I[l]||l,n&&n.hisTime)c.messageType="history",i=o,c.hisTime=n.hisTime,c.hasFinished=n.hasFinished,c.speakerType=""===i?"visitor":"server";else if("peer_message"===u)c.speakerType="visitor";else{var d=_.get("isAiPrologue");if(d&&"welcome"===c.wordType)if(_.aiPrologueContent)r[1].c=_.aiPrologueContent,r[1].type="html";else setTimeout(function(){_.aiPrologueContent&&(r[1].c=_.aiPrologueContent)},1e3);i=b.getShowSubNameById(a,_.get("group"),_.get())}if(!w.doFilter(e,_.get(),t))if(w.comParser.decode(r,_.get(),t,function(e){x.emit("message",e,i,s,c)}),x.emit("message:origin",r,i,s,c),"peer_message"===u)for(var f,p=0;f=r[p];p++)if("img"===f.type)x.emit("pick","sendfilestatus",{token:f.token,fid:f.bcsname,ready_for_download:1,type:"img"})}function a(e,t,n){for(var i,a=0;i=e[a];a++)r(i,t,n)}function o(e){var t=_.get("hisMsgCount"),n=_.get("restart");if(t&&!n)f.getUnread({s:"",e:"",size:t},function(t,n,i){a(t,n,i),d.start(e.pickseq||"")},function(){d.start(e.pickseq||"")});else d.start(e.pickseq||"")}function s(t){var n=t.subid||t.new_subid,i=t.tid||t.new_tid;if(void 0!==i&&i!==_.get("tid"))e({tid:i,groupid:i});if(void 0!==n&&n!==_.get("subid"))e({subid:n})}function u(){d.on("pick",i),d.on("ack",p.ackMsg),l.on("welcome",function(e,t){if(x.emit("welcome",e,t),"success"===e){if(t&&t.content&&t.content.session)_.set("session",t.content.session)}else if("fail"===e)if(t=v.extend({},t,{pack:"welcome"}),D=!1,M=!0,t&&t.content&&t.content.tag)g.setStatus(t),g.applyStatus(t,function(e,t){if(e===_.STATUS.FAIL)return void x.emit("forbid",t,"connect");if(e===_.STATUS.ANTIATTACK){var n=C.handles&&C.handles.onAntiAttack;n&&n(t)}});else x.emit("connect",_.STATUS.FAIL,t)}),l.on("bridgeinit",function(e,t){if(x.emit("bridgeinit",e,t),"success"===e){var n=t.content;s(n),n.sessionid&&_.set("sessionid",n.sessionid);var i=_.get("isAiPrologue");if(void 0!==n.subid&&i)h.getAiPrologue({});if(p.start(_.get()),D=!0,n.waitStatus=!1,t.customName=b.getShowSubNameById(t.content.subid,_.get("group"),_.get()),x.emit("connect",_.STATUS.SUCCESS,t),+n.sessionid&&x.emit("taskbegin",n),t.result&&"wait"===t.result.toLowerCase())n.waitStatus=!0,x.emit("wait");o(n)}else if("fail"===e)if(t=v.extend({},t,{pack:"bridgeinit"}),D=!1,M=!0,"block"!==t.result)x.emit("connect",_.STATUS.FAIL,t)}),p.on("communicate",function(e,t){x.emit("communicate",e,t)}),p.on("send",function(e,t){x.emit("send",e,t)}),x.on("config",function(e){C.handles=e||C.handles}),d.on("network",function(e){x.emit("network",e)})}function c(){T.clear()}var l=require("./connect"),d=require("./receive"),f=require("./history"),p=require("./send"),m=require("./end"),g=require("../prevent"),h=require("./aiPrologue"),v=require("../../base/main"),y=v.Storage,b=require("../../util/group"),w=require("../../message"),_=require("../../model"),x=require("../../emitter"),T=(require("../../lang"),new y("im")),E={session:"",keep:0},S={STATUS_NORMAL:0,STATUS_WAIT:1,TIME_OFFLINE:13e4,ERROR_INIT_WELCOME:1,ERROR_INIT_BRIDGE:2,OVER_TYPE_KICK:1,OVER_TYPE_FORCE:2,HAS_HIS_MSG:1,CS_STATUS_WAIT:3,CHAT_TIME_OUT:12e4,COOKIE_ACK:"QIAO_COOKIE_ACK",COOKIE_ACK_TIME:3e4,STOP_TYPE_KICK:"kick",STOP_TYPE_FORCE:"force"},C={},I={0:"word",1:"welcome",2:"autoReply",3:"autoReply",7:"wait"},L={MSG:1,TRACE:1,SYSTEMMSG:1},k={},M=!0,D=!1;k.success=function(e){var t=e.content;if(t)T.set("lastTime",(new Date).getTime()),x.emit("tunnel",e)},k.stop=function(){n()},k.restart=function(){d.reset(),x.emit("restart")},k.scenefocus=function(){if(!_.get("inittype"))p.switchPreviewStatus(!0)},k.sceneunfocus=function(){p.switchPreviewStatus(!1)},k.scenemsg=function(){x.emit("inputing")},k.communicatetransfer=function(e){var t=e.content;s(t);var n=e.extend||{},i=n.adata;if(t.customName=b.getShowSubNameById(t.new_subid,_.get("group"),_.get()),i){var r=i.transfer||{};if(r.status)x.emit("transfer",t)}else x.emit("transfer",t)},k.kick=function(e){if(n(),e&&+e.type===S.OVER_TYPE_KICK)x.emit("endsession","kick");else if(e&&+e.type===S.OVER_TYPE_FORCE)x.emit("endsession","force")},k.assigntaskack=function(e){s(e)},k.taskbegin=function(e){s(e),_.set("sessionid",e.sessionid),x.emit("taskbegin",e)},k.message=function(e,t){r(e,t)},u();var exports={};return exports.connect=function(e,t){if(M)M=!1,e&&_.set(e),l.start(),C.handles=t||C.handles},exports.send=function(e,t,n){if(t=t||"msg",!L[t.toUpperCase()])return void(n&&n("fail",{info:"未传递正确类型"}));if(v.isString(e))e={type:"text",text:e};w.comParser.encode(e,function(i){p.say(i,e,t,n)})},exports.disconnect=function(){if(D)d.stop(),m.start(),t(),c(),d.reset()},exports.hasConnected=function(){return!M},exports.getHistory=function(e,t){f.get(e,t)},exports.sendPreview=function(e,t){p.sendPreview(e,t)},exports.verify=function(e,t){g.verify(e,function(e,n){if(e===_.STATUS.SUCCESS)exports.connect();t(e,n)})},exports.getAuthCode=function(e){g.getAuthCode(e)},exports.msgFilter=function(){return d.filter}(),exports.historyFilter=function(){return f.filter}(),exports}),define("qiao-im-sdk/util/bcs",["require","../base/main"],function(require){function e(e,i,r){var a={siteid:e.siteid,ucid:e.ucid,file:e.fid,sign:e.sign||""},o=n.URL_UPLOAD+e.type;t.ajax(o,{data:a,onsuccess:i,onfail:r})}var t=require("../base/main"),n={URL_UPLOAD:"/im/?module=im&controller=frontUrl&action=uploadUrl&app_type=web&m=",URL_DOWNLOAD:"/im/?module=im&controller=frontUrl&action=downloadUrl&app_type=web"},exports={};return exports.getUploadPath=function(t,n,i){var r;e(t,function(e){e=e||{},r=e.data||{},r.fid=t.fid,n&&n(r)},function(e){e=e||{},r=e.data||{},r.fid=t.fid,i&&i(r)})},exports.download=function(e,i,r){var a={siteid:e.siteid,ucid:e.ucid,file:e.fid,token:e.token,type:e.type};t.ajax(n.URL_DOWNLOAD,{data:a,type:r,onsuccess:function(e){if(0===e.status)i&&i(e.data.url)}})},exports}),define("qiao-im-sdk/message",["require","./base/main","./util/bcs","./model","./emitter"],function(require){function e(){this.filters=[],this.types=[]}function t(e){for(var t,n=e.length,i=0;n>i;i++)if(t=e[i],"text"===t.type&&l.test(t.text))t.text=t.text.replace(l,"")+"</div>"}function n(){this.encoder={},this.decoder={}}var i=require("./base/main"),r=require("./util/bcs"),a=require("./model"),o=require("./emitter"),s={lib:i,bcs:r,data:{get:a.get,STATUS:a.STATUS},emitter:o},u=require("./model").ERROR,c=i.format,l=/<\/div>/i,d="没有添加${name}类型的消息插件或者不支持此种消息类型";e.prototype.addFilter=function(e,t){this.filters[e]=t},e.prototype.addType=function(e,t,n){if(n)return void(this.types[e]=1);else return void(this.types[e]=t||"")},n.prototype.clone=function(e){e.encoder=i.clone(this.encoder),e.decoder=i.clone(this.decoder)},n.prototype.encode=function(e,t){var n,i=e.type,r=this.encoder[i];if(r)n=r(e),t&&t("<msg>"+n+"</msg>");else o.emit("error",u.MESSAGE_PLUGIN_NOT_FOUND,{info:c(d,{name:i})})},n.prototype.decode=function(e,n,r,a){var s=[],l=this.decoder,p={};if(r)p=r.types;for(var m,g={},h=0;m=e[h];h++)if(g=i.clone(m),1!==p[m.type]){if(p[m.type]){var v=p[m.type];if(!v)continue;g.type="text",g.text=v,s.push(g);continue}if("url"===m.type&&"map"===m.t&&l.map)m.type="map";var y=l[m.type];if(y){var b=y(m);g.type=b.type||m.type,g.text=b.text,s.push(g)}else o.emit("error",u.MESSAGE_PLUGIN_NOT_FOUND,{info:c(d,{name:m.type})})}else;var w=s.length;if(!w)return void a(e);for(var _=[],x=!1,T=0;w>T;T++)if(m=s[T],g=i.clone(m),f[m.type]){for(var E,S=0;E=_[S];S++)if("text"===E.type)E.text+=m.text,x=!0;if(!x)g.type="text",g.text=m.text,_.push(g)}else _.push(g);t(_),a(_)},n.prototype.addPlugin=function(e){var t=this.encoder,n=this.decoder,i=e(s).encoder;if(i)for(var r in i)if(i.hasOwnProperty(r))t[r]=i[r];var a=e(s).decoder;if(a)for(r in a)if(a.hasOwnProperty(r))n[r]=a[r]},n.prototype.addPlugin=function(e){var t=this.encoder,n=this.decoder,i=e(s).encoder;if(i)for(var r in i)if(i.hasOwnProperty(r))t[r]=i[r];var a=e(s).decoder;if(a)for(r in a)if(a.hasOwnProperty(r))n[r]=a[r]};var exports={},f={face:1,text:1,img:1,audio:0,voice:1,map:1,url:1,file:0,font:1,html:1};return exports.doFilter=function(e,t,n){var i;if(n){i=n.filters;for(var r in i)if(i.hasOwnProperty(r))if(i[r](e,t))return!0}return!1},exports.Filter=e,exports.Parser=n,exports.comParser=new n,exports}),define("qiao-im-sdk/plugin",["require","./base/main","./model","./emitter","./message"],function(require){var e=require("./base/main"),t=require("./model"),n=require("./emitter"),i=require("./message"),exports={};return exports.addPlugin=function(r,a){a.init&&a.init({lib:e,data:{get:t.get,STATUS:t.STATUS,ERROR:t.ERROR},emitter:n,message:i})},exports}),define("qiao-im-sdk/emitter",["require","./base/main"],function(require){var e=require("./base/main").Emitter,t=new e;return t}),define("qiao-im-sdk/model",["require","./emitter","./base/main"],function(require){var e=require("./emitter"),t=require("./base/main"),n=t.isMobile,i={TYPE_VIS_PC:1,TYPE_VIS_MOBILE:2,TYPE_VIS_MINI:3,TYPE_VIS_MOBILE_MINI:4},r=t.Storage,a={bid:"",peerid:"",siteid:"",userName:"1",ucid:"",seq:0,session:"",subid:"",tid:"",distSubid:"",distGroupid:"",sessionid:"",tag:"",visSessionid:"",compName:"",customName:"",csNameType:2,chatType:1,group:[],crossDomain:!1,visitType:n()?i.TYPE_VIS_MOBILE:i.TYPE_VIS_PC,inittype:0,appid:"",hisMsgCount:0,isAiPrologue:0,previewTime:8e3},exports={};return exports.set=function(e,n){if(t.isObject(e))t.extend(a,e);else a[e]=n},exports.get=function(e){return e?a[e]:t.extend({},a)},exports.init=function(n,i){t.extend(a,n),a.distGroupid=a.groupid,a.distSubid=a.subid,a.restart=!1,r.init({siteid:n.siteid}),e.emit("config",i)},exports.STATUS={SUCCESS:0,FAIL:1,ANTIATTACK:2,ACCEPT:3,REJECT:4,STARTSEND:5},exports.ERROR={MESSAGE_PLUGIN_NOT_FOUND:40001},exports}),define("qiao-im-sdk/base/convert",[],function(){function e(e){var t,a;e[0]=r(e[0],-180,180),e[1]=i(e[1],-74,74),t=e.slice(0);for(var s=0;s<o.length;s++)if(t[1]>=o[s]){a=u[s];break}if(!a)for(s=o.length-1;s>=0;s--)if(t[1]<=-o[s]){a=u[s];break}var c=n(e,a);return e=[c[0].toFixed(2),c[1].toFixed(2)]}function t(e){var t,i;t=[Math.abs(e[0]),Math.abs(e[1])];for(var r=0;r<a.length;r++)if(t[1]>=a[r]){i=s[r];break}var o=n(e,i);return e=[o[0].toFixed(6),o[1].toFixed(6)]}function n(e,t){if(e&&t){var n=t[0]+t[1]*Math.abs(e[0]),i=Math.abs(e[1])/t[9],r=t[2]+t[3]*i+t[4]*i*i+t[5]*i*i*i+t[6]*i*i*i*i+t[7]*i*i*i*i*i+t[8]*i*i*i*i*i*i;return n*=e[0]<0?-1:1,r*=e[1]<0?-1:1,[n,r]}}function i(e,t,n){if(null!=t)e=Math.max(e,t);if(null!=n)e=Math.min(e,n);return e}function r(e,t,n){for(;e>n;)e-=n-t;for(;t>e;)e+=n-t;return e}var exports={},a=[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],o=[75,60,45,30,15,0],s=[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],u=[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]];return exports.pixelToLngLat=function(e,n,i){return t([e/Math.pow(2,i-18),n/Math.pow(2,i-18)])},exports.lngLatToPixel=function(t,n,i){var r=e([t,n]),a=r[0]*Math.pow(2,i-18),o=r[1]*Math.pow(2,i-18);return[Math.ceil(a),Math.ceil(o)]},exports}),define("qiao-im-sdk/base/event",["require"],function(require){var e={on:function(e,t,n){if(e.addEventListener)e.addEventListener(t,n,!1);else e.attachEvent("ontype",n)}};return{event:e}}),define("qiao-im-sdk/base/promise",["require","exports"],function(require,exports){function e(e){return"function"==typeof e}function t(e){return"[object Object]"===Object.prototype.toString.call(e)}function n(i,r){function a(e){if(!u)n(i,e),u=!0}function o(e){if(!u)i.reject(e),u=!0}function s(){var n;if(t(r)||e(r))if(n=r.then,e(n))n.call(r,a,o);else n=null;if(!n)i.fulfill(r)}var u;if(f)try{s()}catch(l){if(!u)c(l),i.reject(l)}else s()}function i(e,t,i){return function(r){function a(){var a=i(r);if(a===t)throw new TypeError;n(e,a)}if(f)try{a()}catch(o){c(o),e.reject(o)}else a()}}function r(e,t,n){if(e.status===t)l.nextTick(function(){n(e.data)});else if(t===d.FULFILLED)e.fulfillList.push(n);else if(t===d.REJECTED)e.rejectList.push(n)}function a(e){var t=e.status===d.FULFILLED?e.fulfillList:e.rejectList;if(u(e),t.length)l.nextTick(function(){for(var n;n=t.shift();)n(e.data)})}function o(t,n,a){var o=new l,u=s(o);if(e(n))n=i(o,u,n);else n=function(e){o.fulfill(e)};if(r(t,d.FULFILLED,n),e(a))a=i(o,u,a);else a=function(e){o.reject(e)};return r(t,d.REJECTED,a),u}function s(e){return{then:function(t,n){return o(e,t,n)},"catch":function(t){return o(e,null,t)}}}function u(e){var t=e.status===d.FULFILLED?"resolve":"reject";if(p)l.emit(t,e.data)}function c(e){if(p)l.emit("exception",e)}function l(){this.status=d.PENDING,this.fulfillList=[],this.rejectList=[]}var d={PENDING:0,FULFILLED:1,REJECTED:2},f=!0,p=!1,m=function(){function t(){var e,t=r.length;for(e=0;t>e;e++)r[e]();r.splice(0,e)}var n,i,r=[],a="promise";if("undefined"!=typeof process&&null!==process&&"function"==typeof process.nextTick)n=function(e){return process.nextTick(e)};else if(i=window.MutationObserver||window.webKitMutationObserver){var o=new i(function(e){var n=e[0];if(n.attributeName===a)t()}),s=document.createElement("div");o.observe(s,{attributes:!0}),n=function(e){r.push(e),s.setAttribute(a,Date.now?Date.now():(new Date).getTime())}}else if(e(window.postMessage))window.addEventListener("message",function(e){if(e.source===window&&e.data===a)t()},!1),n=function(e){r.push(e),window.postMessage(a,"*")};else n=function(e){setTimeout(e,0)};return n}();return l.nextTick=m,l.enableGlobalEvent=function(e){e.mixin(this),p=!0},l.disableExceptionCapture=function(){f=!1},l.enableExceptionCapture=function(){f=!0},l.all=function(e){function t(t){return function(n){if(a[t]=n,r++,r>=e.length)i.fulfill(a)}}function n(e){i.reject(e)}if(!Array.isArray(e))e=Array.prototype.slice.call(arguments);var i=new l,r=0,a=[];return e.forEach(function(e,i){e.then(t(i),n)}),i.promise()},l.race=function(e){function t(e){i.fulfill(e)}function n(e){i.reject(e)}var i=new l;if(!Array.isArray(e))e=Array.prototype.slice.call(arguments);return e.forEach(function(e){e.then(t,n)}),i.promise()},l.promise=function(e){var t=new l;return e(t),t.promise()},l.rejected=function(e){return this.promise(function(t){t.reject(e)})},l.fulfilled=function(e){return this.promise(function(t){t.fulfill(e)})},l.resolved=l.fulfilled,l.prototype.fulfill=function(e){if(this.status===d.PENDING)this.data=e,this.status=d.FULFILLED,a(this)},l.prototype.resolve=l.prototype.fulfill,l.prototype.reject=function(e){if(this.status===d.PENDING)this.data=e,this.status=d.REJECTED,a(this)},l.prototype.promise=function(){return s(this)},{Resolver:l}}),define("qiao-im-sdk/base/browser",["require"],function(require){var exports={};return exports.isMobile=function(){var e=navigator.userAgent;return!!e.match(/.*Mobile.*/)||"ontouchstart"in window},exports}),define("qiao-im-sdk/base/array",["require"],function(require){var exports={};return exports.indexOfArray=function(e,t,n){var i,r,a=e.length;for(i=0;a>i;i++){if(n)r=e[i][n];else r=e[i];if(i in e&&r===t)return i}return-1},exports.removeAtArray=function(e,t){return e.splice(t,1)[0]},exports}),define("qiao-im-sdk/base/Storage",[],function(){function e(e){this.id=e.toUpperCase()}var t,n=window.localStorage,i=window,r=i.document,a="QIAOUSERDATACHAT"+location.hostname,o=function(){function e(e){return e.replace(o,"___")}var t,n=null,i=365,o=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");return{build:function(e){e=e||{},t=a+(e.siteid||""),i=e.expires||i},setup:function(){if(!n)try{n=r.createElement("input"),n.type="hidden",n.addBehavior("#default#userData"),r.body.appendChild(n)}catch(e){return!1}return!0},setItem:function(r,a){r=e(r);var o=this,s=new Date;if(o.setup())return s.setDate(s.getDate()+i),n.expires=s.toUTCString(),n.load(t),n.setAttribute(r,a),n.save(t),a;else return void 0},getItem:function(i){i=e(i);var r=this;if(r.setup())return n.load(t),n.getAttribute(i)},clear:function(){var e=new Date;e.setDate(e.getDate()-1),n.expires=e.toUTCString()}}}();return e.init=function(e){var i=e.siteid;if(!t)t="BDBG_IM_"+i+"_";if(!window.localStorage)n=o,n.build({siteid:i})},e.clear=function(){n.clear()},e.prototype.key=function(){return t+this.id},e.prototype.get=function(e){var t;try{t=JSON.parse(n.getItem(this.key())||"{}")}catch(i){t={}}if(e)return t[e];else return t},e.prototype.clear=function(){try{try{n.setItem(this.key(),JSON.stringify({}))}catch(e){n.clear()}}catch(t){}},e.prototype.set=function(e,t){var i=this.get();i[e]=t;try{try{n.setItem(this.key(),JSON.stringify(i))}catch(r){n.clear(),n.setItem(this.key(),JSON.stringify(i))}}catch(a){}},{Storage:e}}),define("qiao-im-sdk/base/emitter",[],function(){function e(){}var t=e.prototype;return t._getEvents=function(){if(!this._events)this._events={};return this._events},t._getAfter=function(){if(!this._afters)this._afters={};return this._afters},t._getMaxListeners=function(){if(isNaN(this.maxListeners))this.maxListeners=10;return this.maxListeners},t.on=function(e,t){var n=this._getEvents(),i=this._getMaxListeners();n[e]=n[e]||[];var r=n[e].length;if(r>=i&&0!==i)throw new RangeError("Warning: possible Emitter memory leak detected. "+r+" listeners added.");return n[e].push(t),this},t.once=function(e,t){function n(){i.off(e,n),t.apply(this,arguments)}var i=this;return n.listener=t,this.on(e,n),this},t.off=function(e,t){var n=this._getEvents();if(0===arguments.length)return this._events={},this;var i=n[e];if(!i)return this;if(1===arguments.length)return delete n[e],this;for(var r,a=0;a<i.length;a++)if(r=i[a],r===t||r.listener===t){i.splice(a,1);break}return this},t.emit=function(e){for(var t=this._getEvents(),n=t[e],i=[],r=1;r<arguments.length;r++)i.push(arguments[r]);if(n)for(n=n.slice(0),r=0;r<n.length;r++)n[r]&&n[r].apply(this,i);return this},t.listeners=function(e){var t=this._getEvents();return t[e]||[]},t.setMaxListeners=function(e){return this.maxListeners=e,this},e.mixin=function(e){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e},{Emitter:e}}),define("qiao-im-sdk/base/net/jsonp",["require","../object","./img"],function(require){"use strict";function e(e,i){var s=a(),u=null,h=i.timeout||null,v=i.callbackKey||f,y=s,b=i.data||{};b.t=(new Date).getTime();var w=i.charset||p,_=function(e){i.onsuccess&&i.onsuccess(e),n(u),r(y)},x=function(){i.onfail&&i.onfail(),n(u),r(y)},T=o({url:e+t(e,b,v,y),charset:w,id:s});if(l[s]=c[s]=function(){try{_.apply(null,arguments)}catch(t){m.request(g,{type:"jsonp",errMsg:t.message||"",name:t.name||"",fileName:t.fileName||"",url:e,stack:t.stack||""}),x.apply(null,arguments)}},d[s]=function(){x.apply(null,arguments)},h)u=setTimeout(function(){u=null,T.abort(),x.call(null)},h);return T.send(),T}function t(e,t,n,i){var r={}.toString.call(t),a="?";if(e.indexOf("?")>-1)a="&";var o=a+n+"="+i;if("[object Object]"===r)o+="&"+s(t);return o}function n(e){if(e)clearTimeout(e),e=null}function i(e){if(c[e])c[e]=h(e),l[e]=null,delete l[e]}function r(e){try{l[e]=null,c[e]=null,delete l[e],delete c[e]}catch(t){}}function a(){var e="cxxxxxxx_xxxx_4xxx_yxxx_xxxxxxxxxxxx";return e.replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)})}function o(e){var t,n=u.head||u.getElementsByTagName("head")&&u.getElementsByTagName("head")[0]||u.body;return{send:function(){t=u.createElement("script"),t.async=!0,t.charset=e.charset,t.src=e.url,t.id=e.id,t.onload=t.onreadystatechange=function(n){if(n===!0||!t.readyState||/loaded|complete/.test(t.readyState)){if(t.onload=t.onreadystatechange=null,t.parentNode)t.parentNode.removeChild(t);if(t=null,n===!0)i(e.id)}},t.onerror=function(){if(t.parentNode)t.parentNode.removeChild(t);if(d[t.id])d[t.id].call(null);t=null},n.insertBefore(t,n.firstChild)},abort:function(){if(t)t.onload(!0)}}}var s=require("../object").jsonToQuery,u=document,c=window,l={},d={},f="callback",p="utf-8",m=require("./img"),g="//scqiao.baidu.com/front/ajaxError.gif",h=function(e){return function(){try{c[e]=null,delete c[e]}catch(t){}}};return{request:e}}),define("qiao-im-sdk/base/net/img",["require","../object"],function(require){var e=require("../object"),t=function(){var e=0;return function(){var t=(new Date).getTime();return t+="_"+e++}}(),exports={};return exports.request=function(n,i,r,a){if("function"==typeof i)a=r,r=i,i=null;(i=i||{}).t=t(),n+=(n.indexOf("?")>-1?"&":"?")+e.jsonToQuery(i);var o=new Image;o.onload=function(){o.onload=null,o.onerror=null,o=null,r&&r()},o.onerror=function(){o.onload=null,o.onerror=null,o=null,a&&a()},o.src=n},exports}),define("qiao-im-sdk/base/string",["require"],function(require){var e={amp:"&",lt:"<",gt:">",quot:'"',apos:"'"},exports={};return exports.encodeHTML=function(e){if(!e)return"";else return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},exports.decodeHTML=function(t){if(!t)return"";else return(t+"").replace(/\&([^;]+);/g,function(t,n){var i;if(n in e)return e[n];else if(i=n.match(/^#x([\da-fA-F]+)$/))return String.fromCharCode(parseInt(i[1],16));else if(i=n.match(/^#(\d+)$/))return String.fromCharCode(parseInt(i[1],10));return t})},exports.format=function(e,t){if(!e)return"";if(null==t)return e;var n="function"==typeof t?t:function(e){var n=t[e];return null==n?"":n};return(e+"").replace(/\$\{(.+?)\}/g,function(e,t){return n(t)})},exports.objectToString=function(e){var t=[],n=function(e){if("object"==typeof e&&null!==e)return this.objectToString(e);else return/^(string|number)$/.test(typeof e)?'"'+e+'"':e};for(var i in e)if(e.hasOwnProperty(i))t.push('"'+i+'":'+n(e[i]));return"{"+t.join(",")+"}"},exports}),define("qiao-im-sdk/base/object",["require","./string"],function(require){var e=require("./string"),exports={};exports.extend=function(e,t){for(var n=arguments.length,i=1;n>i;i++)if(t=arguments[i]){for(var r in t)if(t.hasOwnProperty(r)&&void 0!==t[r])e[r]=t[r]}else;return e},exports.extendOwn=function(e,t){for(var n=1,i=arguments.length;i>n;n++)if(t=arguments[n]){for(var r in t)if(t.hasOwnProperty(r)&&e.hasOwnProperty(r)&&void 0!==t[r])e[r]=t[r]}else;return e},exports.clone=function(e){for(var t={},n=0,i=arguments.length;i>n;n++)if(e=arguments[n]){for(var r in e)if(e.hasOwnProperty(r)&&void 0!==e[r])t[r]=e[r]}else;return t},exports.jsonToQuery=function(t){var n,i,r=[];for(var a in t)if(t.hasOwnProperty(a))if(n=t[a],exports.isArray(n))for(i=n.length;i--;)r.push(a+"="+encodeURIComponent(n[i]));else if(exports.isObject(n))r.push(a+"="+encodeURIComponent(e.objectToString(n)));else r.push(a+"="+encodeURIComponent(n));return r.join("&")};var t=Object.prototype.toString;return exports.isObject=function(e){return"[object Object]"===t.call(e)},exports.isString=function(e){return"[object String]"===t.call(e)},exports.isArray=function(e){return"[object Array]"===t.call(e)},exports.isNumber=function(e){return!!/^[0-9]+$/.test(e)},exports}),define("qiao-im-sdk/base/net/ajax",["require","../object","./img"],function(require){function e(){}function t(n,i){function r(){if(4===d.readyState){try{var t=d.status}catch(n){return void o("failure")}if(o(t),t>=200&&300>t||304===t||1223===t)o("success");else o("failure");window.setTimeout(function(){if(d.onreadystatechange=e,p)d=null},0)}}function a(){if(window.ActiveXObject)try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}if(window.XMLHttpRequest)return new XMLHttpRequest;else return void 0}function o(e){e="on"+e;var r=b[e],a=t[e];if(r){if(c)clearTimeout(c);if("onsuccess"!==e)r(d);else try{var o=d.responseText;o=new Function("return ("+o+")")(),i.onsuccess(o)}catch(l){return s.request(u,{errMsg:l.message||"",name:l.name||"",fileName:l.fileName||"",url:n,stack:l.stack||""}),i.onfailure(d)}}else if(a){if("onsuccess"===e)return;a(d)}}i=i||{};var c,l,d,f=i.data||"",p=!(i.async===!1),m=i.username||"",g=i.password||"",h=(i.method||"GET").toUpperCase(),v=i.headers||{},y=i.timeout||0,b={};for(l in i)if(i.hasOwnProperty(l))b[l]=i[l];if(0!==n.indexOf("http"))v["X-Requested-With"]="XMLHttpRequest";try{if(d=a(),"GET"===h){if(f)n+=(n.indexOf("?")>=0?"&":"?")+f,f=null;if(i.noCache)n+=(n.indexOf("?")>=0?"&":"?")+"b"+ +new Date+"=1"}if(m)d.open(h,n,p,m,g);else d.open(h,n,p);if(p)d.onreadystatechange=r;if("POST"===h)v["Content-Type"]=v["Content-Type"]||"application/x-www-form-urlencoded",d.setRequestHeader("Content-Type",v["Content-Type"]),delete v["Content-Type"];for(l in v)if(v.hasOwnProperty(l))d.setRequestHeader(l,v[l]);if(o("beforerequest"),y)c=setTimeout(function(){d.onreadystatechange=e,d.abort(),o("timeout")},y);if(d.send(f),!p)r()}catch(w){o("failure")}return d}function n(){return(new Date).getTime().toString(36)}function i(i,a){var s=a.onsuccess||e,u=a.onfailure||e;a.onsuccess=s,a.onfailure=u;var c=a.data||{};if(a.method===o)i+=(i.indexOf("?")>=0?"&":"?")+"_t="+n(),a.data=r(c);else c._t=n(),i+=(i.indexOf("?")>=0?"&":"?")+r(c),a.data=null;return t(i,a)}var r=require("../object").jsonToQuery,a="GET",o="POST",s=require("./img"),u="//scqiao.baidu.com/front/ajaxError.gif",exports={};return exports.post=function(e,t,n,r){return i(e,{method:o,data:t,onsuccess:n,onfailure:r})},exports.get=function(e,t,n,r){return i(e,{method:a,data:t,onsuccess:n,onfailure:r})},exports}),define("qiao-im-sdk/base/ajax",["require","./net/ajax","./net/jsonp","./net/img"],function(require){var e=require("./net/ajax"),t=require("./net/jsonp"),n=require("./net/img"),i="//p.qiao.baidu.com",exports={};return exports.ajax=function(n,r){if("jsonp"===r.type)return n=r.hasDomain?n:i+n,t.request(n,r);if("post"===r.method)return e.post(n,r.data,r.onsuccess,r.onfail);else return e.get(n,r.data,r.onsuccess,r.onfail)},exports.img=function(e,r){if("jsonp"===r.type)return t.request(i+e,r);else return void n.request(e,r.data,r.onsuccess,r.onfail)},exports}),define("qiao-im-sdk/base/main",["require","./ajax","./emitter","./Storage","./string","./array","./browser","./object","./promise","./event","./convert"],function(require){function e(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}var exports={};return e(exports,require("./ajax")),e(exports,require("./emitter")),e(exports,require("./Storage")),e(exports,require("./string")),e(exports,require("./array")),e(exports,require("./browser")),e(exports,require("./object")),e(exports,require("./promise")),e(exports,require("./event")),e(exports,require("./convert")),exports}),define("qiao-im-sdk",["qiao-im-sdk/lite"],function(e){return e}),define("qiao-im-sdk/lite",["require","./base/main","./model","./plugin","./core/im/main","./core/rcv/main","./emitter","./plugins/connectLog","./plugins/sendLog","./plugins/site","./plugins/file","./plugins/errorLog","./message","./messagePlugins/text","./messagePlugins/img","./messagePlugins/map","./messagePlugins/voice"],function(require){var e=require("./base/main"),t=require("./model"),n=require("./plugin").addPlugin,i=e.extend,exports={};i(exports,require("./core/im/main")),i(exports,require("./core/rcv/main")),exports.init=t.init,exports.getData=t.get,exports.STATUS=t.STATUS,exports.ERROR=t.ERROR;var r=require("./emitter");exports.on=function(){var e=[].slice.call(arguments);r.on.apply(r,e)},exports.emit=function(){var e=[].slice.call(arguments);r.emit.apply(r,e)},exports.addPlugin=require("./plugin").addPlugin,n("connectLog",require("./plugins/connectLog")),n("sendLog",require("./plugins/sendLog")),n("site",require("./plugins/site")),n("file",require("./plugins/file")),n("errorLog",require("./plugins/errorLog"));var a=require("./message"),o=a.comParser;return o.addPlugin(require("./messagePlugins/text")),o.addPlugin(require("./messagePlugins/img")),o.addPlugin(require("./messagePlugins/map")),o.addPlugin(require("./messagePlugins/voice")),exports.addMessagePlugin=function(){var e=[].slice.call(arguments);o.addPlugin.apply(o,e)},exports}),define("front/prevent/main",["require","exports","qiao-im-sdk","./const","./tpl","../base/emitter","../common/view","../common/Mask","../base/dom","../base/string","../data/config","../net/jsonp","../common/identity","../storage/localStorage","../base/event"],function(require,exports){
function e(){c.getAuthCode(function(e,n){if(e===c.STATUS.SUCCESS)t(n.url)})}function t(e){var t=p.g(b.authimg);t.setAttribute("src",e)}function n(t,n){if(t===c.STATUS.SUCCESS)u(_);else{var i=p.g(b.error),r=p.g(b.input);i.innerHTML="验证码错误",r.value="",e()}}function i(){var t=p.g(b.min),i=p.g(b.changeimg),r=p.g(b.confirmcode),a=p.g(b.cancle);h.on(t,"click",u),h.on(a,"click",function(){u();var e=p.g(b.error),t=p.g(b.input);e.innerHTML="",t.value=""}),h.on(r,"click",function(){var e={type:"auth",code:p.g(b.input).value};c.verify(e,function(e,t){n(e,t)})}),h.on(i,"click",e)}function r(){var e=p.g(b.confirmcode),t=p.g(b.cancle);h.on(t,"click",u),h.on(e,"click",function(){var e={type:"second"};c.verify(e,function(e,t){n(e,t)})})}function a(e){var t=d.authCode;t=m.format(t,b);var n=document.createElement("ins"),r=b.auth;n.className=r,n.id=v,n.innerHTML=t,e.appendChild(n),T=new f(n),i(),_=p.g(r)}function o(e){var t=d.secondVerify;t=m.format(t,b);var n=document.createElement("ins"),i=b.second;n.className=i,n.id=y,n.innerHTML=t,e.appendChild(n),T=new f(n),r(),x=p.g(i)}function s(){var e;if(_)e=_;else if(x)e=x;if(e)p.removeClass(e,b.iconClose);T&&T.auto()}function u(){var e;if(_)e=_;else if(x)e=x;if(e)p.addClass(e,b.iconClose);T&&T.auto()}var c=require("qiao-im-sdk"),l=require("./const"),d=require("./tpl"),f=(require("../base/emitter"),require("../common/view"),require("../common/Mask")),p=require("../base/dom"),m=require("../base/string"),g=require("../data/config"),h=(require("../net/jsonp"),require("../common/identity"),require("../storage/localStorage"),require("../base/event")),v=l("auth"),y=l("second"),b={auth:l("auth"),second:l("second"),iconClose:l("close"),wrap:l("wrap"),head:l("head"),container:l("container"),min:l("min"),text:l("text"),inputauth:l("inputauth"),inputimg:l("inputimg"),input:l("input"),error:l("error"),authimg:l("authimg"),changeimg:l("changeimg"),button:l("button"),confirmcode:l("confirmcode"),cancle:l("cancle")},w=g.getImRoot(),_=null,x=null,T=null,E={SEND_CODE:w+"atverifycode",GET_CODE:w+"atgetcode"};return{authShow:function(e){if(_)s();else a(document.body),t(e)},secondShow:function(e){if(x)s();else o(document.body)},URL:E}}),define("front/base/json",[],function(){function e(e){var t={}.toString.call(e);return t=t.substring(8,t.length-1),t.toLowerCase()}function t(t){var i=n[e(t)];return i?i(t):""+t}var n={};return n.array=function(e){var n=[];n.push("[");for(var i=0,r=e.length;r>i;i++)n.push(t(e[i])),n.push(",");return n.splice(n.length-1,1),n.push("]"),n.join("")},n.object=function(e){if(null===e)return"null";var n=[];n.push("{");for(var i in e)if(e.hasOwnProperty(i))n.push('"'+i+'":'),n.push(t(e[i])),n.push(",");return n.splice(n.length-1,1),n.push("}"),n.join("")},n.string=function(e){return'"'+e+'"'},{parse:function(e){var t=null;try{if(window.JSON&&window.JSON.parse)t=window.JSON.parse(e);else t=new Function("return ("+e+");")()}catch(n){}return t},stringify:function(e){var n;if(window.JSON&&window.JSON.stringify)n=window.JSON.stringify(e);else n=t(e);return n}}}),define("front/base/loader",[],function(){function e(e,a,o,s){var u,c,l,d=this,f=t.getElementsByTagName("head")[0];for(d.callback=s||function(){},d.queue=[],a="string"==typeof a?[a]:a,c=0,l=a.length;l>c;c++){if(this.queue[c]=1,"css"==e)if(!n.isGecko)u=r.createNode("link",r.merge({type:"text/css",rel:"stylesheet",href:a[c]},o));else u=r.createNode("style"),u.innerHTML='@import "'+a[c]+'";';else u=r.createNode("script",r.merge({type:"text/javascript",src:a[c],charset:"utf-8"},o));if(i)if("css"==e&&2==i)!function(){var e=0,t=setInterval(function(){try{u.sheet.cssRules,clearInterval(t),d._callback()}catch(n){if(e+=1,e>100)clearInterval(t),d._callback()}},100)}();else u.onload=function(){d._callback()};else u.onreadystatechange=function(){if(/^loaded|complete$/.test(this.readyState))this.onreadystatechange=null,d._callback()}}f.appendChild(u)}var t=document,n=function(){var e=navigator.userAgent;return{async:t.createElement("script").async===!0,firefox:/firefox\/(\d+\.\d+)/i.test(e)?+RegExp.$1:void 0,ie:/msie (\d+\.\d+)/i.test(e)?document.documentMode||+RegExp.$1:void 0,isStrict:"CSS1Compat"==document.compatMode,isGecko:/gecko/i.test(e)&&!/like gecko/i.test(e),isWebkit:/webkit/i.test(e),opera:/opera(\/| )(\d+(\.\d+)?)(.+?(version\/(\d+(\.\d+)?)))?/i.test(e)?+(RegExp.$6||RegExp.$2):void 0}}(),i=n.ie?0:n.opera?1:2,r={createNode:function(e,n){var i,r=t.createElement(e);for(i in n)if(n.hasOwnProperty(i))r.setAttribute(i,n[i]);return r},load:function(t,n,i,r){if("function"==typeof i)r=i,i={};new e(t,n,i,r)},merge:function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}};return e.prototype={_callback:function(){var e=this;if(e.queue.pop()&&0==e.queue)e.callback()}},{css:function(e,t,n){return r.load("css",e,t,n)},js:function(e,t,n){return r.load("js",e,t,n)}}}),define("front/webim/lite",["require","exports","../base/dom","../base/lang","../base/string","../common/view","../data/config","../data/group","../base/emitter","../common/identity","../storage/localStorage","../base/loader","../base/json","../net/jsonp","../prevent/main"],function(require,exports){function e(e){var n;if(4===+e.status){n=p.getGroupBySub(e.subid)||{};var i={type:0,chattype:y.chatType.enforce,tid:n.groupid,subid:e.subid,groupname:n.groupname};t(i)}}function t(e){var t=e.type,n=e.tid,i=e.subid,r=e.groupname,o=(e.from,e.lastsubid,e.siteid,e.ucid,e.chat);if(""===n)t=3,n="visDistribute";_=!0,a({type:t,chattype:e.chattype,bridgeTid:n+"",subid:i,userGroupName:r,chat:o})}function n(e){return g.getLSKey(e)}function i(e){localStorage.setItem(n("chattype"),e.chattype),localStorage.setItem(n("tid"),e.bridgeTid),localStorage.setItem(n("subid"),e.subid),localStorage.setItem(n("userGroupName"),e.userGroupName)}function r(){return{chattype:localStorage.getItem(n("chattype")),bridgeTid:localStorage.getItem(n("tid")),subid:localStorage.getItem(n("subid")),userGroupName:localStorage.getItem(n("userGroupName"))}}function a(e){if(e)if(E=d.extend({},e),"visDistribute"===E.bridgeTid)E.bridgeTid="";else E.bridgeTid=E.bridgeTid||E.tid||0;if(_&&w){var t={type:E.type,chattype:E.chattype,bridgeTid:E.bridgeTid,subid:E.subid,userGroupName:E.userGroupName||E.groupname,chat:E.chat||""};b.accept(t),i(E)}}function o(e){f.setStyleConfig("webim",{webimtype:e})}function s(){var e=f.getStyleConfig("webim");b.on("revertsession",function(){o(1),_=!0,a(r())}),b.on("ready",function(){o(1)});var t=e.webimposition;t=3===t?1:0;var n="undefined"!=typeof e.webimchat.showtype?e.webimchat.showtype:-1;b.on("second",v.secondShow),b.on("auth",v.authShow),b.init({bid:f.getModelData("bid"),peerid:f.getModelData("peerid"),siteid:f.getSiteId(),ucid:f.getUcId(),mainid:f.getMainId()||0,SITE_ID:f.getSiteIdMd5()||0,userName:f.getUserName(),offsetTime:0,root:f.getRoot(),bgColor:e.webimliteskin||"",position:t||0,csNameType:n,customName:e.webimchat.name||"",searchInfo:y.searchInfo,jscode:f.getJsFunctionResult(),IM_ROOT:f.getImRoot(),POOL_ROOT:f.getPoolRoot(),authCode:f.authCode,isAiPrologue:f.getIsAiPrologue()})}function u(){var e=f.getFrontRoot()||f.getRoot();h.css(e+"asset/css/m-webim-lite.css?v=20171213"),require(["front/webimlite/main"],function(e){x=1,b=e,c()})}function c(){if(x&&T)s(b),w=!0,a()}function l(e){var t,n,i=["referrer","location","title","word","wordtype","wordid","from"],r=d.extend({},f.getModelData());for(y.searchInfo={},t=0;n=i[t];t++)y.searchInfo[n]=r[n]||"";T=1,c()}var d=(require("../base/dom"),require("../base/lang")),f=(require("../base/string"),require("../common/view"),require("../data/config")),p=require("../data/group"),m=require("../base/emitter"),g=require("../common/identity"),h=(require("../storage/localStorage"),require("../base/loader")),v=(require("../base/json"),require("../net/jsonp"),require("../prevent/main")),y={chatType:{byInvite:0,bySelf:1,enforce:5}},b=null,w=!1,_=!1,x=0,T=0,E={};exports.init=function(){u();var t=p.asyncHandle();t.then(l),m.on("rcv:refresh",function(t){e(t)})},exports.chat=t,exports.show=function(){b.show()}}),define("front/webim/main",["require","../base/emitter","../data/config","../common/identity","./lite","../base/browser","../storage/localStorage","../base/lang","../data/group","../prevent/main"],function(require){function e(){var e=c.getRoot(),t=c.getImRoot();if(t.indexOf("http")<0)t="http:"+t;var n=t+"im/index";if(e.indexOf("hqiao.baidu.com")>-1)n=t+"im/index";return n}function t(t,n){var i=e()+"?siteid="+t.siteid+"&ucid="+t.ucid+"&siteidstr="+t.siteidstr+"&mainid="+t.mainid+"&csNameType=2&csName="+encodeURIComponent("在线客服")+"&userName="+encodeURIComponent(t.userName)+"&groupName="+encodeURIComponent(t.groupname)+"&groupid="+t.groupid+"&sub="+t.subid+"&distributeType="+t.type+"&bid="+n+"&tok="+t.tok,r=navigator.userAgent,a=!!r.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);if(a){var o=document.createElement("a");o.setAttribute("href",i),document.body.appendChild(o),setTimeout(function(){o.click(),o.parentNode.removeChild(o)},0)}else window.open(i,"BridgeImWindow")}function n(e){var t,n,i,r=[];for(t in e)if(e.hasOwnProperty(t))if(n=e[t],m.isArray(n))for(i=n.length;i--;)r.push(t+"="+encodeURIComponent(n[i]));else r.push(t+"="+encodeURIComponent(n));return r.join("&")}function i(){return g.hasLoginSub()}function r(r){c.getIsWebIm();if(r=r||{},!i())return void u.emit("mess:center");var a=r.groupid,o=r.groupname,y=r.chat,b=r.subid,w=r.subname,_=c.getSiteId(),x=c.getUcId(),T=p.getItem(l.getLSKey("bid")),E=h.webimtype,S=m.extend({},c.getModelData());if(void 0!==a){var C=g.getGroupNameById(a);r.groupname=C,o=C}if(void 0!==b){var I=g.getGroupBySub(b);r.subname=I.subname,r.groupid=I.groupid,r.groupname=I.groupname,a=I.groupid,w=I.subname,o=I.groupname}if(void 0===a)r.groupid="",r.groupname="",a="";if(S.tid=a,""!==b&&void 0!==b)S.type=0,S.subid=b,S.subname=w;else S.type=1,S.subid="",S.subname="",r.subid="",r.subname="";r.groupid=""+r.groupid,r.subid=""+r.subid;var L=(new Date).getTime().toString(32),k=c.getModelData("ls")||"";if(f.isMobile){var M=S.type;if(1===M&&(""===a||void 0===a))M=3;t({type:M,siteid:_,ucid:x,siteidstr:c.getSiteIdMd5(),mainid:c.getMainId(),userName:c.getUserName(),groupname:o,groupid:a,subid:b,tok:L},T)}else if(!E){r.ref=window.location.href;var D="siteid="+_+"&ucid="+x+"&lastsubid="+k+"&from="+encodeURIComponent(c.getModelData("from"))+"&bid="+T+"&tok="+L+"&"+n(r),A=f.safari?653:631,N=(window.screen.availWidth-796)/2,O=(window.screen.availHeight-A-1)/2,P="left="+N+",top="+O+",resizable=yes,width=795,height="+A;if(!s||s&&s.closed){var R=e();s=window.open(R+"?"+D,"BridgeImWindow",P)}else s.focus();if(!s)u.emit("stat","BLOCK_POP",{})}else{var j={type:S.type,chattype:r.chattype,tid:r.groupid,subid:r.subid,groupname:r.groupname,from:c.getModelData("from"),lastsubid:k,siteid:_,ucid:x,chat:y};d.chat(j)}v=!1}function a(i){i=i||{};var r=i.groupid,a=i.subid,o=c.getSiteId(),d=c.getUcId(),h=p.getItem(l.getLSKey("bid")),v=m.extend({},c.getModelData());if(void 0!==a){var y=g.getGroupBySub(a);if(y)i.subname=y.subname,i.groupid=y.groupid,i.groupname=y.groupname;else i.subid="",i.subname="",i.groupid="",i.groupname=""}else if(void 0!==r){var b=g.getGroupNameById(r);if(b&&"分组"!==b)i.groupname=b;else i.groupid="",i.groupname=""}if(void 0===i.groupid)i.groupid="",i.groupname="";if(void 0===i.subid)i.subid="",i.subname="",v.type=1;else v.type=0;v.subid=i.subid,v.subname=i.subname,v.tid=i.groupid,i.subid=""+i.subid,i.tid=i.groupid;var w=c.getModelData("ls")||"",_=v.type;if(1===_&&""===i.groupid)_=3;var x=(new Date).getTime().toString(32);if(f.isMobile)t({type:_,siteid:o,ucid:d,siteidstr:c.getSiteIdMd5(),mainid:c.getMainId(),userName:c.getUserName(),groupname:i.groupname,groupid:i.groupid,subid:i.subid,tok:x},h);else{var T=c.getModelData("from")?c.getModelData("from"):"";i.ref=window.location.href;var E="siteid="+o+"&ucid="+d+"&lastsubid="+w+"&from="+encodeURIComponent(T)+"&bid="+h+"&tok="+x+"&"+n(i),S=(window.screen.availWidth-796)/2,C=(window.screen.availHeight-562)/2,I="left="+S+",top="+C+",resizable=yes,width=795,height=561";if(!s||s&&s.closed){var L=e();s=window.open(L+"?"+E,"BridgeImWindow",I)}else s.focus();if(!s)u.emit("stat","BLOCK_POP",{})}}function o(){u.on("webim:open",r),u.on("windowChat:open",a)}var s,u=require("../base/emitter"),c=require("../data/config"),l=require("../common/identity"),d=require("./lite"),f=require("../base/browser"),p=require("../storage/localStorage"),m=require("../base/lang"),g=require("../data/group"),c=(require("../prevent/main"),require("../data/config")),h=(require("../prevent/main"),c.getStyleConfig("webim")),v=!1;return{init:function(){d.init(),o()}}}),define("front/net/img",["require"],function(require){"use strict";function e(e,n){e+=t(e,n.data);var i=new Image;i.onload=function(){if(i.onload=null,i.onerror=null,i=null,n.onsuccess)n.onsuccess()},i.onerror=function(){if(i.onload=null,i.onerror=null,i=null,n.onfail)n.onfail()},i.src=e}function t(e,t){var i={}.toString.call(t),r="?";if(e.indexOf("?")>-1)r="&";if("[object Object]"===i){for(var a in t)if(t.hasOwnProperty(a))r+=a+"="+encodeURIComponent(t[a])+"&";r+="t="+n()}return r}var n=function(){var e=0;return function(){var t=(new Date).getTime();return t+="_"+e++}}();return{request:e}}),define("front/common/log",["require","../base/emitter","../data/config","../base/json","../base/lang","../net/img"],function(require){function e(e,t){if(e&&o[e]){var s=a+"?siteid="+n.getSiteId()+"&ucid="+n.getUcId()+"&type="+o[e];r.request(s,{data:i.extend({},t)})}}var t=require("../base/emitter"),n=require("../data/config"),i=(require("../base/json"),require("../base/lang")),r=require("../net/img"),a=n.getRoot()+"statlog/stat.gif",o={SEND_INVITE:"invite",CLICK_ICON:"clickIcon",CLOSE_INVITE:"inviteclose",CLICK_MESS:"clickIconMess",BLOCK_POP:"blockpop",ALREADY_OPEN:"alreadyopen",OPEN_WEBIMLITE:"openwebimlite",LOAD_TIME:"loadtime"};return{init:function(){t.on("stat",e)}}}),define("front/common/stat",["require","exports","../base/emitter","../data/config","./log"],function(require,exports){function e(){return Math.floor(1e10*Math.random())}function t(e){var t=new Image,n=p+"?"+e;t.onload=t.onerror=function(){t=null},t.src=n}function n(e,t){for(var n in e)if(e.hasOwnProperty(n))t[n]&&(e[n]=t[n])}function i(n){var i="si="+d.siteId+"&et=99&ep="+d.mainId;i+=r(n),i=i+g+e(),t(i)}function r(e){var t,n,i="",r=v.length;for(t=0;r>t;t++)n=v[t],i+=""===e[n]?"*"+m:"*"+e[n];return i}function a(e){if(y.visitor_count)n(f,e),f.eventId=h.VISITOR_IM,f.count=y.visitor_count,f.valid=1,i(f),y.visitor_count=0,f.valid=0}function o(e){if(!e.chatId)y.visitor_count+=e.count;else n(f,e),f.eventId=h.VISITOR_IM,f.valid=1,i(f),y.visitor_count=0,f.valid=0}function s(e,t){if(e&&h[e])switch(d.siteId=d.siteId||c.getSiteIdMd5()||0,d.mainId=d.mainId||c.getMainId()||0,e=e.toUpperCase()){case"VISITOR_IM":o(t);break;case"START_IM":a(t);break;default:n(f,t),f.eventId=h[e],i(f)}}var u=require("../base/emitter"),c=require("../data/config"),l=require("./log"),d={siteId:"",mainId:""},f={mainId:"",subId:"",sessionId:"",eventId:"",chatId:"",from:"",open:"",valid:"",count:""},p="//hm.baidu.com/hm.gif",m=0,g="&nv=0&st=4&v=bridge-0.2&rnd=",h={REFRESH_IM:1,SEND_INVITE:3,ACCEPT_INVITE:4,SEND_MESS:5,VISITOR_IM:6,SERVER_IM:7,START_IM:0},v=["subId","sessionId","eventId","chatId","from","open","valid","count"],y={visitor_count:0};return window.BDBridgeStat=function(e,t,n){s(e,n)},function(){u.on("stat",s),l.init()}}),define("front/rcv/leave",["require","../base/event","../base/emitter","../net/img","../base/string","../data/config"],function(require){function e(t){if(!c){c=!0,n.un(window,"unload",e),l.bid=t.bid||l.bid,l.siteid=t.siteid||l.siteid,l.ucid=t.ucid||l.ucid;var s={data:{bid:l.bid,siteid:l.siteid,ucid:l.ucid}};if(l.bid){var d=o.getJsFunctionResult();if(d||0===d){var f={jscode:d};f=a.objectToString(f),s.data.tag=f}r.request(u.LEAVE,s),i.emit("rcv:leave",s.data)}}}function t(t){l.bid=t.bid||"",l.siteid=t.siteid||"",l.ucid=t.ucid||"",n.on(window,"unload",e,!1),n.on(window,"beforeunload",e,!1)}var n=require("../base/event"),i=require("../base/emitter"),r=require("../net/img"),a=require("../base/string"),o=require("../data/config"),s=o.getRcvRoot(),u={LEAVE:s+"Leave.php"},c=!1,l={state:0};return{init:t,leave:e}}),define("front/rcv/refresh",["require","../net/jsonp","../base/emitter","../base/string","../data/config","../log/log"],function(require){function e(e){if(e.tag){var t={bid:_.bid||"",s:"web",siteid:_.siteid||"",t:(new Date).getTime(),type:2,op:e.tag.op};if(e.tag.op===v)o.setJsFunction(e.tag.val),t.val=encodeURIComponent(e.tag.val);else if(e.tag.op===y)o.isAuthCode=!0;else if(e.tag.op===b)o.isSecondVerify=!0;t.jsfunction=encodeURIComponent(o.jscodeForLog()),t.jscode=encodeURIComponent(o.getJsFunctionResult()),s.sendLog(module,w,t)}if(h=m,_.callback)_.callback(e);else if(0===e.saved)x.stop();r.emit("rcv:refresh",e)}function t(){var e={bid:_.bid||"",s:"web",siteid:_.siteid||"",t:(new Date).getTime(),type:1};s.sendLog(module,w,e),h=m}function n(){if(p){h=g;var r={data:{bid:_.bid||"",siteid:_.siteid||"",ucid:_.ucid||""},onsuccess:e,onfail:t},s=o.getJsFunctionResult();if(s||0===s){var u={jscode:s};u=a.objectToString(u),r.data.tag=u}i.request(c.REFRESH,r),setTimeout(function(){n()},_.refreshTime)}}var i=require("../net/jsonp"),r=require("../base/emitter"),a=require("../base/string"),o=require("../data/config"),s=require("../log/log"),u=o.getRcvRoot(),c={REFRESH:u+"Refresh.php",REJECT:u+"Reject.php"},l=5e3,d=15e3,f=function(){},p=!0,m=1,g=2,h=1,v=2,y=4,b=3,module="attack",w="attack",_={siteid:"",bid:"",ucid:"",refreshTime:l,timeout:d,callback:f,timer:null},x={};return x.start=function(e){_.siteid=e.siteid,_.ucid=e.ucid,_.bid=e.bid||"",_.refreshHandler=e.callback||f,_.refreshTime=e.refreshTime||l,p=!0,n()},x.stop=function(){p=!1},x.revert=function(){if(h!=m)setTimeout(function(){x.revert()},500);else p=!0,n()},x}),define("front/rcv/entered",["require","exports","../base/emitter","./refresh","./leave","../base/json","../net/img","../data/group","../common/identity","../data/config","../prevent/main","../base/string","../log/log","../storage/localStorage"],function(require,exports){function e(e,t){var n=l.getLSKey(e),i=t||"";g.setItem(n,i)}function t(t){var n={s:"web",t:(new Date).getTime(),type:3,loadingtime:(new Date).getTime()-d.getStartTime()};if(e("bid",t.bid),m.sendLog(module,b,n),t.jscode)d.setJsFunction(t.jscode);if(t.isAuthCode)if(d.isAuthCode=!0,t.url){var i=d.getImRoot();f.URL.SEND_CODE=i+t.url.checkurl,f.URL.GET_CODE=i+t.url.geturl}if(t.isSecondVerify)d.isSecondVerify=!0;v.bid=t.bid;var r={bid:t.bid,siteid:d.getSiteId(),ucid:d.getUcId(),from:t.from,word:t.word,wordid:t.wordid,wordtype:t.wordtype,referrer:t.referrer,title:t.title,location:t.location,peerid:t.peerid};if(t.zhixin&&(r.zhixin=t.zhixin),"undefined"!=typeof t.ls)r.ls=t.ls+"";var a=t.service_type;a&&a>0&&(r.servertype=t.service_type),d.setModelData(r)}function n(e){var t={bid:v.bid,siteid:d.getSiteId(),ucid:d.getUcId()};if(d.getJsFunctionResult()||0===d.getJsFunctionResult()){var n={jscode:d.getJsFunctionResult()};n=p.objectToString(n),t.tag=n}u.request(y.REJECT,{data:t})}function i(){a.on("rcv:reject",n)}function r(e,n){if(0===v.state){v.state=1;var r={siteid:e.siteid||"",ucid:e.ucid||"",bid:e.bid||n.bid},u={siteid:e.siteid||"",ucid:e.ucid||"",bid:e.bid||n.bid};t(n),i(),o.start(r),s.init(u),c.handleGroup(n),a.emit("rcv:enter",n);var l=d.getStartTime()||(new Date).getTime(),f=(new Date).getTime(),p=f-l;a.emit("stat","LOAD_TIME",{cost:p})}}var a=require("../base/emitter"),o=require("./refresh"),s=require("./leave"),u=(require("../base/json"),require("../net/img")),c=require("../data/group"),l=require("../common/identity"),d=require("../data/config"),f=require("../prevent/main"),p=require("../base/string"),f=require("../prevent/main"),p=require("../base/string"),m=require("../log/log"),g=require("../storage/localStorage"),h=d.getRcvRoot(),v={state:0},y={REJECT:h+"Reject.php"},module="attack",b="attack";return r}),require(["front/common/identity","front/data/config","front/common/stat","front/storage/localStorage","front/rcv/entered","front/webim/main"],function(e,t,n,i,r,a){function o(){var t=e.getBSLNs();return t.data||null}function s(t){var n=e.getBSLNs();n.callback=t}function u(e){r({siteid:c,ucid:l,bid:d},e)}n();var c=t.getSiteId(),l=t.getUcId(),d=i.getItem(e.getLSKey("bid"));a.init();var f=o();if(f)return void u(f);else return void s(u)});

})(qiao.define, qiao.require);