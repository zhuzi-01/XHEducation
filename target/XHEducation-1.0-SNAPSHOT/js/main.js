(function (define, require) {


define("front/base/array",["require","exports","./lang"],function(require,exports){"use strict";var e=require("./lang");exports.indexOf=function(t,n){if(e.isNative([].indexOf))return t.indexOf(n);for(var i,r=0,a=t.length;a>r;r++)if(i=t[r],i===n)return r;return-1}}),define("front/base/emitter",["require","exports","./array"],function(require,exports){"use strict";var e=require("./array").indexOf,t={};exports.on=function(e,n){(t[e]=t[e]||[]).push(n)},exports.once=function(e,t){function n(){exports.off(e,n),t.apply(this,arguments)}exports.on(e,n)},exports.off=function(n,i){var r=arguments.length;if(0===r)return void(t={});if(1===r)return void delete t[n];var a=t[n],o=e(a,i);if(o>-1)a.splice(o,1)},exports.emit=function(e){var n=[].slice.call(arguments,1),i=t[e];if(i)for(var r=0,a=i.length;a>r;r++)i[r].apply(this,n)}}),define("front/webimlite/im/font",["require","../base/dom","../base/browser","../base/event","qiao-im-sdk","../base/emitter"],function(require){var e=require("../base/dom"),t=require("../base/browser"),n=require("../base/event"),i=(require("qiao-im-sdk"),require("../base/emitter")),r=(e.g,n.on),a=["宋体","楷体_GB2312","黑体","隶书","Times New Roman","Arial"],o=[{text:"8",value:"8pt"},{text:"9",value:"9pt"},{text:"10",value:"10pt"},{text:"11",value:"11pt"},{text:"12",value:"12pt"},{text:"14",value:"14pt"},{text:"16",value:"16pt"},{text:"18",value:"18pt"},{text:"20",value:"20pt"},{text:"22",value:"22pt"},{text:"24",value:"24pt"},{text:"26",value:"26pt"},{text:"28",value:"28pt"},{text:"36",value:"36pt"},{text:"48",value:"48pt"},{text:"72",value:"72pt"}],s='<table border="0" cellspacing="0" cellpadding="0"><tr><td><a href="#"><span style="background-color:#990000"></span></a></td><td><a href="#"><span style="background-color:#ff0000"></span></a></td><td><a href="#"><span style="background-color:#ff9900"></span></a></td><td><a href="#"><span style="background-color:#ffffff"></span></a></td></tr><tr><td><a href="#"><span style="background-color:#ffff00"></span></a></td><td><a href="#"><span style="background-color:#99ff99"></span></a></td><td><a href="#"><span style="background-color:#006600"></span></a></td><td><a href="#"><span style="background-color:#666666"></span></a></td></tr><tr><td><a href="#"><span style="background-color:#99ccff"></span></a></td><td><a href="#"><span style="background-color:#000099"></span></a></td><td><a href="#"><span style="background-color:#990066"></span></a></td><td><a href="#"><span style="background-color:#000000"></span></a></td></tr></table>',u={wrap:null,_b:!1,_i:!1,_u:!1,view:{}},exports={};i.mixin(exports);var c={init:function(t){var n=document.createDocumentFragment(),i=u.view;e.addClass(t,"BD-QIAO-IM-FONT-WRAP"),i.family=c.createSelect("m-font-family-select",a),n.appendChild(i.family),i.fontSize=c.createSelect("m-font-size-select",o,"9pt"),n.appendChild(i.fontSize),i.bold=e.create("a",{className:"m-font-bold m-font-btn",title:"加粗"}),i.italic=e.create("a",{className:"m-font-italic m-font-btn",title:"斜体"}),i.underline=e.create("a",{className:"m-font-underline m-font-btn",title:"下划线"}),i.fontColor=e.create("a",{className:"m-font-color m-font-btn",title:"字体颜色"}),i.palette=e.create("div",{className:"m-font-palette"}),i.palette.style.display="none",i.palette.innerHTML=s,n.appendChild(i.bold),n.appendChild(i.italic),n.appendChild(i.underline),n.appendChild(i.fontColor),n.appendChild(i.palette),t.appendChild(n),u.wrap=t,t.style.display="none",c.bindEvents()},createSelect:function(t,n,i){var r,a,o=e.create("select",{className:t||""}),s=Object.prototype.toString,u=0;for(r=0;a=n[r];r++)if("[object Object]"===s.call(a)){if(a.value===i)u=r;o.options.add(new Option(a.text,a.value))}else{if(a===i)u=r;o.options.add(new Option(a,a))}return o.selectedIndex=u,o},bindEvents:function(){var e=u.view;r(e.family,"change",d.setFontFamily),r(e.fontSize,"change",d.setFontSize),r(u.wrap,"click",d.clickHandle),r(e.palette,"click",d.onColorSelect)},bindBlankEvent:function(){r(document,"click",d.onBlankClick)},unbindBlankEvent:function(){n.un(document,"click",d.onBlankClick)},showSelect:function(){var e=u.view;if("none"!==u.wrap.style.display)if(t.ie)e.family.style.visibility="visible",e.fontSize.style.visibility="visible"}},d={onColorSelect:function(e){var t=e||window.event,n=t.target||t.srcElement;if("span"===n.tagName.toLowerCase())d.setColor(t,n)},setFontFamily:function(){exports.emit("fontfamilychange",this.options[this.selectedIndex].value)},setFontSize:function(){exports.emit("fontsizechange",this.options[this.selectedIndex].value)},onBlankClick:function(e){var t=e||window.event,n=t.target||t.srcElement;if(n!==u.view.palette)d.hidePalette()},clickHandle:function(t){var n=t||window.event,i=n.target||n.srcElement;if(e.hasClass(i,"m-font-bold"))d.setBold(i);else if(e.hasClass(i,"m-font-italic"))d.setItalic(i);else if(e.hasClass(i,"m-font-underline"))d.setUnderline(i);else if(e.hasClass(i,"m-font-color"))d.showPalette(n,i)},setBold:function(t){if(!u._b)e.addClass(t,"m-font-bold-on"),u._b=!0;else e.removeClass(t,"m-font-bold-on"),u._b=!1;exports.emit("fontboldchange",u._b)},setItalic:function(t){if(!u._i)e.addClass(t,"m-font-italic-on"),u._i=!0;else e.removeClass(t,"m-font-italic-on"),u._i=!1;exports.emit("fontitalicchange",u._i)},setUnderline:function(t){if(!u._u)e.addClass(t,"m-font-underline-on"),u._u=!0;else e.removeClass(t,"m-font-underline-on"),u._u=!1;exports.emit("fontunderlinechange",u._u)},showPalette:function(t,i){n.stopPropagation(t),i.blur(),u.view.palette.style.display="",e.addClass(i,"m-font-color-on"),c.bindBlankEvent()},hidePalette:function(){var t=u.view;t.palette.style.display="none",e.removeClass(t.fontColor,"m-font-color-on"),c.unbindBlankEvent()},setColor:function(e,t){n.preventDefault(e),d.hidePalette(),exports.emit("fontcolorchange",t.style.backgroundColor)}};return exports.init=c.init,exports.toggle=function(t){var n=u.wrap;if(t.blur(),""===n.style.display)n.style.display="none",e.removeClass(t,"btn-font-active");else n.style.display="",e.addClass(t,"btn-font-active"),c.showSelect()},exports.hideSelect=function(){var e=u.view;if("none"!==u.wrap.style.display){if(t.ie)e.family.style.visibility="hidden",e.fontSize.style.visibility="hidden";e.palette.style.display="none"}},exports.showSelect=c.showSelect,exports}),define("front/webimlite/im/face",["require","../base/dom","../base/event","../base/emitter","qiao-im-sdk","./config"],function(require){var e=require("../base/dom"),t=require("../base/event"),n=require("../base/emitter"),i=(require("qiao-im-sdk"),e.g),r=require("./config"),a=t.on,o=t.un,s={ROOT:r.URL.POOL_ROOT+r.FACE_ROOT,FACE_TAB:"FaceTab",FACE_GROUP:"FaceGroup",ROW:6,CELL:12,wrap:null,curEle:null},exports={};n.mixin(exports);var u={init:function(t,n,a){s.ROOT=r.URL.POOL_ROOT+r.FACE_ROOT;var o,c,d,l,f=[],m=[],p=r.face.items,g=s.ROOT,h=/^((http|https|ftp):)/.test(g)?g:window.location.protocol+g;t=i(t),n=n||s.ROW,a=a||s.CELL,f.push('<table cellspacing="0" cellpadding="0">');for(o in p)m.push({name:p[o].name,md5:p[o].md5+"."+p[o].type});for(var d=0,v=0;n>d;d++){f.push("<tr>");for(var c=0;a>c;c++){if(l=m[v])f.push('<td><a href="javascript:;"><img src="'+h+l.md5+'" title="'+l.name+'" alt="'+l.name+'" class="J-face-item" /></a></td>');else f.push("<td><span></span></td>");v++}f.push("</tr>")}f.push("</table>"),t.innerHTML=f.join(""),e.addClass(t,"BD-QIAO-IM-FACE-WRAP"),s.wrap=t,t.style.display="none",u.bindEvents(t)},bindEvents:function(e){a(e,"click",c.clickHandle)},bindBlankEvent:function(){a(document,"click",c.onBlankClick)},unbindBlankEvent:function(){o(document,"click",c.onBlankClick)},hide:function(){s.wrap.style.display="none",exports.emit("facehide",s.curEle),u.unbindBlankEvent()}},c={onBlankClick:function(e){var t=e||window.event,n=t.target||t.srcElement;if(n!==s.curEle)u.hide()},clickHandle:function(n){var i=n||window.event,r=i.target||i.srcElement;if(t.stopPropagation(i),e.hasClass(r,"J-face-tab"))c.switchTab(i,r);else if(e.hasClass(r,"J-face-item"))c.insert(i,r)},switchTab:function(n,r){t.preventDefault(n),e.addClass(r,"active"),r.blur();var a,o,u=i(s.FACE_TAB).getElementsByTagName("a"),c=i(s.FACE_GROUP).getElementsByTagName("table");for(a=0,o=u.length;o>a;a++){if(u[a]!==r)e.removeClass(u[a],"active");if(c[a].id+"Tab"!==r.id)c[a].style.display="none";else c[a].style.display=""}},insert:function(e,n){t.preventDefault(e),u.hide();var i='<img src="'+n.src+'" data-type="face" alt="'+n.title+'" data-type="face"/>';exports.emit("faceselect",i)}};return exports.init=u.init,exports.show=function(e){s.curEle=e,s.wrap.style.display="",exports.emit("faceshow"),u.bindBlankEvent()},exports.hide=u.hide,exports}),define("front/webimlite/im/editor",["require","../base/dom","../base/browser","../base/event","../base/emitter","qiao-im-sdk","./face","./font","../base/localstorage"],function(require){function e(){var e=d.getItem("BRIDGE_HOTKEY");if("E"===e)n.addClass(n.g("E"),"selected"),n.removeClass(n.g("CE"),"selected");else n.removeClass(n.g("E"),"selected"),n.addClass(n.g("CE"),"selected")}function t(){m.shortKey.style.display="none",n.removeClass(n.q("m-send-method-btn")[0],"arrow")}var n=require("../base/dom"),i=require("../base/browser"),r=require("../base/event"),a=require("../base/emitter"),o=n.create,s=r.on,u=(require("qiao-im-sdk"),require("./face")),c=require("./font"),d=require("../base/localstorage"),l={tool:'<a href="#" class="m-lite-tool-btn btn-face" title="选择表情"></a><a href="#" class="m-lite-tool-btn btn-export" title="导出聊天记录"></a>',BTN:'<div class="m-send-btn"><a class="m-send-main btn-send">发送</a><span class="m-send-method-btn"><i></i></span></div>',SHORTKEY:'<a href="#" id="E">按Enter发送</a><a href="#" id="CE">按Ctrl+Enter发送</a>',editor:'<html><head><style type="text/css">html,body{height:100%;padding:0px;margin:0px; overflow-x:hidden}p{margin:0px}img{margin:0 2px}</style></head><body style="font-size:9pt;padding:0 5px;line-height:1.5;font-family:微软雅黑;cursor:text;box-sizing:border-box;overflow-y:auto;*overflow:auto;"></body></html>'},f="CE",m={},exports={};a.mixin(exports);var p={getCursorTimer:null},g=300,h={},v={INIT:function(t,n){var i;if(m.tool=o("div",{className:"m-lite-tool"}),m.tool.innerHTML=l.tool,m.face=o("div",{className:"m-lite-tool-face"}),m.tool.appendChild(m.face),m.font=o("div",{className:"m-lite-tool-font"}),m.tool.appendChild(m.font),m.btn=o("div",{className:"m-lite-btn",id:"send"}),n.bgColor)m.btn.style.cssText="background-color:"+n.bgColor;if(m.btn.innerHTML=l.BTN,m.shortKey=o("div",{className:"m-send-method",style:"display: none"}),m.shortKey.innerHTML=l.SHORTKEY,m.toolAndSend=o("div",{className:"m-lite-tool-and-send"}),m.clear=o("div",{className:"m-lite-clear"}),m.toolAndSend.appendChild(m.tool),m.toolAndSend.appendChild(m.btn),m.toolAndSend.appendChild(m.clear),m.btn.appendChild(m.shortKey),m.inputArea=o("div",{className:"m-lite-input-area"}),m.input=o("iframe",{frameborder:0,id:"editor"}),m.inputArea.appendChild(m.input),t.appendChild(m.inputArea),t.appendChild(m.toolAndSend),m.wrap=t,u.init(m.face,6,10),c.init(m.font),i=m.input.contentWindow.document,i.open(),i.write(l.editor),i.close(),i.designMode="on",v.bindEvents(),null===d.getItem("BRIDGE_HOTKEY")){var r=new Date;r.setFullYear(r.getFullYear()+1),d.setItem("BRIDGE_HOTKEY",f,{expires:r})}e()},bindEvents:function(){var e=m.input.contentWindow.document;if(s(m.wrap,"click",h.clickHandle),s(e,"keydown",h.handleInput),s(e,"click",h.clickMontior),s(document,"click",h.hideShortKey),s(m.shortKey,"click",h.changeShortKey),i.ie)s(window.document.body,"click",h.stopAutoSaveRange),s(e,"click",h.autoSaveRange),s(e,"keyup",h.autoSaveRange),s(e,"select",h.autoSaveRange);u.on("faceshow",h.onFaceShow),u.on("facehide",h.onFaceHide),u.on("faceselect",h.onFaceSelect),c.on("fontshow",h.onFontShow),c.on("fonthide",h.onFontHide),c.on("fontboldchange",h.onFontBoldChange),c.on("fontitalicchange",h.onFontItalicChange),c.on("fontunderlinechange",h.onFontUnderlineChange),c.on("fontfamilychange",h.onFontFamilyChange),c.on("fontsizechange",h.onFontSizeChange),c.on("fontcolorchange",h.onFontColorChange)},getRange:function(){var e=m.input.contentWindow;if(i.ie&&i.ie<11)return e.document.selection.createRange();else{var t=e.getSelection();return t.rangeCount?t.getRangeAt(0):e.document.createRange()}},getEditorBody:function(){return m.input.contentWindow.document.body},editorFocus:function(){var e=m.input.contentWindow;e.focus();var t=p.range||v.getRange();if(i.ie<11)t.select();else{var n=e.getSelection();n.removeAllRanges(),n.addRange(t)}},getEditorStyle:function(){var e,t,n={},i=v.getEditorBody(),r=["fontFamily","fontSize","color","fontWeight","fontStyle","textDecoration"];for(e=0;t=r[e];e++)if(i.style[t])n[t]=i.style[t];return n},isInEditor:function(e){var t=m.input.contentWindow.document.body,n=window.document.body,i=e.focusNode||e.commonAncestorContainer||e.parentElement();do if(i===t)return!0;else if(i===n)return!1;else i=i.parentNode;while(i)}};return h={clickMontior:function(){exports.emit("focus"),u.hide(),t()},hideShortKey:function(e){var n=e.target||e.srcElement,i=n.tagName.toLowerCase();if("i"===i&&n.parentNode.className.indexOf("m-send-method-btn")>-1||n.className.indexOf("m-send-method-btn")>-1)return!1;else return void t()},changeShortKey:function(t){var n=t.target||t.srcElement;d.setItem("BRIDGE_HOTKEY",n.id),e()},clickHandle:function(e){var t=e||window.event,i=t.target||t.srcElement;if(n.hasClass(i,"btn-face"))h.showFace(i);else if(n.hasClass(i,"btn-font"))h.toggleFont(i);else if(n.hasClass(i,"btn-export"))h.exportHistory()},saveRange:function(){var e=v.getRange();if(v.isInEditor(e))p.range=e},autoSaveRange:function(){h.saveRange(),h.stopAutoSaveRange(),p.getCursorTimer=setTimeout(function(){h.autoSaveRange()},g)},stopAutoSaveRange:function(){clearTimeout(p.getCursorTimer)},exportHistory:function(){exports.emit("exporthistory")},onFontBoldChange:function(e){v.editorFocus();var t=v.getEditorBody();t.style.fontWeight=e?"bold":"normal"},onFontItalicChange:function(e){v.editorFocus();var t=v.getEditorBody();t.style.fontStyle=e?"italic":"normal"},onFontUnderlineChange:function(e){v.editorFocus();var t=v.getEditorBody();t.style.textDecoration=e?"underline":"none"},onFontFamilyChange:function(e){v.editorFocus();var t=v.getEditorBody();t.style.fontFamily=e?e:"宋体"},onFontSizeChange:function(e){v.editorFocus();var t=v.getEditorBody();t.style.fontSize=e?e:"9pt"},onFontColorChange:function(e){v.editorFocus();var t=v.getEditorBody();t.style.color=e?e:"#000"},showFace:function(e){e.blur(),n.addClass(e,"btn-face-active"),u.show(e)},toggleFont:function(e){c.toggle(e)},onFaceShow:function(){c.hideSelect()},onFaceHide:function(e){if(c.showSelect(),e)n.removeClass(e,"btn-face-active")},onFaceSelect:function(e){var t=m.input.contentWindow,n=t.document;if(t.focus(),i.ie){if(i.ie<11){var r=p.range||v.getRange();r.select(),r.pasteHTML(e),r.select()}else{var a=t.getSelection(),r=a.getRangeAt(0),o=p.range?p.range:r,s=n.createElement("span");r.deleteContents(),s.innerHTML=e,o.insertNode(s),o.setStartAfter(s),r.setStartAfter(s),r.collapse(!0),a.removeAllRanges(),a.addRange(r)}h.saveRange();for(var u=n.getElementsByTagName("img"),c=u.length,d=0;c>d;d++)u[d].onresizestart=function(){return!1}}else n.execCommand("insertHTML",!1,e)},forbid:function(e){if(116===e.keyCode){if(i.ie)e.keyCode=0;return r.preventDefault(e),!1}if(e.ctrlKey&&82===e.keyCode||e.altKey&&39===e.keyCode||e.altKey&&37===e.keyCode||e.shiftKey&&121===e.keyCode)return r.preventDefault(e),!1;else return void 0},handleInput:function(e){var t=e||window.event;if(h.forbid(t),83===t.keyCode&&t.altKey)return r.preventDefault(t),void exports.emit("editorsend");if("CE"===d.getItem("BRIDGE_HOTKEY")||null===d.getItem("BRIDGE_HOTKEY")){if(13===t.keyCode&&t.ctrlKey&&!n.q("m-lite-opt-unablebtn").length)exports.emit("editorsend")}else if(13===t.keyCode){if(r.preventDefault(t),t.ctrlKey||t.shiftKey){var a,o=n.g("editor").contentWindow,s=o.document,u='<br><span style="display:none" id="HackBlank">&nbsp;</span>';if(i.ie)if(i.ie<11)a=s.selection.createRange(),a.select(),a.pasteHTML(u),a.select();else{var c=o.getSelection();a=c.getRangeAt(0);var l=o.range?o.range:a,f=s.createElement("span");a.deleteContents(),f.innerHTML=u,l.insertNode(f),l.setStartAfter(f),a.setStartAfter(f),a.collapse(!0),c.removeAllRanges(),c.addRange(a)}else{if(i.firefox||i.chrome)u="<div><br></div>";s.execCommand("insertHTML",!1,u)}var m=s.getElementById("HackBlank");return void(m&&m.parentNode.removeChild(m))}if(!n.hasClass(n.g("send"),"m-lite-opt-unablebtn"))exports.emit("editorsend")}}},exports.getStyle=v.getEditorStyle,exports.getContent=function(){return v.getEditorBody().innerHTML},exports.clear=function(){v.getEditorBody().innerHTML=""},exports.isMultilineMode=function(){return"CE"===f},exports.init=v.INIT,exports}),define("front/webimlite/im/lang",["require","exports"],function(require,exports){exports.TEXT={WELCOME:"您好！有什么需要帮忙的么？",DEFAULT_CSNAME:"在线客服",FILE_UNSUPPORT:"[文件]",FACE_UNSUPPORT:"[扩展头像]",IMG_UNSUPPORT:"[图片]",CFACE_UNSUPPORT:"[自定义头像]",ONLINE:"客服#{0}已经上线了，您现在可以发起沟通！",TRANSFER:"您已被转移给其他客服",INPUT:"正在输入..."},exports.ERROR={INIT:"对不起，转接失败，请稍后重试连接",CONFLICT:"您输入的内容存在安全隐患，发送失败",OFFLINE:"客服已经离线，您目前无法发送消息",SEND_FAIL:"消息发送失败，请稍后重试",DROP_KICKED:"本次沟通结束，请您继续浏览网站",DROP_CHATOVER:"本次沟通结束，请您继续浏览网站",KICKED:"由于网络原因，您已离线"}}),define("front/webimlite/im/config",["require","exports"],function(require,exports){exports.FACE_ROOT="img/webim/defaultface/";var e={};exports.jscode={jscode:""},exports.authCode="";var t={title:"默认分组",items:[{name:"微笑",shortcut:":)",md5:"c7b91efe2e01b35d9ff088993ca9a11a",type:"png",frame:"0"},{name:"大笑",shortcut:":D",md5:"73a512491b0e3e12099ed7900cd4482d",type:"gif",frame:"0"},{name:"偷笑",shortcut:"(tx)",md5:"5394895d38f997b201036acf646ab181",type:"gif",frame:"2"},{name:"憨笑",shortcut:":o",md5:"2b257b850465aa84dfa9d7170515ac57",type:"gif",frame:"0"},{name:"得意",shortcut:"(dy)",md5:"8372252a0bbffba66ded3a8fa71ff410",type:"gif",frame:"0"},{name:"可爱",shortcut:"(ka)",md5:"e51b1712edec1b5c5f751fbb7374a3b0",type:"gif",frame:"0"},{name:"害羞",shortcut:"(hx)",md5:"6d3fdbc79e3568e66a1f3411dfc0a30c",type:"gif",frame:"4"},{name:"乖",shortcut:"(oo)",md5:"a024381379da74153694c4ebb9f75014",type:"gif",frame:"0"},{name:"淘气",shortcut:"(tq)",md5:"ee5ab8e89776a17d26367d131f77bea3",type:"png",frame:"0"},{name:"调皮",shortcut:":p",md5:"1cc3b63e1bf9753bcecf8e99185c3d74",type:"png",frame:"2"},{name:"流泪",shortcut:"(ll)",md5:"3fbeb731a465584bc3b2c5b84333860c",type:"gif",frame:"2"},{name:"大哭",shortcut:":(",md5:"e7daaaf6031549140d88e46154445e2c",type:"gif",frame:"2"},{name:"撇嘴",shortcut:"(pz)",md5:"95af917d5ccfb614ec03731f686f1c49",type:"png",frame:"0"},{name:"闭嘴",shortcut:":-#",md5:"d267f14a949cc1c67d5afebea631b95f",type:"gif",frame:"2"},{name:"嘘",shortcut:"(xu)",md5:"2d962d090c00a534c3cb604a3409c8a9",type:"gif",frame:"3"},{name:"鄙视",shortcut:"(bs)",md5:"6e5a6dd0094a5f413c9d40d703552563",type:"gif",frame:"0"},{name:"傲慢",shortcut:"(am)",md5:"a7792b792338c0824e4eba4e8f53f248",type:"png",frame:"0"},{name:"白眼",shortcut:"(fc)",md5:"9046a275b6fcc032d552c2be28deda85",type:"gif",frame:"0"},{name:"思考",shortcut:"(sk)",md5:"f68391b534ad9c6e2980e1c9f4248b7b",type:"gif",frame:"2"},{name:"困",shortcut:"|-)",md5:"2939123abba6052d64383ad7cd62983d",type:"gif",frame:"1"},{name:"睡",shortcut:"(zz)",md5:"e79f016440edafd4ba3f5c7f45077883",type:"gif",frame:"2"},{name:"汗",shortcut:"(lh)",md5:"c0d21388d259446932b1d2c84a243c4b",type:"gif",frame:"1"},{name:"尴尬",shortcut:":$",md5:"f57200e594d2c74dae63321a685c0a01",type:"gif",frame:"2"},{name:"惊讶",shortcut:":-o",md5:"f3807c4d0dfd29864538bff866f8e8d2",type:"png",frame:"0"},{name:"惊恐",shortcut:"(jk)",md5:"2e855936c4d0e3a8d8925c6ff7033802",type:"gif",frame:"0"},{name:"疑问",shortcut:"(?)",md5:"efa51b9fd7f230928f589f72de2510ab",type:"gif",frame:"0"},{name:"晕",shortcut:":s",md5:"3b9b9fa53da41b2be65de19bbfa3f477",type:"gif",frame:"0"},{name:"敲打",shortcut:"(qd)",md5:"7add275c91a9130f9e3b1ba52eb8e8d6",type:"GIF",frame:"2"},{name:"难过",shortcut:":(",md5:"fd0771f664dee6d809213572cb825efa",type:"png",frame:"0"},{name:"委屈",shortcut:"(wq)",md5:"125b1fee2dcae224a46500185c41f74e",type:"gif",frame:"0"},{name:"色",shortcut:"(se)",md5:"a9bb9d9d9bd83c530585f32139ca7e07",type:"gif",frame:"0"},{name:"抓狂",shortcut:"(zk)",md5:"2748bd8030e2db488dbf96b833e73233",type:"gif",frame:"1"},{name:"愤怒",shortcut:":@",md5:"60f3c02d34d47ec70a1a93304606d5bf",type:"GIF",frame:"0"},{name:"吐",shortcut:"+o(",md5:"70347b086d5d1b58cb6afac1c5a709b6",type:"gif",frame:"2"},{name:"衰",shortcut:"(sh)",md5:"c93d82cc99597cd2af1e1de3bfe96dcc",type:"png",frame:"0"},{name:"再见",shortcut:"(zj)",md5:"1d6e9bfd1eb9db00a2f5002660de7bd5",type:"gif",frame:"0"},{name:"左拥抱",shortcut:"({)",md5:"6f2c8b9cc8b654852b8765f9de36ea7b",type:"png",frame:"0"},{name:"右拥抱",shortcut:"(})",md5:"835c7ed5ebc0638a4290dc2bc5075293",type:"png",frame:"0"},{name:"闪人",shortcut:"(sr)",md5:"638e9e5693be2e25b7fb49ef53dccd59",type:"png",frame:"0"},{name:"刀",shortcut:"(d)",md5:"79049e7bb24e1610fa3172ffc9c6afbe",type:"gif",frame:"2"},{name:"吻",shortcut:"(w)",md5:"b4717e8c1be2396f59424edb642f346f",type:"png",frame:"0"},{name:"爱情",shortcut:"(ai)",md5:"df8cd7fb1a5402081bba02ed27f3d460",type:"png",frame:"0"},{name:"心碎",shortcut:"(xs)",md5:"9a48f0d784b340130ddc548bbe0e41b1",type:"gif",frame:"1"},{name:"鲜花",shortcut:"(xh)",md5:"e0ef4acf693e8bd332304539c3d556e6",type:"png",frame:"0"},{name:"枯萎",shortcut:"(kw)",md5:"e3d5d44d18592e744a877028ccd5ce7e",type:"png",frame:"0"},{name:"胜利",shortcut:"(sl)",md5:"c12b4546988745b970a528e9d4c7d36b",type:"gif",frame:"0"},{name:"OK",shortcut:"(ok)",md5:"ea9118eeb5d1251204aa06ac676d039c",type:"png",frame:"0"},{name:"大拇指",shortcut:"(n)",md5:"df9f3c4d0296f6971a88f38836da30b3",type:"gif",frame:"0"},{name:"弱",shortcut:"(r)",md5:"0700d37ba0b4b48503971f10d1e4b043",type:"gif",frame:"0"},{name:"握手",shortcut:"(ws)",md5:"af63cb39facadd039efa04da4b29c160",type:"gif",frame:"0"},{name:"蛋糕",shortcut:"(^)",md5:"71069905c70351d3b61d252c7bbea5cf",type:"gif",frame:"0"},{name:"咖啡",shortcut:"(kf)",md5:"a119c664f4d00bf17448bb4a77b761c0",type:"gif",frame:"0"},{name:"吃饭",shortcut:"(cf)",md5:"f64ed5b3c7d9c934847aeacda0743cbe",type:"png",frame:"0"},{name:"太阳",shortcut:"(#)",md5:"c6889c8bdd7ee08445e5009b803a29aa",type:"png",frame:"0"},{name:"月亮",shortcut:"(s)",md5:"7d1f68af6f74d00649c664a99f546b76",type:"png",frame:"0"},{name:"星星",shortcut:"(*)",md5:"0d11d94e64e06bc04c42d64a77834444",type:"png",frame:"0"},{name:"便便",shortcut:"(bb)",md5:"a811e4d3e0bf451c4716401ac251d056",type:"gif",frame:"0"},{name:"猪头",shortcut:"(zt)",md5:"8260d8878f182d0b3c6aa46d933fc216",type:"png",frame:"0"},{name:"钱",shortcut:"(q)",md5:"d6b4a948530ed9dbb34e53e63dfc910",type:"png",frame:"0"},{name:"Hi",shortcut:"(hi)",md5:"d98dc2c9584121f0a863c3d608cd3503",type:"png",frame:"2"}]};exports.face=t,exports.init=function(t){e.POOL_ROOT=t.poolRoot,e.HI_SERVER=t.IMroot,e.QIAO_ROOT=t.root},exports.URL=e}),define("front/webimlite/base/object",["require","exports"],function(require,exports){exports.extend=function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}}),define("front/webimlite/base/date",["require","exports"],function(require,exports){function e(e,t){var n="",i=0>e,r=String(Math.abs(e));if(r.length<t)n=new Array(t-r.length+1).join("0");return(i?"-":"")+n+r}exports.format=function(t,n){function i(e,t){n=n.replace(e,t)}if("string"!=typeof n)return t.toString();var r=t.getFullYear(),a=t.getMonth()+1,o=t.getDate(),s=t.getHours(),u=t.getMinutes(),c=t.getSeconds();return i(/yyyy/g,e(r,4)),i(/yy/g,e(parseInt(r.toString().slice(2),10),2)),i(/MM/g,e(a,2)),i(/M/g,a),i(/dd/g,e(o,2)),i(/d/g,o),i(/HH/g,e(s,2)),i(/H/g,s),i(/hh/g,e(s%12,2)),i(/h/g,s%12),i(/mm/g,e(u,2)),i(/m/g,u),i(/ss/g,e(c,2)),i(/s/g,c),n},exports.dataFormat=function(e){if(e){var t=e.getHours();t=t>9?t:"0"+t;var n=e.getMinutes();n=n>9?n:"0"+n;var i=e.getSeconds();i=i>9?i:"0"+i;var r=t+":"+n+":"+i;return r}}}),define("front/base/lang",[],function(){"use strict";function e(e){return"[object Array]"===n.call(e)}function t(e){return!(!e||!i.test(e))}var n={}.toString,i=/\{\s*\[(?:native code|function)\]\s*\}/i;return{isNative:t,isArray:t(Array.isArray)?Array.isArray:e,isObject:function(e){return e&&"[object Object]"===n.call(e)},isFunction:function(e){return e&&"[object Function]"===n.call(e)},instanceOf:function(e,t){return e&&e.hasOwnProperty&&e instanceof t},extend:function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}}}),define("front/data/config",["require","exports","../base/lang"],function(require,exports){"use strict";function e(){for(var e,t=location.href,n=0,i=null;e=r[n];n++)if(e.url==t||t.indexOf(e.url)>-1)!i&&(i=e),i&&i.url&&i.url.length<e.url.length&&(i=e);if(i)return i.pageid;else return"0"}var t=require("../base/lang"),n="undefined"!=typeof BDBridgeConfig?window.BDBridgeConfig:{},i=n.BD_BRIDGE_DATA||{},r=n.BD_BRIDGE_SPECIAL||[],a={},o=function(){for(var t,i=n.BD_BRIDGE_STYLE_ITEM||[],a=r&&r.length<=0?"0":e(),o=0;t=i[o];o++)if(t.pageid==a)return t}(),s="";return{getSiteId:function(){return i.siteid||""},getUcId:function(){return i.ucid||""},getSiteIdMd5:function(){return i.SITE_ID||""},getRoot:function(){return n.ROOT},getLogRoot:function(){return n.LOG_ROOT||"//scqiao.baidu.com/"},getPoolRoot:function(){return n.POOL_ROOT||"//hqiao.baidu.com/f/pool/"},getRcvRoot:function(){if("https:"===location.protocol)return"//p.qiao.baidu.com/";else return n.RCV_ROOT},getImRoot:function(){if("https:"===location.protocol)return"//p.qiao.baidu.com/";else return n.IM_ROOT||"//p.qiao.baidu.com/"},getFrontRoot:function(){return n.FRONT_ROOT},getMainId:function(){return i.mainid||""},getUserName:function(){return i.userName||""},getIsAiPrologue:function(){return n.isAiPrologue||0},getStyleConfig:function(module){if(!module)return o;else return o["BD_BRIDGE_"+module.toUpperCase()]||{}},setStyleConfig:function(module,e){if(module)module="BD_BRIDGE_"+module.toUpperCase(),o[module]=t.extend(o[module],e)},getAllowGroup:function(){return o.BD_BRIDGE_GROUP||[]},getPageId:function(){return"0"==o.pageid?"":o.pageid},getStyleId:function(){return o.styleid||""},setModelData:function(e){a=t.extend(a,e)},getModelData:function(e){if(!e)return a;else return a[e]},getStartTime:function(){return n.TIME_START},setJsFunction:function(e){s="return "+e},getJsFunctionResult:function(){if(s){var e=new Function(s);return e()()}else return null},getIsWebIm:function(){var e=this.getStyleConfig().BD_BRIDGE_WEBIM.webimtype;return e},isAuthCode:!1,authCode:"",isSecondVerify:!1,jscodeForLog:function(){return s}}}),define("front/common/identity",["require","../data/config"],function(require){function e(){var e=a;return window[e]||(window[e]={})}var t=require("../data/config"),n=t.getSiteId(),i="QIAO_COOKIE_",r="QIAO_LS_"+n+"_",a="QIAO_NS_BSL",o="bridge",s={bid:n+"bid24",data:n+"data",show:n+"show",instance:n+"instance",chat:n+"chat",startload:n+"startload",ack:n+"ack",firstInfo:n+"firstInfo",prevInfo:n+"previousInfo",offsetTime:n+"offsetTime"},u={BY_INVITE:4,BY_SELF:1,AUTO_INVITE:3,ENFORCE:5};return{cookieId:function(e){return i+e.toUpperCase()},getLSKey:function(e){return r+e.toUpperCase()},getFlashId:function(){return o},getFlashKey:function(e){return s[e]||""},getBSLNs:function(){return e()},getChatType:function(e){if(0===u[e])return 0;else return u[e]||u.BY_SELF}}}),define("front/base/Promise",[],function(){function e(){this._callbacks=[]}return e.prototype.then=function(t,n){var i,r=this;if(r._isdone)i=t.apply(n,r.result);else i=new e,r._callbacks.push(function(){var e=t.apply(n,arguments);if(e&&"function"==typeof e.then)e.then(i.done,i)});return i},e.prototype.done=function(){var e=this;e.result=arguments,e._isdone=!0;for(var t=0,n=e._callbacks.length;n>t;t++)e._callbacks[t].apply(null,arguments);e._callbacks=[]},e.prototype.promise=function(){var e=this;return{then:function(){e.then.apply(e,arguments)}}},e}),define("front/webimlite/base/zoom",["require"],function(require){function e(e,t,n){var i=e[0],r=e[1],a=t[0],o=t[1];if(i>a)r*=a/i,i=a;if(r>o)i*=o/r,r=o;if(n&&1>n)i*=n,r*=n;return[i,r]}return e}),define("front/webimlite/base/localstorage",["require","exports","./json","./browser"],function(require,exports){var e=require("./json"),t=require("./browser"),n=function(){var t,n=null,i=365;return{build:function(e){var n=this;return e=e||{},t=e.fileName||location.hostname,i=e.expires||i,n},_setup:function(){if(!n)try{n=document.createElement("input"),n.type="hidden",n.addBehavior("#default#userData"),document.body.appendChild(n)}catch(e){return!1}return!0},setItem:function(r,a){var o=this,s=new Date;if(o._setup())a="string"==typeof a?a:e.stringfy(a),s.setDate(s.getDate()+i),n.expires=s.toUTCString(),n.load(t),n.setAttribute(r,a),n.save(t)},getItem:function(e){var i=this;if(i._setup())return n.load(t),n.getAttribute(e)},removeItem:function(e){var i=this;if(i._setup())n.load(t),n.removeAttribute(e),n.save(t)},clear:function(){var e=new Date;e.setDate(e.getDate()-1),n.expires=e.toUTCString()}}}(),i={INTERVAL:1e3,ls:null,useTimer:t.ie&&t.ie<8,timer:null,keyEvent:{}},r={onStorage:function(e,t,n){var r=i.ls.getItem(e);return n=n||null,function(a){setTimeout(function(){a=a||window.storageEvent;var o=a.key,s=a.newValue;if(!o){var u=i.ls.getItem(e);if(u!==r)o=e,s=u}if(o===e)t&&t.call(n,a.oldValue||r,s),r=s},0)}}};exports.init=function(e){if(window.localStorage)i.ls=window.localStorage;else i.ls=n,i.ls.build(e)},exports.setItem=function(t,n){return n="string"==typeof n?n:e.stringify(n),i.ls.setItem(t,n)},exports.getItem=function(e){return i.ls.getItem(e)},exports.removeItem=function(e){return i.ls.removeItem(e)},exports.clear=function(){i.ls.clear()},exports.addStorageEvent=function(e,n){var a;if(!i.useTimer)if(a=r.onStorage(e,n),document.attachEvent&&!t.opera)document.attachEvent("onstorage",a);else window.addEventListener("storage",a,!1);else a=r.onStorage(e,n),i.timer=setInterval(function(){a({})},i.INTERVAL)},exports.removeStorageEvent=function(e,t){}}),define("qiao-im-sdk/messagePlugins/voice",["require"],function(require){var e,t,n={GET:'<span class="voice-tip">语音转译：</span><span>${voice}</span>'},exports={};return exports.decoder={voice:function(i){var r=e(i.c);return{type:"voice",text:t(n.GET,{voice:r.replace(/\r\n/gi,"<br/>").replace(/&amp;#xD;&amp;#xA;/gi,"<br/>").replace(/%2B/gi,"+")})}}},function(n){return e=n.lib.encodeHTML,t=n.lib.format,exports}}),define("qiao-im-sdk/messagePlugins/map",["require"],function(require){var e,t,n,i,r={GET:'<div class="map-location" data-type="map"><a href="http://map.baidu.com/mobile/webapp/place/marker/qt=inf&vt=map&act=read_share&code=/point=${point}&title=${title}&content=${c}"target="_blank"><img width="${width}" height="${height}"src="//api.map.baidu.com/staticimage?width=${width}&height=${height}&center=${lng},${lat}&markers=${lng},${lat}&zoom=15&markerStyles=-1,http://qiao.baidu.com/site/pinpc.png,-1" /><div>${content}</div></a></div>',GET_DEFAULT:'<div class="map-location" data-type="map"><span>${content}</span></div>',SEND:""},a={height:140,width:314,x:"",y:"",c:"内容",n:"标题"},exports={};return exports.decoder={map:function(n){t(a,n);var o=encodeURIComponent(a.c),s=encodeURIComponent(a.n),u=i(a.x,a.y,18),c=encodeURIComponent(u[0]+"|"+u[1]);if(""===a.x)return{type:"map",text:e(r.GET_DEFAULT,{content:a.c})};else return{type:"map",text:e(r.GET,{width:a.width,height:a.height,lng:a.x,lat:a.y,point:c,content:a.c,c:o,title:s})}}},function(r){var a=r.lib;return e=a.format,t=a.extend,n=a.pixelToLngLat,i=a.lngLatToPixel,exports}}),define("qiao-im-sdk/messagePlugins/img",["require"],function(require){var e,exports={},t={SEND:'<img md5="${md5}" token="${token}" bcsname="${name}" source="bcs" type="${type}" t="${imgtype}" n="screen"/>',GET:'<img data-fid="${bcsname}" src="${defaultImg}" data-type="img"/>'},n="//hqiao.baidu.com/f/pool/img/webim/loading.gif";return exports.decoder={img:function(i){return{type:"img",text:e(t.GET,{bcsname:i.bcsname,defaultImg:i.defaultImg||n})}}},exports.encoder={img:function(n){var i;return i=e(t.SEND,{md5:n.md5,token:n.token,name:n.fid,type:"img",imgtype:n.imgtype})}},function(t){return e=t.lib.format,
exports}}),define("qiao-im-sdk/messagePlugins/meta/phone",["require","../../base/string"],function(require){var e=require("../../base/string").format,t=/((\+86)|(86))?1([0-9]{10})/g,n={ENCODE:'<text c="${text}" type="card" subtype="phone" />'},exports={};return exports.encode=function(i,r,a){return i=i.replace(t,function(t){return a&&a.push(e(n.ENCODE,{text:t})),r})},exports}),define("qiao-im-sdk/messagePlugins/meta/qq",["require","../../base/string"],function(require){var e=require("../../base/string").format,t=(require("../../base/string").encodeHTML,/[1-9][0-9]{4,14}/i),n={ENCODE:'<text c="${text}" type="card" subtype="qq" />'},exports={};return exports.encode=function(i,r,a){return i=i.replace(t,function(t){return a&&a.push(e(n.ENCODE,{text:t})),r})},exports}),define("qiao-im-sdk/messagePlugins/meta/tel",["require","../../base/string"],function(require){var e=require("../../base/string").format,t=/(([0-9]{7,8})|([0-9]{4}|[0-9]{3})-([0-9]{7,8})|([0-9]{4}|[0-9]{3})-([0-9]{7,8})-([0-9]{4}|[0-9]{3}|[0-9]{2}|[0-9]{1})|([0-9]{7,8})-([0-9]{4}|[0-9]{3}|[0-9]{2}|[0-9]{1}))/g,n={ENCODE:'<text c="${text}" type="card" subtype="tel" />'},exports={};return exports.encode=function(i,r,a){return i=i.replace(t,function(t){return a&&a.push(e(n.ENCODE,{text:t})),r})},exports}),define("qiao-im-sdk/messagePlugins/meta/email",["require","../../base/string"],function(require){var e=require("../../base/string").format,t=/(\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+)/gi,n={ENCODE:'<text c="${text}" type="card" subtype="email" />'},exports={};return exports.encode=function(i,r,a){return i=i.replace(t,function(t){return a&&a.push(e(n.ENCODE,{text:t})),r})},exports}),define("qiao-im-sdk/messagePlugins/meta/img",["require","../../base/string"],function(require){var e=require("../../base/string").format,t={SEND:'<img md5="${md5}" token="${token}" bcsname="${name}" source="bcs" t="${type}" n="screen"/>',GET:'<img data-fid="${bcsname}" src="${defaultImg}" />'},n=/(<img[^>]+(:?(:?data-token=[^>]+data-md5=[^>]*)|(:?data-md5=[^>]+data-token=[^>]*))>)/gi,exports={};return exports.encode=function(i,r,a){var o,s=document.createElement("div"),u="",c="",d="",l="";return i=i.replace(n,function(n,i){if(s.innerHTML=n,o=s.getElementsByTagName("img")[0],c=o.getAttribute("data-md5"),u=o.getAttribute("data-token"),d=o.getAttribute("data-fid"),l=o.getAttribute("data-type"),!(c&&u&&d&&"img"===l))return n;else return a&&a.push(e(t.SEND,{md5:c,token:u,name:d,type:"img"})),r})},exports}),define("qiao-im-sdk/messagePlugins/meta/font",["require","../../base/main"],function(require){function e(e){return e=e.substr(5)+e.substr(3,2)+e.substr(1,2),parseInt(e,16)}function t(t){if(c.test(t))return e(t);else if(d.test(t))return n(t);return 0}function n(t){t=t.substring(4,t.length-1),t=t.split(",");var n=parseInt(t[0],10),i=parseInt(t[1],10),r=parseInt(t[2],10);if(n=n.toString(16),1===n.length)n="0"+n;if(i=i.toString(16),1===i.length)i="0"+i;if(r=r.toString(16),1===r.length)r="0"+r;return t=("#"+n+i+r).toUpperCase(),e(t)}function i(e){var t=e;if(isNaN(t))return"";else return t=(+t).toString(16).toUpperCase(),t=(u.COLOR.substr(1)+t).substr(t.length),t=u.COLOR.substr(0,1)+t.substr(4)+t.substr(2,2)+t.substr(0,2)}var r=require("../../base/main"),a=r.extend,o=r.format,s={SEND:'<font n="${family}" c="${color}" s="${size}" b="${weight}" i="${style}" ul="${decoration}" />',GET:'<div style="font-family:${family};font-size:${size};color:${color};font-weight:${weight};font-style:${style};text-decoration:${decoration};"></div>'},u={COLOR:"#000000",SIZE_UNIT:"pt"},exports={},c=/^\#[\da-f]{6}$/i,d=/^[rgb|RGB]/;return exports.encode=function(e){var n=a({},e||{});return n.family=n.fontFamily||"simsun",n.size=parseInt(n.fontSize,10)||12,n.color=n.color?t(n.color):0,n.weight=n.fontWeight?1:0,n.style="italic"===n.fontStyle?1:0,n.decoration="underline"===n.fontDecoration?1:0,n=o(s.SEND,n)},exports.decode=function(e){var t=a({},e||{});return t.family=t.n,t.size=parseInt(t.s,10)<0?"":t.s+u.SIZE_UNIT,t.color=t.c?i(t.c):"",t.weight="1"===t.b?"bold":"",t.style="1"===t.i?"italic":"",t.decoration="1"===t.ul?"underline":"",t=o(s.GET,t)},exports}),define("qiao-im-sdk/messagePlugins/meta/url",["require","../../base/string"],function(require){var e=require("../../base/string").format,t=require("../../base/string").encodeHTML,n=/(\b((https?|ftp|file):\/\/)?[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,i=/(<img[^>]+>)/im,r={DECODE:'<a target="_blank" href="${href}">${content}</a>',ENCODE:'<url ref="${ref}" />'},exports={};return exports.encode=function(a,o,s){for(var u=[];i.test(a);)u.push(RegExp.$1),a=a.replace(RegExp.$1,""+(u.length-1)+"");var c={};a=a.replace(n,function(n,i,a){if(/.+\.(net|com|cn|cc|edu|me|co|org|club|online)/gi.test(n))if(n.indexOf("@")>0)return n;else return c.ref=("www"===a?"http://":"")+i.replace(/&amp;/g,"&"),c.ref=t(c.ref),s&&s.push(e(r.ENCODE,c)),o;return n});for(var d=0;d<u.length;d++)a=a.replace(""+d+"",u[d]);return a},exports.decode=function(t){var n={},i=t.ref||t.ref_2;n.href=(/^http/.test(i)?"":"http://")+i;var a=t.c||t.ref;return n.content=a.replace(/\r\n/gi,"<br>"),e(r.DECODE,n)},exports}),define("qiao-im-sdk/messagePlugins/meta/face",["require","../../base/main","../../lang"],function(require){function e(e){for(var t,n=0;t=s[n];n++)if(t.name===e.toLowerCase())return{name:e,img:o+t.md5};return null}var t=require("../../base/main"),n=require("../../lang"),i=t.format,r=t.indexOfArray,a=["微笑","大笑","偷笑","憨笑","得意","可爱","害羞","乖","淘气","调皮","流泪","大哭","撇嘴","闭嘴","嘘","鄙视","傲慢","白眼","思考","困","睡","汗","尴尬","惊讶","惊恐","疑问","晕","敲打","难过","委屈","色","抓狂","愤怒","吐","衰","再见","左拥抱","右拥抱","闪人","刀","吻","爱情","心碎","鲜花","枯萎","胜利","OK","大拇指","弱","握手","蛋糕","咖啡","吃饭","太阳","月亮","星星","便便","猪头","钱","Hi"],o="//hqiao.baidu.com/f/pool/img/webim/defaultface/png/",s=[{name:"微笑",md5:"face_01.png"},{name:"大笑",md5:"face_02.png"},{name:"偷笑",md5:"face_03.png"},{name:"憨笑",md5:"face_04.png"},{name:"得意",md5:"face_05.png"},{name:"可爱",md5:"face_06.png"},{name:"害羞",md5:"face_07.png"},{name:"乖",md5:"face_08.png"},{name:"淘气",md5:"face_09.png"},{name:"调皮",md5:"face_10.png"},{name:"流泪",md5:"face_11.png"},{name:"大哭",md5:"face_12.png"},{name:"撇嘴",md5:"face_13.png"},{name:"闭嘴",md5:"face_14.png"},{name:"嘘",md5:"face_15.png"},{name:"鄙视",md5:"face_16.png"},{name:"傲慢",md5:"face_17.png"},{name:"白眼",md5:"face_18.png"},{name:"思考",md5:"face_19.png"},{name:"困",md5:"face_20.png"},{name:"睡",md5:"face_21.png"},{name:"汗",md5:"face_22.png"},{name:"尴尬",md5:"face_23.png"},{name:"惊讶",md5:"face_24.png"},{name:"惊恐",md5:"face_25.png"},{name:"疑问",md5:"face_26.png"},{name:"晕",md5:"face_27.png"},{name:"敲打",md5:"face_28.png"},{name:"难过",md5:"face_29.png"},{name:"委屈",md5:"face_30.png"},{name:"色",md5:"face_31.png"},{name:"抓狂",md5:"face_32.png"},{name:"愤怒",md5:"face_33.png"},{name:"吐",md5:"face_34.png"},{name:"衰",md5:"face_35.png"},{name:"再见",md5:"face_36.png"},{name:"左拥抱",md5:"face_37.png"},{name:"右拥抱",md5:"face_38.png"},{name:"闪人",md5:"face_39.png"},{name:"刀",md5:"face_40.png"},{name:"吻",md5:"face_41.png"},{name:"爱情",md5:"face_42.png"},{name:"心碎",md5:"face_43.png"},{name:"鲜花",md5:"face_44.png"},{name:"枯萎",md5:"face_45.png"},{name:"胜利",md5:"face_46.png"},{name:"ok",md5:"face_47.png"},{name:"大拇指",md5:"face_48.png"},{name:"弱",md5:"face_49.png"},{name:"握手",md5:"face_50.png"},{name:"蛋糕",md5:"face_51.png"},{name:"咖啡",md5:"face_52.png"},{name:"吃饭",md5:"face_53.png"},{name:"太阳",md5:"face_54.png"},{name:"月亮",md5:"face_56.png"},{name:"星星",md5:"face_55.png"},{name:"便便",md5:"face_57.png"},{name:"猪头",md5:"face_58.png"},{name:"钱",md5:"face_59.png"},{name:"hi",md5:"face_60.png"}],u={SEND:'<face n="${face}"/>',GET:'<img src="${img}" alt="${name}"/>'},c=/\[([^[\]]+)\]/g,exports={};return exports.encode=function(e,t,n){return e=e.replace(c,function(e,o){if(r(a,o)>=0)return n&&n.push(i(u.SEND,{face:o})),t;else return e})},exports.decode=function(t){var r;if(r=e(t.n))return i(u.GET,r);else return n.TEXT.FACE_UNSUPPORT},exports}),define("qiao-im-sdk/messagePlugins/text",["require","./meta/face","./meta/url","./meta/font","./meta/img","./meta/email","./meta/tel","./meta/qq","./meta/phone"],function(require){function e(e){var t=e.replace(/[\n\r]/g,"");return t=t.replace(/<(p|div)[^>]*>(<br\/?>|&nbsp;)<\/\1>/gi,"\n").replace(/<br\/?>/gi,"\n").replace(/<[^>\/]+>/g,"").replace(/(\n)?<\/([^>]+)>/g,function(e,t,n){return h[n.toLowerCase()]?"\n":t?t:""}).replace(/<[^>]+>/g,"").replace(/(\n)+/g,"<br />"),t.replace(g,"").replace(/\u00a0/g," ").replace(/&nbsp;/g," ")}function t(e,t){for(var n,r=t.length,a="",o=e,s=0;r>s;s++)n=t[s],e=n.encode(e,n.replaceStr,n.res),o=n.encode(o,""),a+=n.replaceStr+"|";e=i.encodeHTML(e),a=a.substring(0,a.length-1);var u,c=new RegExp(a,"g"),d=[],l=o.split("");e=e.replace(c,function(e){for(s=0;r>s;s++)if(n=t[s],u=n.replaceStr,e===u&&n.res[n.index])d.push(n.res[n.index++])}),r=l.length;var f=[];for(s=0;r>s;s++){if(n=l[s])f.push(i.format(m,{text:i.encodeHTML(n)}));if(n=d[s])f.push(d[s])}return e=f.join("")}function n(e,t){var n={encode:e,replaceStr:t,res:[],index:0};return n}var i,r=require("./meta/face"),a=require("./meta/url"),o=require("./meta/font"),s=require("./meta/img"),u=require("./meta/email"),c=require("./meta/tel"),d=require("./meta/qq"),l=require("./meta/phone"),f="text",m='<text c="${text}"/>',p='<span class="voice-tip">语音转译：</span><span>${voice}</span>',g=new RegExp("​","g"),h={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1},exports={};return exports.decoder={text:function(e){var t=i.encodeHTML(e.c);return{type:"text",text:t.replace(/\r\n/gi,"<br/>").replace(/&amp;#xD;&amp;#xA;/gi,"<br/>").replace(/%2B/gi,"+")}},card:function(e){var t=i.encodeHTML(e.c);return{type:"text",text:t.replace(/\r\n/gi,"<br/>").replace(/&amp;#xD;&amp;#xA;/gi,"<br/>").replace(/%2B/gi,"+")}},url:function(e){return{type:"url",text:a.decode(e)}},font:function(e){return{type:"font",text:o.decode(e)}},face:function(e){return{type:"face",text:r.decode(e)}},img:function(e){return{type:"text",text:"[图片]"}},html:function(t){return{type:"html",text:e(t.c)}},voice:function(e){var t=i.encodeHTML(e.c);return{type:"text",text:i.format(p,{voice:t.replace(/\r\n/gi,"<br/>").replace(/&amp;#xD;&amp;#xA;/gi,"<br/>").replace(/%2B/gi,"+")})}}},exports.encoder={text:function(e){var i=e.text,f=[];return f.push(n(r.encode,"\r")),f.push(n(s.encode,"")),f.push(n(a.encode,"")),f.push(n(l.encode,"")),f.push(n(d.encode,"")),f.push(n(c.encode,"\x00")),f.push(n(u.encode,"")),i=t(i,f),i=o.encode(e)+i}},exports.type=f,function(e){return i=e.lib,exports}}),define("qiao-im-sdk/plugins/errorLog",["require"],function(require){function e(){n.on("errorinfo",function(e){t.extendOwn(r,a.get()),t.img(i,{data:t.extend(e,r)})})}var t={},n={},exports={},i="//scqiao.baidu.com/front/error.gif",r={siteid:"",bid:"",sessionid:"",subid:"",appid:"",peerid:"",type:""},a={};return exports.init=function(i){t=i.lib,n=i.emitter,a=i.data,e()},exports}),define("qiao-im-sdk/plugins/file",["require","../util/bcs"],function(require){function e(e){v[e.fid]=e}function t(e,t){for(var n in v)if(n===e)if(!t)return v[n];else return v[n][t]}function n(){var e=Array.prototype.slice.call(arguments),t=w[e[0]];if(t)t.apply(null,e.slice(1))}function i(e){var t="00000000000000000000000000000000",n=e.name,i=e.size;g[e.fid]=new c;var a=d.extend({filepath:n,filesize:i||1,fid:e.fid},{filename:n.replace(/(.+)\.\w+$/,"$1"),filetype:"."+n.replace(/.+\.(\w+)$/,"$1"),filemd5:t,service:"cached",source:"bcs",role:"bridge_visitor",progress_notify:1,uri:"file/temp/"+t+"/"+i},y.sendFile);return d.ajax(b.URL_SENDFILE,{method:"post",data:d.extendOwn(a,l.get(),{username:l.get("userName")}),type:l.get("crossDomain")?"jsonp":"",onsuccess:r}),g[e.fid].promise()}function r(e){if("ok"===e.result)e.content.sign=l.get("session"),w.sendfileack(e.content)}function a(e){e&&(e.username=l.get("userName")),d.extendOwn(y.cancelFile,l.get(),e),d.ajax(b.URL_CANCELFILE,{method:"post",data:y.cancelFile,type:l.get("crossDomain")?"jsonp":""})}function o(e,t){if(p.file.sevReadyForDownload)if("agree"===t)w.sendfilestatus(p.file.sevData);var n={type:t,fid:e,username:l.get("userName")};d.ajax(b.URL_SENDFILEACK,{method:"post",data:d.extendOwn(y.sendFileAck,l.get(),n),type:l.get("crossDomain")?"jsonp":""})}function s(e){var t={fid:e.fid,size:e.size||1,ready_for_download:e.finished?1:0,token:e.token,bcsname:e.fid,username:l.get("userName")};d.ajax(b.URL_SENDFILE_STATUS,{method:"post",data:d.extendOwn(y.sendFileStatus,l.get(),t),type:l.get("crossDomain")?"jsonp":""})}function u(){f.on("pick",n),f.on("file:visitorsend",function(e,t){i({fid:e.fid,name:e.name,size:e.size}).then(function(e){return h[e]=new c,t&&t(l.STATUS.ACCEPT,{fid:e}),h[e].promise()},function(e){t&&t(l.STATUS.REJECT,{fid:e})}).then(function(e){t&&t(l.STATUS.STARTSEND,e)},function(e){t&&t(l.STATUS.FAIL,e)})}),f.on("file:visitorcancel",a),f.on("file:visitoraccept",function(e){o(e.fid,"agree")}),f.on("file:visitorreject",function(e){o(e.fid,"reject")}),f.on("file:visitorprogress",s),f.on("file:upload",function(e,t){m.getUploadPath({fid:e.fid,type:e.type||"PUT",siteid:l.get("siteid"),ucid:l.get("ucid")},function(e){t&&t(l.STATUS.STARTSEND,e)},function(e){t&&t(l.STATUS.FAIL,{info:"cannotupload"})})}),f.on("file:download",function(e,t){var n=e.fid,i=decodeURIComponent(e.token)||(new Date).getTime().toString(36);m.download({token:i,fid:n,siteid:l.get("siteid"),ucid:l.get("ucid")},function(e){t&&t(l.STATUS.SUCCESS,{url:e})},l.get("crossDomain")?"jsonp":"")})}var c,d={},l={},f={},m=require("../util/bcs"),p={file:{sevReadyForDownload:0}},g={},h={},v={},b={URL_SENDFILE:"/sendfile",URL_SENDFILEACK:"/sendfileack",URL_CANCELFILE:"/sendfilecancel",URL_SENDFILE_STATUS:"/sendfilestatus"},y={sendFile:{imuss:"",peerid:"",siteid:"",ucid:"",session:"",tag:"",username:""},cancelFile:{imuss:"",peerid:"",siteid:"",ucid:"",session:"",tag:"",username:"",fid:""},sendFileStatus:{imuss:"",peerid:"",siteid:"",ucid:"",session:"",tag:"",username:"",fid:"",size:"",uri:"",ready_for_download:0,source:"bcs",token:"",bcsname:""},sendFileAck:{imuss:"",peerid:"",siteid:"",ucid:"",session:"",tag:"",username:"",type:"",service:"cached",role:"bridge_visitor",progress_notify:0,fid:""}},w={};w.sendfileack=function(e){if(e){var t=e.type;if("agree"===t)m.getUploadPath({fid:e.fid,type:"POST",siteid:l.get("siteid"),ucid:l.get("ucid")},function(t){h[e.fid]&&h[e.fid].fulfill(t)},function(t){h[e.fid]&&h[e.fid].reject(t)}),g[e.fid]&&g[e.fid].fulfill(e.fid);if("reject"===t)g[e.fid]&&g[e.fid].reject(e.fid)}},w.sendfilecancel=function(e){f.emit("file:subcancel",e)},w.sendfile=function(t){if(t.ready_for_download){p.file.sevReadyForDownload=t.ready_for_download,p.file.sevData=t;var n=t.filename;t.filename=n.substring(0,n.lastIndexOf(".")),t.filesize=parseInt(t.filesize,10)}var i={fid:t.fid,name:t.filename,type:t.filetype,size:t.filesize,md5:t.filemd5,uri:t.uri};e(i),f.emit("file:subsend",i)},w.sendfilestatus=function(e){var n=decodeURIComponent(e.token)||(new Date).getTime().toString(36),i=e.bcsname||e.fid;if(e.ready_for_download)return void m.download({token:n,fid:i,siteid:l.get("siteid"),ucid:l.get("ucid")},function(r){f.emit("file:subprogress",{url:r,name:t(i,"name"),token:n,fid:i,type:e.type||"file",finish:1})},l.get("crossDomain")?"jsonp":"");else return void f.emit("file:subprogress",{fid:i,size:e.size,name:t(i,"name"),type:e.type||"file",finish:0})},w.peer_sendfileack=function(e){if(e){var t=l.get("peerid")+"";if(e.peerid===t)w.sendfileack(e);else f.emit("file:subpeerack",{fid:e.fid,type:e.type});if(!e.peerid&&"agree"===e.type)w.sendfilestatus(p.file.sevData)}};var exports={};return exports.init=function(e){d=e.lib,l=e.data,f=e.emitter,c=d.Resolver,u()},exports}),define("qiao-im-sdk/plugins/site",["require"],function(require){function e(e){n.ajax(a.GET_SITE_INFO,{data:n.extendOwn(o,i.get()),type:i.get("crossDomain")?"jsonp":"",onsuccess:function(t){var n={},r=t.data||{};if("1"===r.cust_dis&&r.cust)n.company=r.cust;if("1"===r.tel_dis&&r.tel)n.tel=r.tel;n.prologue=r.prologue,e&&e(i.STATUS.SUCCESS,n)},onfail:function(t){e&&e(i.STATUS.FAIL,t)}})}function t(){r.on("site:get",e)}var n={},i={},r={},a={GET_SITE_INFO:"/im/?module=im&controller=mobile&action=corporation"},o={ucid:"",siteid:""},exports={};return exports.init=function(e){n=e.lib,i=e.data,r=e.emitter,t()},exports}),define("qiao-im-sdk/plugins/sendLog",["require"],function(require){function e(e,t){if(d[e]||0===d[e])d[e]+="|"+t;else d[e]=t}function t(){d={status:"",st:"",msgid:""}}function n(){a.on("communicate",i),a.on("send",r)}function i(t,n){if("start"!==t)e("st",n.st),e("msgid",n.messageid)}function r(e,n){d.status=e,o.extendOwn(c,u.get(),d),o.img(s,{data:c}),t()}var a,o={},exports={},s="//scqiao.baidu.com/front/send.gif",u={},c={siteid:"",ucid:"",bid:"",visitType:1,appid:"",status:"",st:"",msgid:""},d={status:"",st:"",msgid:""};return exports.init=function(e){o=e.lib,a=e.emitter,u=e.data,n()},exports}),define("qiao-im-sdk/plugins/connectLog",["require"],function(require){function e(e,t){if(t)if(l[e])l[e]+="|"+t;else l[e]=t}function t(){l={startTime:"",es:"",ee:"",ei:"",ws:"",we:"",wi:"",bs:"",be:"",bi:""},s.extendOwn(d,l)}function n(t){o.on(t,function(n,i){switch(n){case"start":e(m[t],(new Date).getTime());break;case"success":if(e(p[t],(new Date).getTime()),i.tag)e(g[t],"prevent");break;case"fail":a(t,i),e(p[t],(new Date).getTime())}})}function i(){var e,t;for(t=0;e=f.eventList[t];t++)n(e);o.on("connect",r),o.on("init",function(e,t){if(e===c.STATUS.FAIL)r(t)})}function r(e,n){switch(e){case c.STATUS.SUCCESS:l.status="success";break;case c.STATUS.FAIL:l.status="fail"}s.extendOwn(d,c.get(),l),s.img(u,{data:d}),t()}function a(t,n){var i="";if(n){if(i=n.status||n.result,!i)i=n.tag?"prevent":"fail";if("undefined"!=typeof n.responseText)i+="|xhrstatus="+n.status,i+="|responseText="+n.responseText}else i="fail";e(g[t],i)}var o,s={},exports={},u="//scqiao.baidu.com/front/transfer.gif",c={},d={siteid:"",ucid:"",bid:"",visitType:1,appid:"",status:"fail",startTime:"",es:"",ee:"",ei:"",ws:"",we:"",wi:"",bs:"",be:"",bi:""},l={},f={eventList:["enter","welcome","bridgeinit"]},m={enter:"es",welcome:"ws",bridgeinit:"bs"},p={enter:"ee",welcome:"we",bridgeinit:"be"},g={enter:"ei",welcome:"wi",bridgeinit:"bi"};return exports.init=function(e){s=e.lib,o=e.emitter,c=e.data,i(),t(),l.startTime=(new Date).getTime()},exports}),define("qiao-im-sdk/core/rcv/leave",["require","../../base/main","../../model"],function(require){function e(){if(i.get("bid"))exports.data=t.extendOwn(a,i.get()),n(r.URL_LEAVE,{data:exports.data,type:i.get("crossDomain")?"jsonp":""})}var t=require("../../base/main"),n=t.img,i=require("../../model"),r={URL_LEAVE:"/Leave.php"},a={bid:"",peerid:"",siteid:"",ucid:"",tag:""},exports={};return exports.start=function(){e()},exports}),define("qiao-im-sdk/core/rcv/refresh",["require","../../base/main","../../model"],function(require){function e(){i(a.URL_REFRESH,{data:t.extendOwn(u,r.get()),type:r.get("crossDomain")?"jsonp":"",onsuccess:exports.handleRefresh})}var t=require("../../base/main"),n=t.Emitter,i=t.ajax,r=require("../../model"),a={URL_REFRESH:"/Refresh.php"},o=15e3,s=null,u={bid:"",peerid:"",siteid:"",ucid:"",tag:""},exports={};return n.mixin(exports),exports.handleRefresh=function(e){if(0===e.saved)return void clearInterval(s);else return void exports.emit("refresh","success",e)},n.mixin(exports),exports.start=function(){s=setInterval(e,o)},exports.stop=function(){clearInterval(s)},exports}),define("qiao-im-sdk/core/rcv/enter",["require","../../base/main","../../model"],function(require){function e(){exports.data=t.extendOwn(s,r.get(),exports.getVisitorCondition(),{vis_type:r.get("visitType")}),n(a.URL_ENTER,{data:exports.data,type:r.get("crossDomain")?"jsonp":"",onsuccess:exports.handleEnter,onfail:exports.handleEnterfail}),exports.emit("enter","start")}var t=require("../../base/main"),n=t.ajax,i=t.Emitter,r=require("../../model"),a={URL_ENTER:"/Enter.php",TYPE_VIS_PC:1,TYPE_VIS_MOBILE:2,TYPE_VIS_MINI:3,MAX_ENTER_COUNT:3,AGIN_ENTER_CODE:500,ENTER_FAIL_OP:2,ANTI_FORBID:1,ANTI_JSCODE:2,ANTI_SECOND:3,ANTI_AUTHCODE:4},o=0,s={bid:"",peerid:"",siteid:"",ucid:"",appid:"",tag:"",fromSite:"",expand:"",referrer:document.referrer,ex:"",iswebim:1,word:"",coding:"",bdclickid:"",title:"",inurl:"",vis_type:1,lang:"",rsl:"",tz:"",cbit:""},exports={};return i.mixin(exports),exports.getTimeZone=function(){var e=(new Date).getTimezoneOffset(),t=parseInt(e/60,10),n=e%60,i="-";if(0>t||0>n)if(i="+",t=-t,0>n)n=-n;return t+="",n+="","UTC"+i+t+":"+n},exports.getVisitorCondition=function(){var e=window.navigator,t=window.screen,n={};return n.lang=e.language||e.systemLanguage,n.rsl=t.width+"*"+t.height,n.tz=exports.getTimeZone(),n.cbit=t.colorDepth,n},exports.handleEnter=function(e){if(e.status||!e.tag&&1!==e.saved)return void exports.handleEnterfail(e);if(e.tag&&(+e.tag.op===a.ANTI_FORBID||+e.tag.op===a.ANTI_JSCODE))return void exports.handleEnterfail(e);else return void exports.emit("enter","success",e)},exports.handleEnterfail=function(t){if(exports.emit("enter","fail",t),500===t.status){if(o<a.MAX_ENTER_COUNT)return e(),void o++}else if(t.tag&&+t.tag.op===a.ANTI_JSCODE)return;exports.emit("connect","fail",t,"enter")},exports.start=function(t){e(),o=0},exports}),define("qiao-im-sdk/core/rcv/main",["require","../../base/main","./enter","./refresh","./leave","../../model","../../emitter","../prevent"],function(require){function e(e){c.set(e);for(var t in m)if(m.hasOwnProperty(t))a.set(t,e[t])}function t(){d.on("restart",function(){c.set("restart",!0),n()}),d.on("start",function(){n()}),d.on("config",function(e){if(!c.get("bid"))c.set(a.get());if(!f)n(),f=!0;p.handles=e||p.handles}),d.on("connect",function(e){if(e===c.STATUS.FAIL)f=!1}),d.on("endsession",function(){f=!1}),o.on("enter",function(t,n){if("success"===t){var i={bid:n.bid,peerid:n.peerid,imuss:n.bid,group:n.group,visSessionid:n.vis_sess_id};if(e(i),s.start(),!n.tag)d.emit("init",c.STATUS.SUCCESS,n)}if(n&&n.tag)l.setStatus(n),l.applyStatus(n,function(e,t){if(e===c.STATUS.FAIL)return void d.emit("forbid",t,"init");if(e===c.STATUS.ANTIATTACK){var n=p.handles&&p.handles.onAntiAttack;n&&n(t)}});d.emit("enter",t,n),f=!1}),o.on("connect",function(e,t){if("fail"===e)f=!1,t=i.extend({},t,{pack:"enter"}),d.emit("init",c.STATUS.FAIL,t)}),s.on("refresh",function(e,t){if("success"===e)if(t.tag)l.setStatus(t)})}function n(){s.stop(),o.start()}var i=require("../../base/main"),r=i.Storage,a=new r("rcv"),o=require("./enter"),s=require("./refresh"),u=require("./leave"),c=require("../../model"),d=require("../../emitter"),l=require("../prevent"),f=!1,m={bid:"",imuss:""},p={};t();var exports={};return exports.leave=function(){u.start(c.get())},exports.restart=function(){c.set("restart",!0),n()},exports}),define("qiao-im-sdk/util/group",["require","../lang"],function(require){function e(e,t,n){for(var i,r,a=0;i=t[a];a++)for(var o=0;r=i.user[o];o++)if(+r.subid===+e)return n?r.subname:i.groupname;return""}var t=require("../lang"),n={COMPANY:0,GROUP:1,SUBNAME:2,CUSTOM:3},exports={};return exports.getShowSubNameById=function(i,r,a,o){var s;switch(a.csNameType){case n.COMPANY:s=a.compName;break;case n.CUSTOM:s=a.customName;break;case n.GROUP:s=e(i,r);break;default:s=e(i,r,!0)}return s||o||t.TEXT.CSNAME_DEFAULT},exports}),define("qiao-im-sdk/core/im/aiPrologue",["require","../../base/main","../../model"],function(require){var e=require("../../base/main"),t=e.ajax,n=e.Emitter,i=require("../../model"),r={URL:"//hqiao.baidu.com/v3/?module=default&controller=intelligentPrologue&action=aiPrologue"},a={siteid:"",ucid:"",subid:"",imuss:"",sessionid:""},o={},exports={};return n.mixin(exports),exports.getAiPrologue=function(n){o.ucid=n.ucid?n.ucid:i.get("ucid"),o.siteid=n.siteid?n.siteid:i.get("siteid"),o.subid=n.subid?n.subid:i.get("subid"),o.imuss=n.bid?n.bid:i.get("bid"),o.sessionid=n.sessionid?n.sessionid:i.get("sessionid"),t(r.URL,{data:e.extendOwn(a,i.get(),o),type:"jsonp",hasDomain:!0,onsuccess:function(t){if(0===t.status)i.aiPrologueContent=t.data;else if(1===t.status)i.set("isAiPrologue",0);else exports.emit("errorinfo",e.extend(o,{type:"aiPrologue"}))},onfail:function(t){exports.emit("errorinfo",e.extend(o,{type:"aiPrologue"}))}})},exports}),define("qiao-im-sdk/lang",[],function(){var exports={};return exports.TEXT={FILE_UNSUPPORT:"[文件]",FACE_UNSUPPORT:"[扩展头像]",IMG_UNSUPPORT:"[图片]",CFACE_UNSUPPORT:"[自定义头像]",CSNAME_DEFAULT:"在线客服",CSNAME_GROUP:"默认分组",CONNECT_FORBID:"网络繁忙,请您重试",TEXT_QUEUE:"欢迎光临！您已经进入服务队列，请您稍候，马上为您转接您的在线咨询顾问。"},exports}),define("qiao-im-sdk/core/prevent",["require","../emitter","../model","../base/main","../lang"],function(require){function e(e){var t="return "+e,n=new Function(t),i=n();if("function"==typeof i)o.jscode=i();else o.jscode=i}var t=require("../emitter"),n=require("../model"),i=require("../base/main"),r=require("../lang"),a={FORBID:1,JSCODE:2,SECOND:3,AUTHCODE:4},o={jscode:"",checkcode:""},s="",u={check:"/atverifycode",get:"/atgetcode"},c={verify:{bid:"",peerid:"",siteid:"",ucid:"",tag:"",val:"",codeId:""},getAuthCode:{bid:"",peerid:"",siteid:"",ucid:"",tag:""}},exports={};return exports.applyStatus=function(e,i){var o={};if(e.content&&e.content.tag)o=e.content.tag;else if(e.tag)o=e.tag;switch(o.op){case a.AUTHCODE:exports.getAuthCode(function(e,t){if(e===n.STATUS.SUCCESS)i&&i(n.STATUS.ANTIATTACK,{type:"auth",url:t.url})});break;case a.SECOND:i&&i(n.STATUS.ANTIATTACK,{type:"second"});break;case a.FORBID:i&&i(n.STATUS.FAIL,{statusInfo:r.TEXT.CONNECT_FORBID,type:"forbid"});break;case a.JSCODE:t.emit("start")}},exports.setStatus=function(t){var i;if(t.content&&t.content.tag)i=t.content.tag;else if(t.tag)i=t.tag;var r=i.op;switch(r){case a.JSCODE:e(i.val),n.set("tag",{jscode:o.jscode});break;case a.AUTHCODE:if(i.val)u.check="/"+i.val.checkurl,u.get="/"+i.val.geturl}},exports.verify=function(e,t){if("second"===e.type)t&&t(n.STATUS.SUCCESS,{type:"second"});else if("auth"===e.type)o.checkcode=e.code,n.set("tag",o),i.ajax(u.check,{data:i.extendOwn(c.verify,n.get(),{val:e.code,codeId:s}),type:n.get("crossDomain")?"jsonp":"",onsuccess:function(e){if(e&&e.status)return void(t&&t(n.STATUS.FAIL,{type:"auth"}));else return void(t&&t(n.STATUS.SUCCESS,{type:"auth"}))},onfail:function(e){t&&t(n.STATUS.FAIL,{type:"auth"})}})},exports.getAuthCode=function(e){i.ajax(u.get,{data:i.extendOwn(c.getAuthCode,n.get()),type:n.get("crossDomain")?"jsonp":"",onsuccess:function(t){if(t&&t.status)return void(e&&e(n.STATUS.FAIL,t));else return s=t.body.codeid,void(e&&e(n.STATUS.SUCCESS,{url:t.body.url}))},onfail:function(t){e&&e(n.STATUS.FAIL,t)}})},exports}),define("qiao-im-sdk/core/im/end",["require","../../base/main","../../model"],function(require){function e(){n(a,{data:exports.data,type:i.get("crossDomain")?"jsonp":""})}var t=require("../../base/main"),n=t.img,i=require("../../model"),r={imuss:"",peerid:"",siteid:"",ucid:"",session:"",tag:""},a="/logout",exports={data:{},start:function(){exports.data=t.extendOwn(r,i.get()),e()}};return exports}),define("qiao-im-sdk/core/im/send",["require","../../base/main","../../message","../../model"],function(require){function e(e){if(e.count<f.STOP_SEND_COUNT)i(e),clearTimeout(g),g=setTimeout(function(){exports.startResend()},f.TIME_RESEND);else a(e,"fail",{info:"重试多次失败"});e.count++}function t(e){var t=[].slice.call(arguments,1);return function(){var n=[[].slice.call(arguments)[0]].concat(t);if(!n||!n[0])return void(e&&e("fail"));var i=n[0],r=i.result;if(r&&"ok"===r.toLowerCase())n=["success"].concat(n),e&&e.apply(null,n);else{if(n=["fail"].concat(n),!r)i.result="error";e&&e.apply(null,n)}}}function n(e,n,i){var r=s.extendOwn(m.msgextend,l.get(),{body:e.body,time:e.time||+new Date,msgtype:e.msgtype,count:e.count,to:l.get("userName"),type:n});u(f.URL_EXTEND,{method:"post",type:l.get("crossDomain")?"jsonp":"",data:r,onsuccess:t(exports.handleCallback,i),onfail:t(exports.handleCallback,i)})}function i(e){exports.data=s.extendOwn(m.send,l.get(),{body:e.body,time:e.time||+new Date,messageid:e.messageid,msgtype:e.msgtype,count:e.count,to:l.get("userName")}),u(f.URL_SAY,{method:"post",type:l.get("crossDomain")?"jsonp":"",data:s.extend(exports.data,{st:(new Date).getTime()}),onsuccess:t(exports.handleSend,e),onfail:t(exports.handleSend,e)}),exports.emit("communicate","start",e)}function r(e,t){u(f.URL_ACK,{method:"post",type:l.get("crossDomain")?"jsonp":"",data:s.extendOwn(m.ackMsg,l.get(),{to:l.get("userName"),to_sub:t||0,ackid:e})})}function a(e,t,n){var i=e.time,r=s.indexOfArray(h,i,"time");if(r>=0)s.removeAtArray(h,r);if(exports.startResend(),"fail"===t)e.onfail&&e.onfail(n),exports.emit("send","fail",i);else e.onsuccess&&e.onsuccess(n),exports.emit("send","success",i)}function o(){s.event.on(window,"online",function(){v=!0,exports.startResend()}),s.event.on(window,"offline",function(){v=!1,clearTimeout(g)})}var s=require("../../base/main"),u=s.ajax,c=s.Emitter,d=require("../../message"),l=require("../../model"),f={TIME_RESEND:3e3,URL_SAY:"/communicate",URL_PREVIEW:"/scenemsg",URL_ACK:"/msgack",URL_EXTEND:"/msgextend",STOP_SEND_COUNT:3},m={send:{imuss:"",peerid:"",siteid:"",ucid:"",session:"",tag:"",to:"",tid:"",body:"",time:"",msgtype:0,messageid:"",auto_subid:"",count:0,st:""},scenemsg:{imuss:"",peerid:"",siteid:"",ucid:"",seq:0,session:"",tag:"",to:"",body:""},ackMsg:{imuss:"",peerid:"",siteid:"",ucid:"",seq:0,session:"",tag:"",from:"",to:"",to_sub:"",ackid:""},msgextend:{imuss:"",peerid:"",siteid:"",ucid:"",session:"",tag:"",to:"",tid:"",body:"",time:"",type:""}},p={canSendPreview:!1},exports={};c.mixin(exports);var g,h=[],v=!0;exports.handleSend=function(e,t,n){if("success"===e)exports.emit("communicate","success",n),a(n,"success",t);else exports.emit("communicate","fail",n,t)},exports.handleCallback=function(e,t,n){if("success"===e)n&&n(l.STATUS.SUCCESS,t);else n&&n(l.STATUS.FAIL,t)},exports.sendPreview=function(e,n){if(e)if(p.canSendPreview)d.comParser.encode({type:"text",text:e},function(e){u(f.URL_PREVIEW,{method:"post",type:l.get("crossDomain")?"jsonp":"",data:s.extendOwn(m.scenemsg,l.get(),{body:e,to:l.get("userName")}),onsuccess:t(exports.handleCallback,n),onfail:t(exports.handleCallback,n)})})};var b=0;return exports.say=function(e,t,r,a){var o={body:e,time:t.time||+new Date,messageid:b++,msgtype:t.msgtype||0,count:0};if(l.get("inittype"))o.auto_subid=l.get("subid");var u=s.clone(o);if("msg"!==r&&e)return void n(u,r,a);if(h.push(u),v)clearTimeout(g),g=setTimeout(function(){exports.startResend()},f.TIME_RESEND),i(u)},exports.startResend=function(){if(h.length>0)e(h[0])},exports.switchPreviewStatus=function(e){p.canSendPreview=e},exports.ackMsg=r,exports.config=p,exports.start=function(){o()},exports}),define("qiao-im-sdk/core/im/history",["require","../../base/main","../../message","../../model","../../util/filters/repeat"],function(require){function e(e,n){var r={messages:[]};r.hisTime=e.histime,r.hasFinished=e.finished;var s=e.content.fields;if(s&&i.isArray(s))for(var u,c=s.length,d=0;c>d;d++)if(u=s[d],!a.doFilter(u,o.get(),l))t(u,o.get(),l,r);n(r)}function t(e,t,n,i){a.comParser.decode(e.content,t,n,function(t){var n={},r=e.category||0;n.wordType=c[r],n.data=t,n.showName=e.from_alias,n.time=e.time,n.speakerType=""===n.showName?"visitor":"server",i.messages.push(n)})}function n(e,t,n){r(s.URL_HIS,{data:i.extendOwn(u,o.get(),e),type:o.get("crossDomain")?"jsonp":"",onsuccess:function(e){if(0===e.status){var i=e.data;if(!i||!i.content)return;t(i)}else n(e)},onfail:n})}var i=require("../../base/main"),r=i.ajax,a=require("../../message"),o=require("../../model"),s={URL_HIS:"/im/?module=im&controller=web&action=getWebMsg",DEFAULT_SIZE:10},u={siteid:"",ucid:"",tag:"",sessionid:"",visSessionid:"",imuss:"",s:"",e:"",size:s.DEFAULT_SIZE},c=["word","welcome","autoReply","autoReply"],d={},l=new a.Filter,f=require("../../util/filters/repeat");l.addFilter("time",f.time),l.addType("img","[图片]");var exports={};return exports.getUnread=function(e,t,i){d.imuss=o.get("imuss"),d.sessionid=o.get("sessionid"),d.visSessionid=o.get("visSessionid"),
d.s=e.s||0===e.s?e.s:"",d.e=e.e||0===e.e?e.e:"",d.size=e.size?e.size:o.get("hisMsgCount")||s.DEFAULT_SIZE;var r=[];n(d,function(e){for(var n,i,a=e.content.fields.reverse(),o=a.length,s={hisTime:e.histime,hasFinished:e.finished},u=0;o>u;u++)if(n=a[u],i=n.command,"message"===i||"peer_message"===i)r.push(n);t(r,l,s)},i)},exports.get=function(t,i){d.visSessionid=t.visSessionid?t.visSessionid:o.get("visSessionid"),d.sessionid=t.sessionid?t.sessionid:o.get("sessionid"),d.imuss=t.bid?t.bid:o.get("bid"),d.s=t.s||0===t.s?t.s:"",d.e=t.e||0===t.e?t.e:"",d.size=t.size?t.size:o.get("hisMsgCount")||s.DEFAULT_SIZE,n(d,function(t){e(t,function(e){i&&i(o.STATUS.SUCCESS,e)})},function(e){i&&i(o.STATUS.FAIL,e)})},exports.filter=l,exports}),define("qiao-im-sdk/util/filters/repeat",["require"],function(require){var e={},t={},n={WELCOME:1},exports={};return exports.welcome=function(t){var i=t.showOnceType||t.category;if(i===n.WELCOME){if(e[i])return!0;e[i]=!0}return!1},exports.time=function(e){var n=e.time;if(!n)return!1;if(t[n])return!0;else return t[n]=!0,!1},exports.self=function(e,t){return!("peer_message"!==e.command||+e.peerid!==+t.peerid)},exports}),define("qiao-im-sdk/core/im/receive",["require","../../base/main","../../message","../../model","../../util/net","../../util/filters/repeat"],function(require){function e(e){exports.emit("network",s.extend(e,{netType:"receive",token:v,ack:o}))}function t(e){var t=[].slice.call(arguments,1);return function(){var n=[[].slice.call(arguments)[0]].concat(t);if(!n||!n[0])return void e("fail");var i=n[0],r=i.result;if(r&&"ok"===r.toLowerCase())n=["success"].concat(n),e&&e.apply(null,n);else{n=["fail"].concat(n);try{if(!r)i.result="error"}catch(a){}e&&e.apply(null,n)}}}function n(){if(!h)v++,h=u(w.URL_PICK,{method:"post",type:l.get("crossDomain")?"jsonp":"",data:s.extendOwn(g,l.get(),{ack:o}),onsuccess:t(exports.handlePick,v),onfail:t(exports.handlePick,v)}),b=setTimeout(i,w.TIME_OUT_PICK),e({because:x.START})}function i(){r(),n(),e({because:x.TIMEOUT})}function r(){clearTimeout(b),m=!0;try{if(h&&h.abort)h.abort()}catch(e){}h=null}function a(){p=new d.Filter;var e=require("../../util/filters/repeat");p.addFilter("welcome",e.welcome),p.addFilter("self",e.self),p.addFilter("time",e.time),T=new f(_.UNLIMITED_TIMES)}var o,s=require("../../base/main"),u=s.ajax,c=s.Emitter,d=require("../../message"),l=require("../../model"),f=require("../../util/net").Mode,m=!1,p=null,g={imuss:"",peerid:"",siteid:"",ucid:"",session:"",tag:"",ack:""},h=null,v=0,b=null,y=!1,w={TIME_OUT_PICK:4e4,URL_PICK:"/pick",COOKIE_ACK:"QIAO_COOKIE_ACK"},exports={};c.mixin(exports);var T,_={ONLY_ONE:0,LIMIT_TIMES:1,UNLIMITED_TIMES:2},E=!1,x={START:"start",TIMEOUT:"timeout",FAIL:"fail",SUCCESS:"success",KICK:"kick",EMPTY:"empty",TOKEN:"token"};return exports.pickSuccess=function(e){var t=e.content;if(E=!1,t){var n=t.fields;if(n&&s.isArray(n)){t.ack&&(o=t.ack);for(var i,r,a=n.length,u=0;a>u;u++){if(i=n[u],r=i.command,"message"===r||"peer_message"===r)exports.emit("pick","message",i,p);else if("communicatetransfernotify"===r){var c=r.replace(/notify$/,"");exports.emit("pick",c,i)}else{var c=r.replace(/notify$/,"");if(exports.emit("pick",c,i.content),"kick"===c)E=!0}exports.emit("ack",i.time,i.from)}}exports.emit("pick","success",e)}},exports.pickFail=function(e){exports.emit("pick","fail",e)},exports.handlePick=function(t,i,r){if(!i)return h=null,clearTimeout(b),exports.pickFail(i),T.tryAgin(n),void e({because:x.EMPTY});if(r!==v)return void e({because:x.TOKEN,info:"token"+r});clearTimeout(b);var a=i.result;if("success"===t){if(exports.pickSuccess(i),h=null,!y)setTimeout(n,T.DELAY_TIME);if(E)exports.reset();T.reset(),e({because:x.SUCCESS})}else if("offline"===a||"kicked"===a){if(exports.emit("pick","stop"),h=null,!y)setTimeout(n,T.DELAY_TIME);exports.reset(),T.reset(),e({because:x.KICK,info:a})}else{if(exports.pickFail(i),h=null,!m)T.tryAgin(n);e({because:x.FAIL,info:a})}if("offline"===a||"kicked"===a)exports.emit("pick","restart")},exports.stop=function(){y=!0,r()},exports.reset=function(){y=!1},a(),exports.start=function(e){o=e,n()},exports.filter=p,exports}),define("qiao-im-sdk/util/net",["require","../base/main"],function(require){function e(e,t){t=t||{},this.FAIL_TIME_LIMIT=t.FAIL_TIME_LIMIT||10,this.DELAY_TIME=t.DELAY_TIME||0,this.FAIL_DELAY_TIME=t.FAIL_DELAY_TIME||2e3,this.mode=e,this.count=0}var t=require("../base/main"),exports={},n={ONLY_ONE:0,LIMIT_TIMES:1,UNLIMITED_TIMES:2},i=e.prototype;i.reset=function(){this.count=0},i.tryAgin=function(e){switch(this.count++,this.mode){case n.LIMIT_TIMES:if(this.count>=this.FAIL_TIME_LIMIT)return;else setTimeout(e,this.DELAY_TIME);break;case n.UNLIMITED_TIMES:if(this.count>=this.FAIL_TIME_LIMIT)setTimeout(e,this.FAIL_DELAY_TIME);else setTimeout(e,this.DELAY_TIME)}};var r=function(){var e=!1;if(e="complete"===document.readyState,document.documentElement.doScroll)try{document.documentElement.doScroll("left"),e=!0}catch(t){e=!1}return e};return exports.pageOnload=function(e){if(e=e||{},e.isPageOnload=!1,r())e.isPageOnload=!0;else t.event.on(window,"load",function(){e.isPageOnload=!0})},exports.Mode=e,exports}),define("qiao-im-sdk/core/im/connect",["require","../../base/main","../../model","../../util/net"],function(require){function e(){if(f.isPageOnload)clearTimeout(p),t();else p=setTimeout(function(){e()},m)}function t(){a(d.URL_WELCOME,{method:"post",type:s.get("crossDomain")?"jsonp":"",data:i.extendOwn(l.welcome,s.get(),exports.data),onsuccess:exports.welcomeSuccess,onfail:exports.welcomeFail}),exports.emit("welcome","start")}function n(){a(d.URL_BRIDGEINIT,{method:"post",type:s.get("crossDomain")?"jsonp":"",data:i.extendOwn(l.bridgeinit,s.get(),exports.data),onsuccess:exports.initSuccess,onfail:exports.initFail}),exports.emit("bridgeinit","start")}var i=require("../../base/main"),r=i.Emitter,a=i.ajax,o=i.isNumber,s=require("../../model"),u=require("../../util/net"),c=u.pageOnload,d={URL_WELCOME:"/welcome",URL_BRIDGEINIT:"/bridgeinit",TYPE_SUB:0,TYPE_GROUP:1,TYPE_SITE:3,TYPE_INVITE:4,TYPE_CLIENT_PC:1,TYPE_CLIENT_MOBILE:2,TYPE_CLIENT_MINI:3},l={welcome:{imuss:"",peerid:"",siteid:"",ucid:"",session:"",tag:"",appid:"",source:0,anonym:!0,clienttype:i.isMobile()?d.TYPE_CLIENT_MOBILE:d.TYPE_CLIENT_PC},bridgeinit:{imuss:"",peerid:"",siteid:"",ucid:"",session:"",tag:"",username:"1",type:d.TYPE_SITE,chattype:1,sub:"",bridgetid:"",fromsite:document.referrer,srcword:"",wordtype:0,wordid:0,region:"",insite:document.referrer,title:"",inittype:""}},f={},m=100,p=null,exports={data:{},welcomeSuccess:function(e){if("ok"!==e.result)return void exports.welcomeFail(e);if(e.content.tag)return void exports.welcomeFail(e);else return exports.emit("welcome","success",e),void n()},welcomeFail:function(e){exports.emit("welcome","fail",e)},initSuccess:function(e){if("ok"!==e.result&&"wait"!==e.result)return void exports.initFail(e);else return void exports.emit("bridgeinit","success",e)},initFail:function(e){exports.emit("bridgeinit","fail",e)},start:function(){exports.initData(),c(f),e()}};return r.mixin(exports),exports.initData=function(){var e={subid:s.get("distSubid"),groupid:s.get("distGroupid"),ptid:s.get("ptid"),referrer:s.get("referrer"),word:s.get("word"),from:s.get("from"),location:s.get("location"),userName:s.get("userName"),chatType:s.get("chatType")},t=l.bridgeinit,n=o(e.subid)?e.subid:t.sub,i=o(e.groupid)?e.groupid:t.bridgetid,r=t.type;if(o(n))r=d.TYPE_SUB;else if(o(i))r=d.TYPE_GROUP;else i=o(e.ptid)?e.ptid:t.bridgetid;if(e.chatType-0===d.TYPE_INVITE)r=d.TYPE_INVITE;exports.data={sub:n,bridgetid:i,type:r,fromsite:e.referrer||t.fromsite,srcword:e.word||t.srcword,region:e.from||t.region,insite:e.location||t.insite,username:e.userName||t.username}},exports}),define("qiao-im-sdk/core/im/main",["require","./connect","./receive","./history","./send","./end","../prevent","./aiPrologue","../../base/main","../../util/group","../../message","../../model","../../emitter","../../lang"],function(require){function e(e){T.set(e);for(var t in x)if(x.hasOwnProperty(t))E.set(t,e[t])}function t(){e({session:""}),N=!0,A=!1}function n(){l.stop(),t()}function i(){var e=Array.prototype.slice.call(arguments),t=k[e[0]];if(t)t.apply(null,e.slice(1));else{var n=[].concat(["pick"],e);_.emit.apply(_,n)}}function r(e,t,n){var i,r=e.content,a=e.from_sub,o=e.from_alias,s=e.time_server_ms||parseInt(e.systimestr/1e3,10)||e.time,u=e.command,c={};c.speakerType="server";var d=e.csWordType||e.category||0;if(c.wordType=C[d]||d,n&&n.hisTime)c.messageType="history",i=o,c.hisTime=n.hisTime,c.hasFinished=n.hasFinished,c.speakerType=""===i?"visitor":"server";else if("peer_message"===u)c.speakerType="visitor";else{var l=T.get("isAiPrologue");if(l&&"welcome"===c.wordType)if(T.aiPrologueContent)r[1].c=T.aiPrologueContent,r[1].type="html";else setTimeout(function(){T.aiPrologueContent&&(r[1].c=T.aiPrologueContent)},1e3);i=y.getShowSubNameById(a,T.get("group"),T.get())}if(!w.doFilter(e,T.get(),t))if(w.comParser.decode(r,T.get(),t,function(e){_.emit("message",e,i,s,c)}),_.emit("message:origin",r,i,s,c),"peer_message"===u)for(var f,m=0;f=r[m];m++)if("img"===f.type)_.emit("pick","sendfilestatus",{token:f.token,fid:f.bcsname,ready_for_download:1,type:"img"})}function a(e,t,n){for(var i,a=0;i=e[a];a++)r(i,t,n)}function o(e){var t=T.get("hisMsgCount"),n=T.get("restart");if(t&&!n)f.getUnread({s:"",e:"",size:t},function(t,n,i){a(t,n,i),l.start(e.pickseq||"")},function(){l.start(e.pickseq||"")});else l.start(e.pickseq||"")}function s(t){var n=t.subid||t.new_subid,i=t.tid||t.new_tid;if(void 0!==i&&i!==T.get("tid"))e({tid:i,groupid:i});if(void 0!==n&&n!==T.get("subid"))e({subid:n})}function u(){l.on("pick",i),l.on("ack",m.ackMsg),d.on("welcome",function(e,t){if(_.emit("welcome",e,t),"success"===e){if(t&&t.content&&t.content.session)T.set("session",t.content.session)}else if("fail"===e)if(t=v.extend({},t,{pack:"welcome"}),A=!1,N=!0,t&&t.content&&t.content.tag)g.setStatus(t),g.applyStatus(t,function(e,t){if(e===T.STATUS.FAIL)return void _.emit("forbid",t,"connect");if(e===T.STATUS.ANTIATTACK){var n=I.handles&&I.handles.onAntiAttack;n&&n(t)}});else _.emit("connect",T.STATUS.FAIL,t)}),d.on("bridgeinit",function(e,t){if(_.emit("bridgeinit",e,t),"success"===e){var n=t.content;s(n),n.sessionid&&T.set("sessionid",n.sessionid);var i=T.get("isAiPrologue");if(void 0!==n.subid&&i)h.getAiPrologue({});if(m.start(T.get()),A=!0,n.waitStatus=!1,t.customName=y.getShowSubNameById(t.content.subid,T.get("group"),T.get()),_.emit("connect",T.STATUS.SUCCESS,t),+n.sessionid&&_.emit("taskbegin",n),t.result&&"wait"===t.result.toLowerCase())n.waitStatus=!0,_.emit("wait");o(n)}else if("fail"===e)if(t=v.extend({},t,{pack:"bridgeinit"}),A=!1,N=!0,"block"!==t.result)_.emit("connect",T.STATUS.FAIL,t)}),m.on("communicate",function(e,t){_.emit("communicate",e,t)}),m.on("send",function(e,t){_.emit("send",e,t)}),_.on("config",function(e){I.handles=e||I.handles}),l.on("network",function(e){_.emit("network",e)})}function c(){E.clear()}var d=require("./connect"),l=require("./receive"),f=require("./history"),m=require("./send"),p=require("./end"),g=require("../prevent"),h=require("./aiPrologue"),v=require("../../base/main"),b=v.Storage,y=require("../../util/group"),w=require("../../message"),T=require("../../model"),_=require("../../emitter"),E=(require("../../lang"),new b("im")),x={session:"",keep:0},S={STATUS_NORMAL:0,STATUS_WAIT:1,TIME_OFFLINE:13e4,ERROR_INIT_WELCOME:1,ERROR_INIT_BRIDGE:2,OVER_TYPE_KICK:1,OVER_TYPE_FORCE:2,HAS_HIS_MSG:1,CS_STATUS_WAIT:3,CHAT_TIME_OUT:12e4,COOKIE_ACK:"QIAO_COOKIE_ACK",COOKIE_ACK_TIME:3e4,STOP_TYPE_KICK:"kick",STOP_TYPE_FORCE:"force"},I={},C={0:"word",1:"welcome",2:"autoReply",3:"autoReply",7:"wait"},L={MSG:1,TRACE:1,SYSTEMMSG:1},k={},N=!0,A=!1;k.success=function(e){var t=e.content;if(t)E.set("lastTime",(new Date).getTime()),_.emit("tunnel",e)},k.stop=function(){n()},k.restart=function(){l.reset(),_.emit("restart")},k.scenefocus=function(){if(!T.get("inittype"))m.switchPreviewStatus(!0)},k.sceneunfocus=function(){m.switchPreviewStatus(!1)},k.scenemsg=function(){_.emit("inputing")},k.communicatetransfer=function(e){var t=e.content;s(t);var n=e.extend||{},i=n.adata;if(t.customName=y.getShowSubNameById(t.new_subid,T.get("group"),T.get()),i){var r=i.transfer||{};if(r.status)_.emit("transfer",t)}else _.emit("transfer",t)},k.kick=function(e){if(n(),e&&+e.type===S.OVER_TYPE_KICK)_.emit("endsession","kick");else if(e&&+e.type===S.OVER_TYPE_FORCE)_.emit("endsession","force")},k.assigntaskack=function(e){s(e)},k.taskbegin=function(e){s(e),T.set("sessionid",e.sessionid),_.emit("taskbegin",e)},k.message=function(e,t){r(e,t)},u();var exports={};return exports.connect=function(e,t){if(N)N=!1,e&&T.set(e),d.start(),I.handles=t||I.handles},exports.send=function(e,t,n){if(t=t||"msg",!L[t.toUpperCase()])return void(n&&n("fail",{info:"未传递正确类型"}));if(v.isString(e))e={type:"text",text:e};w.comParser.encode(e,function(i){m.say(i,e,t,n)})},exports.disconnect=function(){if(A)l.stop(),p.start(),t(),c(),l.reset()},exports.hasConnected=function(){return!N},exports.getHistory=function(e,t){f.get(e,t)},exports.sendPreview=function(e,t){m.sendPreview(e,t)},exports.verify=function(e,t){g.verify(e,function(e,n){if(e===T.STATUS.SUCCESS)exports.connect();t(e,n)})},exports.getAuthCode=function(e){g.getAuthCode(e)},exports.msgFilter=function(){return l.filter}(),exports.historyFilter=function(){return f.filter}(),exports}),define("qiao-im-sdk/util/bcs",["require","../base/main"],function(require){function e(e,i,r){var a={siteid:e.siteid,ucid:e.ucid,file:e.fid,sign:e.sign||""},o=n.URL_UPLOAD+e.type;t.ajax(o,{data:a,onsuccess:i,onfail:r})}var t=require("../base/main"),n={URL_UPLOAD:"/im/?module=im&controller=frontUrl&action=uploadUrl&app_type=web&m=",URL_DOWNLOAD:"/im/?module=im&controller=frontUrl&action=downloadUrl&app_type=web"},exports={};return exports.getUploadPath=function(t,n,i){var r;e(t,function(e){e=e||{},r=e.data||{},r.fid=t.fid,n&&n(r)},function(e){e=e||{},r=e.data||{},r.fid=t.fid,i&&i(r)})},exports.download=function(e,i,r){var a={siteid:e.siteid,ucid:e.ucid,file:e.fid,token:e.token,type:e.type};t.ajax(n.URL_DOWNLOAD,{data:a,type:r,onsuccess:function(e){if(0===e.status)i&&i(e.data.url)}})},exports}),define("qiao-im-sdk/message",["require","./base/main","./util/bcs","./model","./emitter"],function(require){function e(){this.filters=[],this.types=[]}function t(e){for(var t,n=e.length,i=0;n>i;i++)if(t=e[i],"text"===t.type&&d.test(t.text))t.text=t.text.replace(d,"")+"</div>"}function n(){this.encoder={},this.decoder={}}var i=require("./base/main"),r=require("./util/bcs"),a=require("./model"),o=require("./emitter"),s={lib:i,bcs:r,data:{get:a.get,STATUS:a.STATUS},emitter:o},u=require("./model").ERROR,c=i.format,d=/<\/div>/i,l="没有添加${name}类型的消息插件或者不支持此种消息类型";e.prototype.addFilter=function(e,t){this.filters[e]=t},e.prototype.addType=function(e,t,n){if(n)return void(this.types[e]=1);else return void(this.types[e]=t||"")},n.prototype.clone=function(e){e.encoder=i.clone(this.encoder),e.decoder=i.clone(this.decoder)},n.prototype.encode=function(e,t){var n,i=e.type,r=this.encoder[i];if(r)n=r(e),t&&t("<msg>"+n+"</msg>");else o.emit("error",u.MESSAGE_PLUGIN_NOT_FOUND,{info:c(l,{name:i})})},n.prototype.decode=function(e,n,r,a){var s=[],d=this.decoder,m={};if(r)m=r.types;for(var p,g={},h=0;p=e[h];h++)if(g=i.clone(p),1!==m[p.type]){if(m[p.type]){var v=m[p.type];if(!v)continue;g.type="text",g.text=v,s.push(g);continue}if("url"===p.type&&"map"===p.t&&d.map)p.type="map";var b=d[p.type];if(b){var y=b(p);g.type=y.type||p.type,g.text=y.text,s.push(g)}else o.emit("error",u.MESSAGE_PLUGIN_NOT_FOUND,{info:c(l,{name:p.type})})}else;var w=s.length;if(!w)return void a(e);for(var T=[],_=!1,E=0;w>E;E++)if(p=s[E],g=i.clone(p),f[p.type]){for(var x,S=0;x=T[S];S++)if("text"===x.type)x.text+=p.text,_=!0;if(!_)g.type="text",g.text=p.text,T.push(g)}else T.push(g);t(T),a(T)},n.prototype.addPlugin=function(e){var t=this.encoder,n=this.decoder,i=e(s).encoder;if(i)for(var r in i)if(i.hasOwnProperty(r))t[r]=i[r];var a=e(s).decoder;if(a)for(r in a)if(a.hasOwnProperty(r))n[r]=a[r]},n.prototype.addPlugin=function(e){var t=this.encoder,n=this.decoder,i=e(s).encoder;if(i)for(var r in i)if(i.hasOwnProperty(r))t[r]=i[r];var a=e(s).decoder;if(a)for(r in a)if(a.hasOwnProperty(r))n[r]=a[r]};var exports={},f={face:1,text:1,img:1,audio:0,voice:1,map:1,url:1,file:0,font:1,html:1};return exports.doFilter=function(e,t,n){var i;if(n){i=n.filters;for(var r in i)if(i.hasOwnProperty(r))if(i[r](e,t))return!0}return!1},exports.Filter=e,exports.Parser=n,exports.comParser=new n,exports}),define("qiao-im-sdk/plugin",["require","./base/main","./model","./emitter","./message"],function(require){var e=require("./base/main"),t=require("./model"),n=require("./emitter"),i=require("./message"),exports={};return exports.addPlugin=function(r,a){a.init&&a.init({lib:e,data:{get:t.get,STATUS:t.STATUS,ERROR:t.ERROR},emitter:n,message:i})},exports}),define("qiao-im-sdk/emitter",["require","./base/main"],function(require){var e=require("./base/main").Emitter,t=new e;return t}),define("qiao-im-sdk/model",["require","./emitter","./base/main"],function(require){var e=require("./emitter"),t=require("./base/main"),n=t.isMobile,i={TYPE_VIS_PC:1,TYPE_VIS_MOBILE:2,TYPE_VIS_MINI:3,TYPE_VIS_MOBILE_MINI:4},r=t.Storage,a={bid:"",peerid:"",siteid:"",userName:"1",ucid:"",seq:0,session:"",subid:"",tid:"",distSubid:"",distGroupid:"",sessionid:"",tag:"",visSessionid:"",compName:"",customName:"",csNameType:2,chatType:1,group:[],crossDomain:!1,visitType:n()?i.TYPE_VIS_MOBILE:i.TYPE_VIS_PC,inittype:0,appid:"",hisMsgCount:0,isAiPrologue:0,previewTime:8e3},exports={};return exports.set=function(e,n){if(t.isObject(e))t.extend(a,e);else a[e]=n},exports.get=function(e){return e?a[e]:t.extend({},a)},exports.init=function(n,i){t.extend(a,n),a.distGroupid=a.groupid,a.distSubid=a.subid,a.restart=!1,r.init({siteid:n.siteid}),e.emit("config",i)},exports.STATUS={SUCCESS:0,FAIL:1,ANTIATTACK:2,ACCEPT:3,REJECT:4,STARTSEND:5},exports.ERROR={MESSAGE_PLUGIN_NOT_FOUND:40001},exports}),define("qiao-im-sdk/base/convert",[],function(){function e(e){var t,a;e[0]=r(e[0],-180,180),e[1]=i(e[1],-74,74),t=e.slice(0);for(var s=0;s<o.length;s++)if(t[1]>=o[s]){a=u[s];break}if(!a)for(s=o.length-1;s>=0;s--)if(t[1]<=-o[s]){a=u[s];break}var c=n(e,a);return e=[c[0].toFixed(2),c[1].toFixed(2)]}function t(e){var t,i;t=[Math.abs(e[0]),Math.abs(e[1])];for(var r=0;r<a.length;r++)if(t[1]>=a[r]){i=s[r];break}var o=n(e,i);return e=[o[0].toFixed(6),o[1].toFixed(6)]}function n(e,t){if(e&&t){var n=t[0]+t[1]*Math.abs(e[0]),i=Math.abs(e[1])/t[9],r=t[2]+t[3]*i+t[4]*i*i+t[5]*i*i*i+t[6]*i*i*i*i+t[7]*i*i*i*i*i+t[8]*i*i*i*i*i*i;return n*=e[0]<0?-1:1,r*=e[1]<0?-1:1,[n,r]}}function i(e,t,n){if(null!=t)e=Math.max(e,t);if(null!=n)e=Math.min(e,n);return e}function r(e,t,n){for(;e>n;)e-=n-t;for(;t>e;)e+=n-t;return e}var exports={},a=[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],o=[75,60,45,30,15,0],s=[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],u=[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]];return exports.pixelToLngLat=function(e,n,i){return t([e/Math.pow(2,i-18),n/Math.pow(2,i-18)])},exports.lngLatToPixel=function(t,n,i){var r=e([t,n]),a=r[0]*Math.pow(2,i-18),o=r[1]*Math.pow(2,i-18);return[Math.ceil(a),Math.ceil(o)]},exports}),define("qiao-im-sdk/base/event",["require"],function(require){var e={on:function(e,t,n){if(e.addEventListener)e.addEventListener(t,n,!1);else e.attachEvent("ontype",n)}};return{event:e}}),define("qiao-im-sdk/base/promise",["require","exports"],function(require,exports){function e(e){return"function"==typeof e}function t(e){return"[object Object]"===Object.prototype.toString.call(e)}function n(i,r){function a(e){if(!u)n(i,e),u=!0}function o(e){if(!u)i.reject(e),u=!0}function s(){var n;if(t(r)||e(r))if(n=r.then,e(n))n.call(r,a,o);else n=null;if(!n)i.fulfill(r)}var u;if(f)try{s()}catch(d){if(!u)c(d),i.reject(d)}else s()}function i(e,t,i){return function(r){function a(){var a=i(r);if(a===t)throw new TypeError;n(e,a)}if(f)try{a()}catch(o){c(o),e.reject(o)}else a()}}function r(e,t,n){if(e.status===t)d.nextTick(function(){n(e.data)});else if(t===l.FULFILLED)e.fulfillList.push(n);else if(t===l.REJECTED)e.rejectList.push(n)}function a(e){var t=e.status===l.FULFILLED?e.fulfillList:e.rejectList;if(u(e),t.length)d.nextTick(function(){for(var n;n=t.shift();)n(e.data)})}function o(t,n,a){var o=new d,u=s(o);if(e(n))n=i(o,u,n);else n=function(e){o.fulfill(e)};if(r(t,l.FULFILLED,n),e(a))a=i(o,u,a);else a=function(e){o.reject(e)};return r(t,l.REJECTED,a),u}function s(e){return{then:function(t,n){return o(e,t,n)},"catch":function(t){return o(e,null,t)}}}function u(e){var t=e.status===l.FULFILLED?"resolve":"reject";if(m)d.emit(t,e.data)}function c(e){if(m)d.emit("exception",e)}function d(){this.status=l.PENDING,this.fulfillList=[],this.rejectList=[]}var l={PENDING:0,FULFILLED:1,REJECTED:2},f=!0,m=!1,p=function(){function t(){var e,t=r.length;for(e=0;t>e;e++)r[e]();r.splice(0,e)}var n,i,r=[],a="promise";if("undefined"!=typeof process&&null!==process&&"function"==typeof process.nextTick)n=function(e){return process.nextTick(e)};else if(i=window.MutationObserver||window.webKitMutationObserver){var o=new i(function(e){var n=e[0];if(n.attributeName===a)t()}),s=document.createElement("div");o.observe(s,{attributes:!0}),n=function(e){r.push(e),s.setAttribute(a,Date.now?Date.now():(new Date).getTime())}}else if(e(window.postMessage))window.addEventListener("message",function(e){if(e.source===window&&e.data===a)t()},!1),n=function(e){r.push(e),window.postMessage(a,"*")};else n=function(e){setTimeout(e,0)};return n}();return d.nextTick=p,d.enableGlobalEvent=function(e){e.mixin(this),m=!0},d.disableExceptionCapture=function(){f=!1},d.enableExceptionCapture=function(){f=!0},d.all=function(e){function t(t){return function(n){if(a[t]=n,r++,r>=e.length)i.fulfill(a)}}function n(e){i.reject(e)}if(!Array.isArray(e))e=Array.prototype.slice.call(arguments);var i=new d,r=0,a=[];return e.forEach(function(e,i){e.then(t(i),n)}),i.promise()},d.race=function(e){function t(e){i.fulfill(e)}function n(e){i.reject(e)}var i=new d;if(!Array.isArray(e))e=Array.prototype.slice.call(arguments);return e.forEach(function(e){e.then(t,n)}),i.promise()},d.promise=function(e){var t=new d;return e(t),t.promise()},d.rejected=function(e){return this.promise(function(t){t.reject(e)})},d.fulfilled=function(e){return this.promise(function(t){t.fulfill(e)})},d.resolved=d.fulfilled,d.prototype.fulfill=function(e){if(this.status===l.PENDING)this.data=e,this.status=l.FULFILLED,a(this)},d.prototype.resolve=d.prototype.fulfill,d.prototype.reject=function(e){if(this.status===l.PENDING)this.data=e,this.status=l.REJECTED,a(this)},d.prototype.promise=function(){return s(this)},{Resolver:d}}),define("qiao-im-sdk/base/browser",["require"],function(require){var exports={};return exports.isMobile=function(){var e=navigator.userAgent;return!!e.match(/.*Mobile.*/)||"ontouchstart"in window},exports}),define("qiao-im-sdk/base/array",["require"],function(require){var exports={};return exports.indexOfArray=function(e,t,n){var i,r,a=e.length;for(i=0;a>i;i++){if(n)r=e[i][n];else r=e[i];if(i in e&&r===t)return i}return-1},exports.removeAtArray=function(e,t){return e.splice(t,1)[0]},exports}),define("qiao-im-sdk/base/Storage",[],function(){function e(e){this.id=e.toUpperCase()}var t,n=window.localStorage,i=window,r=i.document,a="QIAOUSERDATACHAT"+location.hostname,o=function(){function e(e){return e.replace(o,"___")}var t,n=null,i=365,o=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");return{build:function(e){e=e||{},t=a+(e.siteid||""),i=e.expires||i},setup:function(){if(!n)try{n=r.createElement("input"),n.type="hidden",n.addBehavior("#default#userData"),r.body.appendChild(n)}catch(e){return!1}return!0},setItem:function(r,a){r=e(r);var o=this,s=new Date;if(o.setup())return s.setDate(s.getDate()+i),n.expires=s.toUTCString(),n.load(t),n.setAttribute(r,a),n.save(t),a;else return void 0},getItem:function(i){i=e(i);var r=this;if(r.setup())return n.load(t),n.getAttribute(i)},clear:function(){var e=new Date;e.setDate(e.getDate()-1),n.expires=e.toUTCString()}}}();return e.init=function(e){var i=e.siteid;if(!t)t="BDBG_IM_"+i+"_";if(!window.localStorage)n=o,n.build({siteid:i})},e.clear=function(){n.clear()},e.prototype.key=function(){return t+this.id},e.prototype.get=function(e){var t;try{t=JSON.parse(n.getItem(this.key())||"{}")}catch(i){t={}}if(e)return t[e];else return t},e.prototype.clear=function(){try{try{n.setItem(this.key(),JSON.stringify({}))}catch(e){n.clear()}}catch(t){}},e.prototype.set=function(e,t){var i=this.get();i[e]=t;try{try{n.setItem(this.key(),JSON.stringify(i))}catch(r){n.clear(),n.setItem(this.key(),JSON.stringify(i))}}catch(a){}},{Storage:e}}),define("qiao-im-sdk/base/emitter",[],function(){function e(){}var t=e.prototype;return t._getEvents=function(){if(!this._events)this._events={};return this._events},t._getAfter=function(){if(!this._afters)this._afters={};return this._afters},t._getMaxListeners=function(){if(isNaN(this.maxListeners))this.maxListeners=10;return this.maxListeners},t.on=function(e,t){var n=this._getEvents(),i=this._getMaxListeners();n[e]=n[e]||[];var r=n[e].length;if(r>=i&&0!==i)throw new RangeError("Warning: possible Emitter memory leak detected. "+r+" listeners added.");return n[e].push(t),this},t.once=function(e,t){function n(){i.off(e,n),t.apply(this,arguments)}var i=this;return n.listener=t,this.on(e,n),this},t.off=function(e,t){var n=this._getEvents();if(0===arguments.length)return this._events={},this;var i=n[e];if(!i)return this;if(1===arguments.length)return delete n[e],this;for(var r,a=0;a<i.length;a++)if(r=i[a],r===t||r.listener===t){i.splice(a,1);break}return this},t.emit=function(e){for(var t=this._getEvents(),n=t[e],i=[],r=1;r<arguments.length;r++)i.push(arguments[r]);if(n)for(n=n.slice(0),r=0;r<n.length;r++)n[r]&&n[r].apply(this,i);return this},t.listeners=function(e){var t=this._getEvents();return t[e]||[]},t.setMaxListeners=function(e){return this.maxListeners=e,this},e.mixin=function(e){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e},{Emitter:e}}),define("qiao-im-sdk/base/net/jsonp",["require","../object","./img"],function(require){"use strict";function e(e,i){var s=a(),u=null,h=i.timeout||null,v=i.callbackKey||f,b=s,y=i.data||{};y.t=(new Date).getTime();var w=i.charset||m,T=function(e){i.onsuccess&&i.onsuccess(e),n(u),r(b)},_=function(){i.onfail&&i.onfail(),n(u),r(b)},E=o({url:e+t(e,y,v,b),charset:w,id:s});if(d[s]=c[s]=function(){try{T.apply(null,arguments)}catch(t){p.request(g,{type:"jsonp",errMsg:t.message||"",name:t.name||"",fileName:t.fileName||"",url:e,stack:t.stack||""}),_.apply(null,arguments)}},l[s]=function(){_.apply(null,arguments)},h)u=setTimeout(function(){u=null,E.abort(),_.call(null)},h);return E.send(),E}function t(e,t,n,i){var r={}.toString.call(t),a="?";if(e.indexOf("?")>-1)a="&";var o=a+n+"="+i;if("[object Object]"===r)o+="&"+s(t);return o}function n(e){if(e)clearTimeout(e),e=null}function i(e){if(c[e])c[e]=h(e),d[e]=null,delete d[e]}function r(e){try{d[e]=null,c[e]=null,delete d[e],delete c[e]}catch(t){}}function a(){var e="cxxxxxxx_xxxx_4xxx_yxxx_xxxxxxxxxxxx";return e.replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)})}function o(e){var t,n=u.head||u.getElementsByTagName("head")&&u.getElementsByTagName("head")[0]||u.body;return{send:function(){t=u.createElement("script"),t.async=!0,t.charset=e.charset,t.src=e.url,t.id=e.id,t.onload=t.onreadystatechange=function(n){if(n===!0||!t.readyState||/loaded|complete/.test(t.readyState)){if(t.onload=t.onreadystatechange=null,t.parentNode)t.parentNode.removeChild(t);if(t=null,n===!0)i(e.id)}},t.onerror=function(){if(t.parentNode)t.parentNode.removeChild(t);if(l[t.id])l[t.id].call(null);t=null},n.insertBefore(t,n.firstChild)},abort:function(){if(t)t.onload(!0)}}}var s=require("../object").jsonToQuery,u=document,c=window,d={},l={},f="callback",m="utf-8",p=require("./img"),g="//scqiao.baidu.com/front/ajaxError.gif",h=function(e){return function(){try{c[e]=null,delete c[e]}catch(t){}}};return{request:e}}),define("qiao-im-sdk/base/net/img",["require","../object"],function(require){var e=require("../object"),t=function(){var e=0;return function(){var t=(new Date).getTime();return t+="_"+e++}}(),exports={};return exports.request=function(n,i,r,a){if("function"==typeof i)a=r,r=i,i=null;(i=i||{}).t=t(),n+=(n.indexOf("?")>-1?"&":"?")+e.jsonToQuery(i);var o=new Image;o.onload=function(){o.onload=null,o.onerror=null,o=null,r&&r()},o.onerror=function(){o.onload=null,o.onerror=null,o=null,a&&a()},o.src=n},exports}),define("qiao-im-sdk/base/string",["require"],function(require){var e={amp:"&",lt:"<",gt:">",quot:'"',apos:"'"},exports={};return exports.encodeHTML=function(e){if(!e)return"";else return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},exports.decodeHTML=function(t){if(!t)return"";else return(t+"").replace(/\&([^;]+);/g,function(t,n){var i;if(n in e)return e[n];else if(i=n.match(/^#x([\da-fA-F]+)$/))return String.fromCharCode(parseInt(i[1],16));else if(i=n.match(/^#(\d+)$/))return String.fromCharCode(parseInt(i[1],10));return t})},exports.format=function(e,t){if(!e)return"";if(null==t)return e;var n="function"==typeof t?t:function(e){var n=t[e];return null==n?"":n};return(e+"").replace(/\$\{(.+?)\}/g,function(e,t){return n(t)})},exports.objectToString=function(e){var t=[],n=function(e){if("object"==typeof e&&null!==e)return this.objectToString(e);else return/^(string|number)$/.test(typeof e)?'"'+e+'"':e};for(var i in e)if(e.hasOwnProperty(i))t.push('"'+i+'":'+n(e[i]));return"{"+t.join(",")+"}"},exports}),define("qiao-im-sdk/base/object",["require","./string"],function(require){var e=require("./string"),exports={};exports.extend=function(e,t){for(var n=arguments.length,i=1;n>i;i++)if(t=arguments[i]){for(var r in t)if(t.hasOwnProperty(r)&&void 0!==t[r])e[r]=t[r]}else;return e},exports.extendOwn=function(e,t){
for(var n=1,i=arguments.length;i>n;n++)if(t=arguments[n]){for(var r in t)if(t.hasOwnProperty(r)&&e.hasOwnProperty(r)&&void 0!==t[r])e[r]=t[r]}else;return e},exports.clone=function(e){for(var t={},n=0,i=arguments.length;i>n;n++)if(e=arguments[n]){for(var r in e)if(e.hasOwnProperty(r)&&void 0!==e[r])t[r]=e[r]}else;return t},exports.jsonToQuery=function(t){var n,i,r=[];for(var a in t)if(t.hasOwnProperty(a))if(n=t[a],exports.isArray(n))for(i=n.length;i--;)r.push(a+"="+encodeURIComponent(n[i]));else if(exports.isObject(n))r.push(a+"="+encodeURIComponent(e.objectToString(n)));else r.push(a+"="+encodeURIComponent(n));return r.join("&")};var t=Object.prototype.toString;return exports.isObject=function(e){return"[object Object]"===t.call(e)},exports.isString=function(e){return"[object String]"===t.call(e)},exports.isArray=function(e){return"[object Array]"===t.call(e)},exports.isNumber=function(e){return!!/^[0-9]+$/.test(e)},exports}),define("qiao-im-sdk/base/net/ajax",["require","../object","./img"],function(require){function e(){}function t(n,i){function r(){if(4===l.readyState){try{var t=l.status}catch(n){return void o("failure")}if(o(t),t>=200&&300>t||304===t||1223===t)o("success");else o("failure");window.setTimeout(function(){if(l.onreadystatechange=e,m)l=null},0)}}function a(){if(window.ActiveXObject)try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}if(window.XMLHttpRequest)return new XMLHttpRequest;else return void 0}function o(e){e="on"+e;var r=y[e],a=t[e];if(r){if(c)clearTimeout(c);if("onsuccess"!==e)r(l);else try{var o=l.responseText;o=new Function("return ("+o+")")(),i.onsuccess(o)}catch(d){return s.request(u,{errMsg:d.message||"",name:d.name||"",fileName:d.fileName||"",url:n,stack:d.stack||""}),i.onfailure(l)}}else if(a){if("onsuccess"===e)return;a(l)}}i=i||{};var c,d,l,f=i.data||"",m=!(i.async===!1),p=i.username||"",g=i.password||"",h=(i.method||"GET").toUpperCase(),v=i.headers||{},b=i.timeout||0,y={};for(d in i)if(i.hasOwnProperty(d))y[d]=i[d];if(0!==n.indexOf("http"))v["X-Requested-With"]="XMLHttpRequest";try{if(l=a(),"GET"===h){if(f)n+=(n.indexOf("?")>=0?"&":"?")+f,f=null;if(i.noCache)n+=(n.indexOf("?")>=0?"&":"?")+"b"+ +new Date+"=1"}if(p)l.open(h,n,m,p,g);else l.open(h,n,m);if(m)l.onreadystatechange=r;if("POST"===h)v["Content-Type"]=v["Content-Type"]||"application/x-www-form-urlencoded",l.setRequestHeader("Content-Type",v["Content-Type"]),delete v["Content-Type"];for(d in v)if(v.hasOwnProperty(d))l.setRequestHeader(d,v[d]);if(o("beforerequest"),b)c=setTimeout(function(){l.onreadystatechange=e,l.abort(),o("timeout")},b);if(l.send(f),!m)r()}catch(w){o("failure")}return l}function n(){return(new Date).getTime().toString(36)}function i(i,a){var s=a.onsuccess||e,u=a.onfailure||e;a.onsuccess=s,a.onfailure=u;var c=a.data||{};if(a.method===o)i+=(i.indexOf("?")>=0?"&":"?")+"_t="+n(),a.data=r(c);else c._t=n(),i+=(i.indexOf("?")>=0?"&":"?")+r(c),a.data=null;return t(i,a)}var r=require("../object").jsonToQuery,a="GET",o="POST",s=require("./img"),u="//scqiao.baidu.com/front/ajaxError.gif",exports={};return exports.post=function(e,t,n,r){return i(e,{method:o,data:t,onsuccess:n,onfailure:r})},exports.get=function(e,t,n,r){return i(e,{method:a,data:t,onsuccess:n,onfailure:r})},exports}),define("qiao-im-sdk/base/ajax",["require","./net/ajax","./net/jsonp","./net/img"],function(require){var e=require("./net/ajax"),t=require("./net/jsonp"),n=require("./net/img"),i="//p.qiao.baidu.com",exports={};return exports.ajax=function(n,r){if("jsonp"===r.type)return n=r.hasDomain?n:i+n,t.request(n,r);if("post"===r.method)return e.post(n,r.data,r.onsuccess,r.onfail);else return e.get(n,r.data,r.onsuccess,r.onfail)},exports.img=function(e,r){if("jsonp"===r.type)return t.request(i+e,r);else return void n.request(e,r.data,r.onsuccess,r.onfail)},exports}),define("qiao-im-sdk/base/main",["require","./ajax","./emitter","./Storage","./string","./array","./browser","./object","./promise","./event","./convert"],function(require){function e(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}var exports={};return e(exports,require("./ajax")),e(exports,require("./emitter")),e(exports,require("./Storage")),e(exports,require("./string")),e(exports,require("./array")),e(exports,require("./browser")),e(exports,require("./object")),e(exports,require("./promise")),e(exports,require("./event")),e(exports,require("./convert")),exports}),define("qiao-im-sdk",["qiao-im-sdk/lite"],function(e){return e}),define("qiao-im-sdk/lite",["require","./base/main","./model","./plugin","./core/im/main","./core/rcv/main","./emitter","./plugins/connectLog","./plugins/sendLog","./plugins/site","./plugins/file","./plugins/errorLog","./message","./messagePlugins/text","./messagePlugins/img","./messagePlugins/map","./messagePlugins/voice"],function(require){var e=require("./base/main"),t=require("./model"),n=require("./plugin").addPlugin,i=e.extend,exports={};i(exports,require("./core/im/main")),i(exports,require("./core/rcv/main")),exports.init=t.init,exports.getData=t.get,exports.STATUS=t.STATUS,exports.ERROR=t.ERROR;var r=require("./emitter");exports.on=function(){var e=[].slice.call(arguments);r.on.apply(r,e)},exports.emit=function(){var e=[].slice.call(arguments);r.emit.apply(r,e)},exports.addPlugin=require("./plugin").addPlugin,n("connectLog",require("./plugins/connectLog")),n("sendLog",require("./plugins/sendLog")),n("site",require("./plugins/site")),n("file",require("./plugins/file")),n("errorLog",require("./plugins/errorLog"));var a=require("./message"),o=a.comParser;return o.addPlugin(require("./messagePlugins/text")),o.addPlugin(require("./messagePlugins/img")),o.addPlugin(require("./messagePlugins/map")),o.addPlugin(require("./messagePlugins/voice")),exports.addMessagePlugin=function(){var e=[].slice.call(arguments);o.addPlugin.apply(o,e)},exports}),define("front/webimlite/base/emitter",[],function(){function e(){}var t=e.prototype;return t._getEvents=function(){if(!this._events)this._events={};return this._events},t._getAfter=function(){if(!this._afters)this._afters={};return this._afters},t._getMaxListeners=function(){if(isNaN(this.maxListeners))this.maxListeners=10;return this.maxListeners},t.on=function(e,t){var n=this._getEvents(),i=this._getMaxListeners();n[e]=n[e]||[];var r=n[e].length;if(r>=i&&0!==i)throw new RangeError("Warning: possible Emitter memory leak detected. "+r+" listeners added.");return n[e].push(t),this},t.once=function(e,t){function n(){i.off(e,n),t.apply(this,arguments)}var i=this;return n.listener=t,this.on(e,n),this},t.off=function(e,t){var n=this._getEvents();if(0===arguments.length)return this._events={},this;var i=n[e];if(!i)return this;if(1===arguments.length)return delete n[e],this;for(var r,a=0;a<i.length;a++)if(r=i[a],r===t||r.listener===t){i.splice(a,1);break}return this},t.emit=function(e){for(var t=this._getEvents(),n=t[e],i=[],r=1;r<arguments.length;r++)i.push(arguments[r]);if(n)for(n=n.slice(0),r=0;r<n.length;r++)n[r]&&n[r].apply(this,i);return this},t.listeners=function(e){var t=this._getEvents();return t[e]||[]},t.setMaxListeners=function(e){return this.maxListeners=e,this},e.mixin=function(e){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e},e}),define("front/webimlite/base/json",["require","exports"],function(require,exports){function e(e){if(/["\\\x00-\x1f]/.test(e))e=e.replace(/["\\\x00-\x1f]/g,function(e){var t=r[e];if(t)return t;else return t=e.charCodeAt(),"\\u00"+Math.floor(t/16).toString(16)+(t%16).toString(16)});return'"'+e+'"'}function t(e){var t,n,i,r=["["],a=e.length;for(n=0;a>n;n++)switch(i=e[n],typeof i){case"undefined":case"function":case"unknown":break;default:if(t)r.push(",");r.push(exports.stringify(i)),t=1}return r.push("]"),r.join("")}function n(e){return 10>e?"0"+e:e}function i(e){return'"'+e.getFullYear()+"-"+n(e.getMonth()+1)+"-"+n(e.getDate())+"T"+n(e.getHours())+":"+n(e.getMinutes())+":"+n(e.getSeconds())+'"'}var r={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};exports.parse=function(e){return new Function("return ("+e+")")()},exports.stringify=function(n){switch(typeof n){case"undefined":return"undefined";case"number":return isFinite(n)?String(n):"null";case"string":return e(n);case"boolean":return String(n);default:if(null===n)return"null";else if(n instanceof Array)return t(n);else if(n instanceof Date)return i(n);var r,a,o=["{"],s=exports.stringify;for(var u in n)if(Object.prototype.hasOwnProperty.call(n,u))switch(a=n[u],typeof a){case"undefined":case"unknown":case"function":break;default:if(r)o.push(",");r=1,o.push(s(u)+":"+s(a))}return o.push("}"),o.join("")}}}),define("front/webimlite/base/event",["require","exports","./dom"],function(require,exports){var e=require("./dom"),t=e.g;exports.EventArg=function(e,t){t=t||window,e=e||t.event;var n=t.document;this.target=e.target||e.srcElement,this.keyCode=e.which||e.keyCode;for(var i in e){var r=e[i];if("function"!=typeof r)this[i]=r}if(!this.pageX&&0!==this.pageX)this.pageX=(e.clientX||0)+(n.documentElement.scrollLeft||n.body.scrollLeft),this.pageY=(e.clientY||0)+(n.documentElement.scrollTop||n.body.scrollTop);this._event=e},exports.EventArg.prototype.preventDefault=function(){if(this._event.preventDefault)this._event.preventDefault();else this._event.returnValue=!1;return this},exports.EventArg.prototype.stopPropagation=function(){if(this._event.stopPropagation)this._event.stopPropagation();else this._event.cancelBubble=!0;return this},exports.EventArg.prototype.stop=function(){return this.stopPropagation().preventDefault()},exports._listeners=exports._listeners||[],exports.get=function(e,t){return new exports.EventArg(e,t)},exports.getTarget=function(e){return e.target||e.srcElement},exports.on=function(e,n,i){n=n.replace(/^on/i,""),e=t(e);var r,a=function(t){i.call(e,t)},o=exports._listeners,s=exports._eventFilter,u=n;if(n=n.toLowerCase(),s&&s[n])r=s[n](e,n,a),u=r.type,a=r.listener;if(e.addEventListener)e.addEventListener(u,a,!1);else if(e.attachEvent)e.attachEvent("on"+u,a);return o[o.length]=[e,n,i,a,u],e},exports.preventDefault=function(e){if(e.preventDefault)e.preventDefault();else e.returnValue=!1},exports.stopPropagation=function(e){if(e.stopPropagation)e.stopPropagation();else e.cancelBubble=!0},exports.un=function(e,n,i){e=t(e),n=n.replace(/^on/i,"").toLowerCase();for(var r,a,o,s=exports._listeners,u=s.length,c=!i;u--;)if(r=s[u],r[1]===n&&r[0]===e&&(c||r[2]===i)){if(a=r[4],o=r[3],e.removeEventListener)e.removeEventListener(a,o,!1);else if(e.detachEvent)e.detachEvent("on"+a,o);s.splice(u,1)}return e}}),define("front/webimlite/base/string",["require","exports"],function(require,exports){var e=new RegExp("(^[\\s\\t\\xa0\\u3000]+)|([\\u3000\\xa0\\s\\t]+$)","g");exports.trim=function(t){return String(t).replace(e,"")},exports.encodeHTML=function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},exports.decodeHTML=function(e){var t=String(e).replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");return t.replace(/&#([\d]+);/g,function(e,t){return String.fromCharCode(parseInt(t,10))})},exports.escapeReg=function(e){return String(e).replace(new RegExp("([.*+?^=!:${}()|[\\]/\\\\])","g"),"\\$1")},exports.format=function(e,t){e=String(e);var n=Array.prototype.slice.call(arguments,1),i=Object.prototype.toString;if(n.length)return n=1===n.length?null!==t&&/\[object Array\]|\[object Object\]/.test(i.call(t))?t:n:n,e.replace(/#\{(.+?)\}/g,function(e,t){var r=n[t];if("[object Function]"===i.call(r))r=r(t);return"undefined"==typeof r?"":r});else return e}}),define("front/webimlite/base/browser",["require","exports"],function(require,exports){var e=navigator.userAgent;exports.firefox=/firefox\/(\d+\.\d+)/i.test(e)?+RegExp.$1:void 0,exports.ie=/msie (\d+\.\d+)|rv:11/i.test(e)?document.documentMode||+RegExp.$1:void 0,exports.isStrict="CSS1Compat"===document.compatMode,exports.isGecko=/gecko/i.test(e)&&!/like gecko/i.test(e),exports.isWebkit=/webkit/i.test(e),exports.opera=/opera(\/| )(\d+(\.\d+)?)(.+?(version\/(\d+(\.\d+)?)))?/i.test(e)?+(RegExp.$6||RegExp.$2):void 0,exports.chrome=/chrome/i.test(e),exports.safari=/Safari/i.test(e)&&/Version/i.test(e)}),define("front/webimlite/base/dom",["require","exports","./browser","./string"],function(require,exports){var e=require("./browser"),t=require("./string"),n=e.opera,i=e.ie,r={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",usemap:"useMap",frameborder:"frameBorder"};if(8>i)r["for"]="htmlFor",r["class"]="className";else r.htmlFor="for",r.className="class";exports.g=function(e){if("string"==typeof e)return document.getElementById(e);else return e},exports.q=function(e,n,i){var r,a,o,s,u=[],c=t.trim;if(!(e=c(e)))return u;if("undefined"==typeof n)n=document;else if(n=exports.g(n),!n)return u;if(i&&(i=c(i).toUpperCase()),n.getElementsByClassName)for(o=n.getElementsByClassName(e),r=o.length,a=0;r>a;a++)if(s=o[a],!i||s.tagName===i)u[u.length]=s;else;else for(e=new RegExp("(^|\\s)"+t.escapeReg(e)+"(\\s|$)"),o=i?n.getElementsByTagName(i):n.all||n.getElementsByTagName("*"),r=o.length,a=0;r>a;a++)s=o[a],e.test(s.className)&&(u[u.length]=s);return u},exports.setAttr=function(e,t,n){if(e=exports.g(e),"style"===t)e.style.cssText=n;else t=r[t]||t,e.setAttribute(t,n);return e},exports.setAttrs=function(e,t){var n;e=exports.g(e);for(n in t)if(t.hasOwnProperty(n))exports.setAttr(e,n,t[n]);return e},exports.create=function(e,t){var n=document.createElement(e);return exports.setAttrs(n,t||{})},exports.insertHTML=function(e,t,i){var r,a;if("string"==typeof e)e=document.getElementById(e);if(e.insertAdjacentHTML&&!n)e.insertAdjacentHTML(t,i);else{if(r=e.ownerDocument.createRange(),t=t.toUpperCase(),"AFTERBEGIN"===t||"BEFOREEND"===t)r.selectNodeContents(e),r.collapse("AFTERBEGIN"===t);else a="BEFOREBEGIN"===t,r[a?"setStartBefore":"setEndAfter"](e),r.collapse(a);r.insertNode(r.createContextualFragment(i))}return e},exports.hasClass=function(e,n){if(e=exports.g(e),!e||!e.className)return!1;var i=t.trim(n).split(/\s+/),r=i.length;for(n=e.className.split(/\s+/).join(" ");r--;)if(!new RegExp("(^| )"+i[r]+"( |$)").test(n))return!1;return!0},exports.addClass=function(e,t){e=exports.g(e);for(var n=t.split(/\s+/),i=e.className,r=" "+i+" ",a=0,o=n.length;o>a;a++)if(r.indexOf(" "+n[a]+" ")<0)i+=(i?" ":"")+n[a];return e.className=i,e},exports.removeClass=function(e,t){e=exports.g(e);for(var n,i,r=e.className.split(/\s+/),a=t.split(/\s+/),o=a.length,s=0;o>s;++s)for(i=0,n=r.length;n>i;++i)if(r[i]===a[s]){r.splice(i,1);break}return e.className=r.join(" "),e}}),define("front/webimlite/main",["require","./base/dom","./base/event","./base/json","./base/emitter","qiao-im-sdk","./base/localstorage","./base/zoom","../base/Promise","../common/identity","./base/browser","./base/string","./base/date","./base/object","./im/config","./im/lang","./im/editor","../base/emitter"],function(require){function e(){var e,n,i,r=1===te.position?"left:0px;right:auto;":"";if(ne.container=B("div",{id:"BD_QIAO_WEBIM_LITE_WRAP",className:"BD-QIAO-WEBIM-LITE-WRAP",style:"display:none;"+r}),ne.title=B("div",{className:"m-lite-title"}),te.bgColor)ne.title.style.cssText="background-color:"+te.bgColor;for(ne.title.innerHTML=ae.title,ne.container.appendChild(ne.title),e=ne.title.getElementsByTagName("a"),n=0;i=e[n];n++)if(i.className.indexOf("btn-min")>=0)ne.minBtn=i;else if(i.className.indexOf("btn-max")>=0)ne.maxBtn=i;if(ne.content=B("div",{className:"m-lite-content",id:"qiao-m-lite-content"}),ne.container.appendChild(ne.content),ne.tip=B("div",{className:"m-lite-tip"}),ne.container.appendChild(ne.tip),ne.editor=B("div",{className:"m-lite-editor"}),ne.container.appendChild(ne.editor),ne.opt=B("a",{className:"m-lite-opt",target:"_blank",href:"http://qiao.baidu.com/home/"}),ne.opt.innerHTML=ae.opt,ne.container.appendChild(ne.opt),ne.preview=B("div",{className:"m-lite-preview"}),ne.container.appendChild(ne.preview),ne.widgets=[ne.content,ne.editor,ne.opt,ne.tip,ne.preview],U.ie<=6)ne.iframe=B("iframe",{src:"about:blank",scrolling:"no",frameborder:0,style:"width:100%;z-index:-1;position:absolute;top:0;left:0;"}),ne.container.appendChild(ne.iframe),ne.container.style.position="absolute",window.attachEvent("onscroll",t),window.attachEvent("onresize",t);document.body.appendChild(ne.container),X.init(ne.editor,te)}function t(){var e=U.isStrict?document.documentElement:document.body,t=ne.container;t.style.top=e.clientHeight+e.scrollTop-t.clientHeight+"px"}function n(e){e.scrollTop+=e.scrollHeight}function i(){var e=/(^|\s+)btn-([^-]+)(\s+|$)/;ne.container.onclick=function(t){var n;t=t||window.event,n=t.target||t.srcElement;var i=n.tagName.toLowerCase();if("i"===i)n=n.parentNode,i=n.tagName.toLowerCase();if("a"===i&&n.className.indexOf("btn")>=0)n.className.replace(e,function(e,t,i,r){var a;if(a=re[i])a.call(null,n)}),W(t);else if("span"===i&&n.className.indexOf("m-lite-title-notify-text")>=0)y("all");else if(n.className.indexOf("m-send-method-btn")>=0){if(S.hasClass(S.q("m-send-method-btn")[0],"arrow"))return S.q("m-send-method")[0].style.display="none",void S.removeClass(S.q("m-send-method-btn")[0],"arrow");S.q("m-send-method")[0].style.display="block",S.addClass(S.q("m-send-method-btn")[0],"arrow")}o(!1)},X.on("focus",function(){o(!1)}),k.on("init",function(e,t){if(e===k.STATUS.SUCCESS)k.connect(J)}),k.on("message",function(e,t,n,i){for(var r,a=e.length,s=0;a>s;s++){if(r=e[s],r.type="server",ie.messages.push(r),r.time=new Date,i&&"visitor"===i.speakerType)t="我",r.type="client";if(i&&"history"===i.messageType)r.time=new Date(parseInt(n,10));r.csName=t,l(r)}if("none"===ie.showType)y("min");o(!0)}),k.on("connect",function(e){if("fail"===e)return l({text:K.ERROR.DROP_KICKED,type:"info"}),void(ie.sendAbled=!1);ie.status=1,ie.sendAbled=!0,exports.emit("ready");var t=document.getElementById("BD_QIAO_WEBIM_LITE_WRAP");if(P("m-lite-msg-info-inner",t)[0].innerHTML="转接成功",x)T(x)}),k.on("bridgeinit",function(e){if("fail"===e)P("m-lite-btn",ne.editor)[0].className+=" m-lite-opt-unablebtn"}),k.on("info",function(e){l({text:e,type:"info"})}),k.on("inputing",function(){s('<i class="inputing"></i><span>对方正在输入...</span>')}),k.on("error",function(e){switch(e){case Q.CONNECT:var t=document.getElementById("BD_QIAO_WEBIM_LITE_WRAP");P("m-lite-msg-info-inner",t)[0].innerHTML="转接失败"}}),k.on("endsession",function(){l({text:K.ERROR.DROP_KICKED,type:"info"}),ie.sendAbled=!1,P("m-lite-btn",ne.editor)[0].className+=" m-lite-opt-unablebtn"}),k.on("transfer",function(){l({text:K.TEXT.TRANSFER,type:"info"})}),k.on("file:subprogress",function(e){if(e.finish&&"img"===e.type)for(var t=document.getElementById("qiao-m-lite-content").getElementsByTagName("img"),n=0;n<t.length;n++)if(t[n].getAttribute("data-fid")===e.fid)return void r(t[n],e.url)}),X.on("exporthistory",c),X.on("editorsend",re.send),setInterval(function(){m(self)},1500),se=!0,ne.preview.onclick=function(){ne.preview.style.display="none"}}function r(e,t){var n=e.cloneNode();n.src=t,n.onload=function(){var t=n.width,i=n.height,r=A([t,i],[150,150]);n.style.width=r[0]+"px",n.style.height=r[1]+"px",n.setAttribute("data-w",t),e.parentNode.replaceChild(n,e)},n.onclick=function(){var e=n.width,t=n.height,i=n.getAttribute("data-w"),r=i*t/e,a=A([i,r],ee),o={top:0,width:a[0],height:a[1],base64:n.src};if(a[1]<ee[1])o.top=Math.round(Math.max((ee[1]-a[1])/2,0));ne.preview.innerHTML=$(ae.preview,o),ne.preview.style.display="block"}}function a(e){if(ie.flashTimer)clearTimeout(ie.flashTimer),ie.flashTimer=null;e%=oe.flashTitle.length,document.title=oe.flashTitle[e]+ie.pageTitle,ie.flashTimer=setTimeout(function(){a(++e)},500)}function o(e){if(e&&ne.title.className.indexOf("notify")<0)ne.title.className+=" m-lite-title-notify",ie.pageTitle=document.title,a(0);else if(!e&&ne.title.className.indexOf("notify")>=0)ne.title.className=ne.title.className.replace(/\s+m-lite-title-notify/g,""),clearTimeout(ie.flashTimer),ie.flashTimer=null,document.title=ie.pageTitle||document.title}function s(e){if(ie.tiptimer)clearTimeout(ie.tiptimer);if("all"===ie.showType)ne.tip.innerHTML=e,ie.tiptimer=setTimeout(function(){ne.tip.innerHTML="&nbsp;&nbsp;"},3e3)}function u(){if(ie.tiptimer)clearTimeout(ie.tiptimer);ne.tip.innerHTML="&nbsp;&nbsp;"}function c(){var e,t,n,i,r,a=R("BD_Qiao_History");if(!a)a=B("form",{id:"BD_Qiao_History",method:"post",target:"_blank"}),a.setAttribute("accept-charset","utf-8"),a.setAttribute("action",te.root+"download_record.php"),a.style.display="none",a.innerHTML=ae.history,document.body.appendChild(a);for(e=a.getElementsByTagName("input"),n=0,i=e.length;i>n;n++)switch(t=e[n],t.name){case"r":t.value=ne.content.innerHTML.replace(/\r\n|\n/g,"<br>").replace(/<table.*?zoom_table.*?>.*?<\/table>/gi,"(图片)");break;case"t":t.value=te.userGroupName||"";break;case"z":if(U.ie)t.value=!0;else t.value=!1;break;case"prefix":t.value=te.root}if(U.ie)return r=document.charset,document.charset="utf-8",a.submit(),void(document.charset=r);else return void a.submit()}function d(e){if(e.text)e.text=e.text.replace(/simsun/,"Microsoft Yahei").replace(/10pt/,"9pt");return e}function l(e){var t;switch(e.type){case"connInfo":t=ae.connInfo;break;case"info":t=ae.info;break;default:t=ae.msg}var i;if(e=d(e),e=H({},e),e.time=V(e.time),F(ne.content,"beforeend",$(t,e)),e=e.style){t="";for(i in e)if(e.hasOwnProperty(i)){var r=i.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()});t+=r+":"+e[i]+";"}ne.content.lastChild.children[1].style.cssText=t}n(ne.content)}function f(e){if(U.chrome)e=e.replace(/<\/div><div>/g,"<BR>").replace(/<div>/g,"<BR>").replace(/<\/div>/g,"<BR>").replace(/<br>/g,"");else if(U.ie)e=e.replace(/(^<p>|<\/p>$)/gi,"").replace(/<\/p>\s*<p>/gi,"<br>");else if(U.firefox)e=e.replace(/<br>$/,"");else if(U.opera)e=e.replace(/<br>/g," ").replace(/(^<p>|<\/p>$)/g,"").replace(/<\/p><p>/g,"<br>");e=e.replace(/<BR>/g,"<br>");for(var t=[];/((<br[^>]*\/?>)|(<img[^>]+>))/im.test(e);)t[t.length]=RegExp.$1,e=e.replace(RegExp.$1,""+(t.length-1)+"");e=e.replace(/<[^>]+>/gm,"");for(var n=0;n<e.length;n++)e=e.replace(""+n+"",t[n]);return e=e.replace(/(<br[^>]*\/?>)/gim,"\r\n"),e=e.replace(/&nbsp;/g," "),e=w(e)}function m(){var e=X.getContent();if(e=f(e),""+e)k.sendPreview(e)}function p(t){if(!ne.container){e(),!se&&i(),M.done();var n={bid:te.bid,peerid:te.peerid,siteid:te.siteid,ucid:te.ucid,mainid:te.mainid,username:te.userName,csNameType:te.csNameType,nickname:te.customName,isAiPrologue:te.isAiPrologue,subid:t.subid,groupid:t.groupid,hisMsgCount:50,visitType:3,clienttype:3,startTime:(new Date).getTime(),crossDomain:!0};k.init(n,{onAntiAttack:g})}}function g(e){var t=e.type;if("second"===t)exports.emit("second");else if("auth"===t)exports.emit("auth",e.url)}function h(e,t){if(t)if(U.ie)e=e.replace(/(^<P>|<\/P>$)/gi,"").replace(/<\/P>\s*<P>/gi,"<br>").replace(/\&nbsp;?/g," ");else if(U.firefox)e=e.replace(/<br>$/," ");else if(U.opera)e=e.replace(/<br>/gi," ").replace(/(^<p>|<\/p>$)/gi,"").replace(/<\/p><p>/gi,"<br>");else e=e.replace(/<div>/i,"<BR>").replace(/<\/div>$/i,"").replace(/<\/div><div>/gi,"<BR>").replace(/<br>/g," "),e=e.replace(/<BR>/g,"<br>");else e=e.replace(/<BR>/g,"<br>");for(var n=[];/((<br[^>]*\/?>)|(<img[^>]+>))/im.test(e);)n[n.length]=RegExp.$1,e=e.replace(RegExp.$1,""+(n.length-1)+"");e=e.replace(/<[^>]+>/gm,"");for(var i=0;i<e.length;i++)e=e.replace(""+i+"",n[i]);return e=e.replace(/(<br[^>]*\/?>)/gim,"\n"),e=e.replace(/&nbsp;/g," ")}function v(e){if(!e)return"";else return(e+"").replace(/\&([^;]+);/g,function(e,t){var n;if(t in ue)return ue[t];else if(n=t.match(/^#x([\da-fA-F]+)$/))return String.fromCharCode(parseInt(n[1],16));else if(n=t.match(/^#(\d+)$/))return String.fromCharCode(parseInt(n[1],10));return e})}function b(){return H({},te.searchInfo)}function y(e){var i,r;if(ne.container)if("none"===e)ne.container.style.display="none",ie.showType="none";else{for(ne.container.style.display="",ne.title.style.display="",i=0;r=ne.widgets[i];i++)r.style.display="all"===e?"":"none";if(ne.minBtn.style.display="all"===e?"":"none",ne.maxBtn.style.display="all"===e?"none":"",ie.showType="all"===e?"all":"min","all"===e)n(ne.content);else u();if(U.ie<=6)ne.iframe.style.height=ne.container.clientHeight-2+"px",setTimeout(function(){t()},0)}}function w(e){var t,n=/(<img[^>]+(:?(:?data-type="face"[^>]+alt=[^>]*)|(:?alt=[^>]+data-type="face"[^>]*))>)/gi,i=document.createElement("div"),r="";return e=e.replace(n,function(e,n){return i.innerHTML=n,t=i.getElementsByTagName("img")[0],r=t.getAttribute("alt"),"["+r+"]"})}function T(e){var t,n=X.getStyle();if(e=Y(e)){e=h(e,X.isMultilineMode()),t={text:e,csName:"我",type:"client",style:n},t.time=new Date,l(t),e=w(e);var i=H({type:"text",text:v(e)},n);k.send(i),ie.messages.push(t),X.clear()}}function _(){return Z.PRE+te.siteid+"_IM"}function E(){var e=N.getItem(_());if(e){e=G(e);var t=e.lasttime||e.lastTime;if((new Date).getTime()-t<12e4)exports.emit("revertsession")}}var x,S=require("./base/dom"),I=require("./base/event"),C=require("./base/json"),L=require("./base/emitter"),k=require("qiao-im-sdk"),N=require("./base/localstorage"),A=require("./base/zoom"),O=require("../base/Promise"),M=(require("../common/identity"),new O),D=!1,R=S.g,P=S.q,U=(I.on,require("./base/browser")),q=require("./base/string"),j=require("./base/date"),F=S.insertHTML,B=S.create,H=require("./base/object").extend,Y=(C.stringify,q.trim),$=q.format,V=(q.encodeHTML,j.dataFormat),G=C.parse,W=I.preventDefault,z=require("./im/config"),K=require("./im/lang"),J={},X=require("./im/editor"),Q=(require("../base/emitter"),{CONNECT:"connect"}),Z={PRE:"BDBG_IM_",LAST_CHAT_TIME:"lasttime"},exports={};L.mixin(exports);var ee=[window.innerWidth,window.innerHeight],te={},ne={},ie={messages:[],status:0,showType:"none",sendAbled:!1,showOnce:!0,firstEnterFlag:!1},re={},ae={title:'<a href="#" class="m-lite-title-btn btn-max"><i></i></a><a href="#" class="m-lite-title-btn btn-min"><i></i></a><span class="m-lite-title-text">在线咨询</span><span class="m-lite-title-notify-text"><em></em>您有未读消息</span>',msg:'<div class="m-lite-msg msg-#{type}"><div class="m-lite-msg-title"><span class="m-lite-msg-name">#{csName}</span>#{time}</div><div class="m-lite-msg-content">#{text}</div><div class="m-lite-msg-cursor"></div>',info:'<div class="m-lite-msg-info m-lite-connect-info"><div class="m-lite-msg-info-inner">#{text}</div></div>',opt:'<span class="m-lite-logo"></span><span class="m-lite-qiao">咨询软件由百度商桥免费提供</span>',history:'<input type="hidden" name="r" value="" /><input type="hidden" name="t" value="" /><input type="hidden" name="z" value="" /><input type="hidden" name="prefix" value="" />',titleBgColor:"border-color:#{color};background-image:none;background: -webkit-gradient(linear, left top, left bottom, from(#fdfeff), to(#{color}));background: -webkit-linear-gradient(top, #fdfeff, #{color});background:-moz-linear-gradient(top, #fdfeff, #{color});background:-o-linear-gradient(top, #fdfeff, #{color});background:linear-gradient(top bottom, #fdfeff, #{color});",connInfo:'<div class="m-lite-msg-info m-lite-connect-info"><div class="m-lite-msg-info-inner">#{text}</div></div>',preview:'<ins class="qiao-webimlite-mask"></ins><ins class="qiao-webimlite-close"></ins><img src="#{base64}" style="margin-top:#{top}px;width:#{width}px;height:#{height}px;">'},oe={flashTitle:["【新消息】","【　　　】"]},se=!1,ue={amp:"&",lt:"<",gt:">",quot:'"',apos:"'"};return re.close=function(){y("none")},re.max=function(e){y("all")},re.min=function(e){y("min")},re.send=function(){var e=X.getContent();if(ie.sendAbled)T(e)},exports.init=function(e){if(te.bid=e.bid,te.peerid=e.peerid,te.siteid=e.siteid,te.ucid=e.ucid,te.mainid=e.mainid,te.SITE_ID=e.SITE_ID,te.userName=e.userName,te.offsetTime=parseInt(e.offsetTime,10),te.root=e.root||"//hqiao.baidu.com/v3/",te.bgColor=e.bgColor||"#2c77ff",te.position=e.position,te.csNameType=e.csNameType,te.customName=e.customName,te.searchInfo=e.searchInfo,te.jscode=e.jscode,te.IMroot=e.imRoot,te.authCode=e.authCode,te.poolRoot=e.POOL_ROOT,te.isAiPrologue=e.isAiPrologue,isNaN(te.offsetTime))te.offsetTime=0;z.init(te);var t={};if(t.siteid=te.siteid,te.jscode)z.jscode.jscode=te.jscode;z.authCode=te.authCode,z.URL.HI_SERVER=te.IMroot,ie.firstEnterFlag=!1,N.init(),E()},exports.auth=function(e,t){exports.emit("auth",e,t)},exports.accept=function(e){if(!k.hasConnected()){if(e.userGroupName)te.userGroupName=e.userGroupName,delete e.userGroupName;if(e=H(b(),e),J={subid:e.subid,groupid:e.bridgeTid,chattype:e.chattype},x=e.chat,p(J),!D)l({text:"正在连接...",type:"connInfo"});D=!0,M.promise().then(function(){J.jscode=z.jscode.jscode})}return y("all"),!0},exports.show=function(){y("all")},exports});

})(qiao.define, qiao.require);